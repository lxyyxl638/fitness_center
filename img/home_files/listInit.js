/* import from /Users/maoshuyu/xncode/workspace/renren/apps/photo/src/modules/all-list/listInit.js */(function(){function t(t){this.option={},$extend(this.option,t),e=t,this.init()}XN.namespace("XN.page.photoList");var e={};t.prototype={constructor:t,init:function(){this.initPage(),this.initFriendsPhotoSelector(),this.initIE6Hack(),this.initCopyLink(),this.initTabPhotoPager(),this.initSlideRecommend(),this.initAlbumComment()},initPage:function(){var e=XN.String.getQuery("curPage");if(e!="1"){el=$("page-fixer1-"+e);if(el){var t=el.realTop();window.scrollTo(0,t)}}},initSlideRecommend:function(){try{var e={ownerId:this.option.albumOwner,albumId:this.option.albumId,isTop:!0},t=new XN.page.photoList.slideRecommendPhoto(e);t.init()}catch(n){}},initFriendsPhotoSelector:function(){XN.page.albumList.initFriendsPhotoSelector($("friendSelectorCM"))},initIE6Hack:function(){if(XN.browser.IE6){var e=Sizzle(".photo-list li");XN.array.each(e,function(e,t){XN.event.addEvent(t,"mouseover",function(){this.addClass("hover")}),XN.event.addEvent(t,"mouseout",function(){this.delClass("hover")})})}},initCopyLink:function(){var e=this.option,t=$("copyLinkToShare");if(!t)return;var n=e.albumcontrol;e.passwordProtected&&(n=2),e.hasPrivacyPhoto&&(n=-2),ExternalShareLink.init(n,t,"album"),ExternalShareLink.getLinkUrl=function(){return e.url},XN.event.addEvent(t,"click",function(){ExternalShareLink.show()})},initUserOperation:function(){var e=this.option;XN.page.photoList.initDel(".delete-button a",Sizzle(".nav-btn")[0],"album"),XN.page.photoList.initEditAlbum(".editi-button a",Sizzle(".nav-btn")[0]),XN.page.photoList.initEditAlbum(".describe a",Sizzle(".ablum-infor")[0]);try{var t=Sizzle(".nav-btn .sort-photos")[0],n=Sizzle(".sort-type-menu")[0],r=Sizzle(".sort-type-item")[0];XN.page.photoList.sortPhotos.init(e.albumId,t,n,r)}catch(i){}XN.page.photoList.initBatchoperate({selector:"#edit-button",albumId:e.albumId,owner:e.albumOwner,albumName:e.albumName})},initTabPhotoPager:function(){var e=this.option,t=$(Sizzle(".opera-bar .left-btn")[0]),n=$(Sizzle(".opera-bar .right-btn")[0]),r=$(Sizzle(".photo-list")[0]),i=$(Sizzle(".photo-home")[0]),s=$(Sizzle(".opera-bar .choose-comment")[0]),o=$(Sizzle(".opera-bar .isNotPage")[0]),u=XN.page.albumList.getRunOnceFunc(function(){var t=Sizzle(".photo-list")[0];XN.page.albumList.initLazyLoad(".photo-list img",{lazyPage:3,albumId:e.albumId,ownerId:e.albumOwner,asUrlPhoto:e.urlPhoto,asUrlStatic:e.urlStatic,uoShowOrder:e.showOrder,uoShowEditTitle:e.showEditTitle,aPhotoCount:e.photoCount}),window.vpUseInfo.isPagerUser||XN.page.albumList.initFixPager(".photo-list img","page-fixer1-",20,t),e.showEditTitle&&XN.page.photoList.initEditInfo(".photo-edit",t),e.singlePhotoDelete&&XN.page.photoList.initDel(".photo-del",t),e.showOrder&&e.rightAlbumType&&XN.page.photoList.initDragdrop("li img",".photo-list",e.photoCount)}),a=XN.page.albumList.getRunOnceFunc(function(){var t={userId:e.guestId,isAdmin:e.showAdminDelete,headurl:e.tinyFullUrl},n={lazyPage:parseInt(window.location.search.substring(9))||3,albumId:e.albumId,ownerId:e.albumOwner,asUrlPhoto:e.urlPhoto,asurlSmallStatic:e.urlSmallStatic,aPhotoCount:e.photoCount,canShare:e.canShare,aType:e.albumType};XN.page.photoList.initLazyLoadCmt(".photo-home li",Sizzle(".opera-bar .choose-comment")[0],t,n)}),f=(new XN.ui.tabView({selectedClass:"select-btn"})).addTab({label:t,content:r,onActive:function(){u(),s&&s.hide(),o&&o.show()}}).addTab({label:n,content:i,onActive:function(){a(),s&&s.show(),o&&o.hide()}});f.setCurrentTab(t)},initAlbumComment:function(){var e=this.option;ILike.init({type:"album",id:e.albumId,userId:e.guestId,ownerId:e.albumOwner});if($("commentCenter"))return;XN.page.albumList.albumComment.init({userId:e.guestId,albumId:e.albumId,ownerId:e.albumOwner,isAdmin:e.showAdminDelete,headurl:e.tinyFullUrl}),$(Sizzle(".comment-button a")[0]).addEvent("click",function(){var e=$("cmtbody");e&&(e.scrollIntoView(),e.focus())})},initSetCopy:function(){copyExtralLink.init("spExtralLinkBtn",$("spExtralLinkValue").innerHTML)}},XN.page.photoList.initAll=t;var n=function(e,t){var r={},i=function(e,t){var i=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):r[e]=r[e]||n(document.getElementById(e).innerHTML);return t?i(t):i};return i(e,t)},r=XN.page.photoList.pager=function(e,t,n,i,s){e.innerHTML=r.render(t,n,i);if("onhashchange"in window&&(typeof document.documentMode=="undefined"||document.documentMode==8)){jxn(window).bind("hashchange",function(n){var o=location.hash;if(/^#page(\d+)$/.test(o)){var u=parseInt(RegExp.$1,10);u<=t&&u>=0&&(s&&s(u),e.innerHTML=r.render(t,u,i))}});var o=location.hash;/^#page(\d+)$/.test(o)&&jxn(window).trigger("hashchange")}else jxn(e).delegate(".photo-page-nav","click",function(n){if(!jxn(this).hasClass("pager-current")&&/#page(\d+)$/.test(jxn(this).attr("href"))){var o=parseInt(RegExp.$1,10);o<=t&&o>=0&&(s&&s(o),e.innerHTML=r.render(t,o,i));var n=window.event||n;n.preventDefault?n.preventDefault():n.returnValue=!1}})};r.template=function(){var e='<ol class="photo-pager clearfix" id="photoPager">                                <% if(index > 1) { %>                                    <li class="photo-page-i"><a class="photo-page-nav" href="#page<%= (index - 1) %>">上一页</a></li>                                <% } %>                                <li class="photo-page-i"><a class="photo-page-nav <% if(index === 1) { %>pager-current<% } %>" href="#page1">1</a></li>                                <li class="photo-page-o"><% if(start > 2) { %>...<% } %></li>                                <% for(var i = start; i <= end ; i++) { %>                                    <% if(i !== 1 && i !== pages) { %>                                        <% if(i === index) { %>                                        <li class="photo-page-i"><a class="photo-page-nav pager-current" href="#page<%= i %>"><%= i %></a></li>                                        <% } else { %>                                        <li class="photo-page-i"><a class="photo-page-nav" href="#page<%= i %>"><%= i %></a></li>                                        <% } %>                                    <% } %>                                <% } %>                                <li class="photo-page-o"><% if(end < (pages - 1)) { %>...<% } %></li>                                <li class="photo-page-i"><a class="photo-page-nav <% if(index === pages) { %>pager-current<% } %>" href="#page<%= pages %>"><%= pages %></a></li>                                <% if(index < pages) { %>                                    <li class="photo-page-i"><a class="photo-page-nav" href="#page<%= (index + 1) %>">下一页</a></li>                                <% } %>                            </ol>';return n(e)}(),r.render=function(e,t,n){var i=t-n>0?t-n:1,s=t+n<e?t+n:e;return r.template({pages:e,index:t,start:i,end:s})};var i={},s=function(t){var n=window.vpUseInfo.ownerId,r=window.vpUseInfo.albumId,i=t.photoList||[],s=i.length,o="photo",u="";for(var a=0;a<s;a++){var f=i[a];u+='<li data-info="{album:'+r+", photo:"+f.photoId+", owner:"+n+", position:"+f.position+", positionSaved:"+f.positionSaved+'}">'+"<a"+(e.showOrder?' style="cursor:move"':" ")+'href="'+e.urlPhoto+"/photo/"+n+"/photo-"+f.photoId+'" class="picture">'+'<img class="photo-list-img" src="'+e.urlStatic+'/a.gif" style="opacity:0;filter:alpha(opacity=0);background:url('+f.mainUrl+')" data-photo="{ptype: &quot;'+o+"&quot;,large:&quot;"+f.largeUrl+"&quot;,owner:&quot;"+n+"&quot;,id: &quot;"+f.photoId+"&quot;,xLarge:&quot;"+f.xLarge+"&quot;,xWidth:"+"&quot;"+f.xWidth+"&quot;,xHeight:&quot;"+f.xHeight+'&quot;}"/>'+"</a>"+'<div class="photo-oper">'+(e.showEditTitle?'<a class="photo-edit" href="javascript:;">编辑</a>':'<a class="photo-list-like-handler photo-list-zan'+(f.like?t.likeType=="xihuan"?"photo-list-liked":"photo-list-zaned":"")+'" href="javascript:;" data-liked="'+f.like+'"></a>')+"</div>"+(e.showEditTitle?'<div class="myphoto-info"><span class="descript">'+f.titleWithAt+'</span></div><div class="edit-desc"><div class="edit-content"><input type="text" value="'+f.title+'" data-privacy='+f.privacyV7Ext+' /><p>可按<span class="enter-ico">回车</span>保存、<span class="">Esc</span>取消</p></div></div>':'<div class="myphoto-info"><span class="descript">'+f.titleWithAt+"</span></div>")+"</li>"}jxn("#photoListContainer").html(u),jxn(".photo-list-img").fadeIn("slow"),dd&&dd.refresh();if(XN.browser.IE6){var l=Sizzle(".photo-list li");XN.array.each(l,function(e,t){XN.event.addEvent(t,"mouseover",function(){this.addClass("hover")}),XN.event.addEvent(t,"mouseout",function(){this.delClass("hover")})})}},o=function(e){window.scrollTo(0,0);if(i[e]){s(i[e]);return}var t=window.vpUseInfo.ownerId,n=window.vpUseInfo.albumId;new XN.net.xmlhttp({url:"http://photo.renren.com/photo/"+t+"/album-"+n+"/bypage/ajax?curPage="+e+"&pagenum=40",method:"GET",onSuccess:function(t){var t=XN.json.parse(t.responseText);s(t),i[e]=t}})};if(window.vpUseInfo.isPagerUser){var u=document.getElementById("photo-list-pager"),a=parseInt(u.getAttribute("data-page"),10);a>40&&new XN.page.photoList.pager(u,Math.ceil(a/40),1,2,function(e){e--,o(e)})}})();