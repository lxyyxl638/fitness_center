XN.namespace("app.share");XN.namespace("config.share");XN.config.share.enableSyncComment=false;function updateOuterShareTip(){function a(){if(window.clipboardData.setData("Text",$("shareLinkVal").value)){$("copyTip").innerHTML="(链接已复制)"}else{$("shareLinkVal").select();$("copyTip").innerHTML="(请手动复制)"}}var b=$("copyTip");if(!b||!$("shareLinkVal")){return}if(window.clipboardData){$("shareLinkVal").style.width="210px";b.innerHTML='<a href="javascript:;" style="margin-left:5px;">复制</a>';b.getElementsByTagName("a")[0].onclick=a}else{b.innerHTML="(Ctrl+C或右键复制)"}b.show()}XN.app.share.action=function(a){this.config={reqeustURI:"http://share."+XN.env.domain+"/share/submit.do",commentLength:300};$extend(this.config,a)};XN.app.share.action.prototype={getConfig:function(a){return this.config[a]},add:function(a){var b=this.getConfig("commentLength");if(a.body.length>b){this.fireEvent("checkError","评论字数不能超过"+b);return}this.request(a)},send:function(a){var b=this.getConfig("commentLength");if(a.ids.length===0){this.fireEvent("checkError","请至少选择一个好友");return}if(a.body.length>b){this.fireEvent("checkError","评论字数不能超过"+b);return}this.request(a)},_addParamInEditor:function(){if($("isfromshare")){return}var a;if(XN.browser.IE){a=$element('<input name="isfromshare" />')}else{a=$element("input");a.name="isfromshare"}a.id="isfromshare";a.type="hidden";a.value="1";$("cmtbody").parentNode.insertBefore(a,$("cmtbody"))},commentBlog:function(c){if(window.addNewCommentEntry&&$("cmtbody")){$("cmtbody").value=c.body;this._addParamInEditor();$("isfromshare").value="1";if($("feedComment")){$("feedComment").checked=false}if($("cmttoid")){$("cmttoid").value=""}if($("whisper1")){$("whisper1").value="0"}addNewCommentEntry();$("isfromshare").value="0";return}var d=this;var b=XN.string.getQuery("id",c.link);var a=XN.string.getQuery("owner",c.link);new XN.net.xmlhttp({url:"http://blog."+XN.env.domain+"/PostComment.do",data:"id="+b+"&owner="+a+"&body="+encodeURIComponent(c.body)+"&to=0&only_to_me=0&isfromshare=1",onSuccess:function(e){d.fireEvent("commentBlogSuccess",e.responseText)},onError:function(){d.fireEvent("commentBlogError")}})},commentPhoto:function(c){if($("cmtbody")&&window.XN&&XN.page.albumPhoto){$("cmtbody").value=c.body;this._addParamInEditor();$("isfromshare").value="1";XN.PAGE.albumPhoto.commentEditorSave();$("isfromshare").value="0";return}var b=XN.string.getQuery("id",c.link);var a=XN.string.getQuery("owner",c.link);new XN.net.xmlhttp({url:"http://photo."+XN.env.domain+"/ajaxcommentphoto2.do",data:"id="+b+"&owner="+a+"&body="+encodeURIComponent(c.body)+"&isfromshare=1",onSuccess:function(d){This.fireEvent("commentPhotoSuccess",d.responseText)},onError:function(){This.fireEvent("commentPhotoError")}})},request:function(b){var c=this;this.fireEvent("beforePost");var a=b.tsc;delete b.tsc;XN.log("此次分享收集的参数如下:");XN.log(b);new XN.net.xmlhttp({url:this.getConfig("reqeustURI"),data:"tsc="+a+"&post="+encodeURIComponent(XN.json.build(b)),onComplete:function(){c.fireEvent("postComplete")},onSuccess:function(f){try{var d=XN.json.parse(f.responseText)}catch(g){c.fireEvent("postError")}if(d.status===0){c.fireEvent("postSuccess",d.msg,d);XN.app.share.fireEvent("postSuccess",b,d);if(new RegExp("(page|org)."+XN.env.domain_reg+"(/\\d+)?/note").test((b.link||b.form.link))){new XN.net.xmlhttp({url:"http://"+location.host+"/note/addShareCount",method:"post",data:"id="+(b.noteId||b.form.noteId)+"&pid="+(b.fromno||b.form.formno)})}if(!XN.config.share.enableSyncComment){return}if(!b.body||XN.string.isBlank(b.body)){return}if(!b.sendcomment){return}if(b.pic&&b.pic!==""){c.commentPhoto(b)}else{if(new RegExp("blog."+XN.env.domain_reg).test(b.link)){c.commentBlog(b)}}}else{c.fireEvent("postError",d.msg)}},onError:function(){c.fireEvent("postError")}})}};XN.event.enableCustomEvent(XN.app.share);XN.event.enableCustomEvent(XN.app.share.action.prototype);function checkShareAuth(a){if(!XN.config.share.enableSyncComment){return}if(!XN.app.share.pop.sysMode){return}if(String(a.value)!="99"){$("pop_share_syscomment").hide();$("pop_share_sendcomment").disabled=true}else{$("pop_share_syscomment").show();$("pop_share_sendcomment").disabled=false}}(function(){var c;XN.form=XN.FORM;var a=null;var b=true;var d=function(g){var e=false,f=$extend({},g),h=null;if(g.waitTime&&g.onTimeout){e=true;f.onSuccess=function(i){window.clearTimeout(h._timeoutTimer);g.onSuccess(i)}}h=new XN.net.xmlhttp(f);if(e){h._timeoutTimer=setTimeout(function(){g.onTimeout.call(h);try{h.abort()}catch(i){XN.log(i)}},g.waitTime)}};XN.app.share.pop=function(j,A,n){var v=XN.APP.share.onlyShowSendContent||false;var q,h,e;var o={};$extend(o,A);var t={add:false,send:false,fav:false};if(!A.tabDefault){A.tabDefault="add"}if(v){A.tabDefault="send"}switch(A.tabDefault){case"send":t.send=true;break;case"fav":t.fav=true;break;case"add":t.add=true;break;default:return false}var f=A.sysn===true?A.sysn:false;h="站内信给好友";e="发信给";if(v){q="站内信给好友"}else{q="分享"}if(!a&&!b){new XN.NET.xmlhttp({url:"http://page."+XN.env.domain+"/myPages",method:"get",onSuccess:function(C){try{var i=XN.JSON.parse(C.responseText);if(i.pages&&i.pages.length>0){a=i.pages}XN.app.share.pop(j,A)}catch(D){}},onComplete:function(){b=true}});return false}var u=A.tabDefault;if(!c){c=new XN.ui.multiFriendSelector({url:"http://sg.renren.com/s/f",maxNum:10});c.addEvent("overMaxNum",function(i){XN.DO.showError("一次最多只能分享给"+i+"位好友^_^")})}if(A.tid){A="tid="+A.tid+"&tribeId="+A.tribeId}else{A="post="+encodeURIComponent(XN.json.build(A))}var y="";if(a){for(var w=0;w<a.length;w++){y+='<option value="'+a[w].id+'">'+a[w].name+"</option>"}}var p='<div id="popShareContainer" style="display:none;"><div class="share_header">		<div class="tabs clearfix">				<ul class="toggle_tabs clearfix">					<li class="first">						<a id="shareSendTab" onfocus="this.blur()" href="javascript:void(0)">'+h+"</a>					</li>";if(a){p+='<li class="middle">						<a id="sharePageTab" onfocus="this.blur()" href="javascript:void(0)">分享到公共主页</a>					</li>'}if(!v){p+='<li class="middle">	<a id="shareAddTab" onfocus="this.blur()" href="javascript:void(0)">发送到新鲜事</a></li>'}if(!v){p+='<li class="last">   <a id="shareFavTab" onfocus="this.blur()" href="javascript:void(0)">自己收藏</a></li>'}p+='				</ul>			</div>		</div>		<div id="shareSendContent" class="share_send">			<div class="share_fields">				<dl class="composer_fields clearfix">					<dt id="dt_to_field">						<label for="to_field">'+e+': </label>					</dt>					<dd class="field" id="dd_to_field">						<div id="shareSelectFriends" class="composer"></div>					</dd>					<dt id="dt_subject_field">						<label for="subject_field">标题: </label>					</dt>					<dd class="field" id="dd_subject_field">						<input id="popShareSubjectInput" value="" class="inputtext" type="text">					</dd>					<dt id="dt_message_field">                       <img src="'+XN.env.CDNstaticRoot+'a.gif" class="shareSend_HeadImg"/>					</dt>					<dd class="field" id="dd_message_field">						<textarea name="send_message" id="popShareSendMessage"></textarea>					</dd>				</dl>			</div>		</div>';if(a){p+='		<div id="sharePageContent" class="share_send" style="display:block;">			<div class="share_fields">				<dl class="composer_fields clearfix">					<dt id="dt_to_field">						<label for="to_field">分享给: </label>					</dt>					<dd class="field" id="dd_to_field">						<select id="pagePid" name="pid" class="select float-left">'+y+'</select>					</dd>					<dt id="dt_subject_field" style="display:none;">						<label for="subject_field">标题: </label>					</dt>					<dd class="field" id="dd_subject_field" style="display:none;">						<input id="popShareSubjectInputForPage" value="" class="inputtext" type="text">					</dd>					<dt id="dt_message_field">                       <img src="'+XN.env.CDNstaticRoot+'a.gif"  class="shareSend_HeadImg"/>					</dt>					<dd class="field" id="dd_message_field">						<textarea name="send_message" id="popShareSendMessageForPage"></textarea>					</dd>				</dl>			</div>		</div>'}if(!v){p+='		<div id="shareAddContent" class="share_post">			<div class="share_fields">				<dl class="composer_fields clearfix">					<dt id="dt_message_field">                       <img src="'+XN.env.CDNstaticRoot+'a.gif"  class="shareSend_HeadImg"/>					</dt>					<dd class="field" id="dd_message_field">						<textarea name="message" id="sharer_popup_message"></textarea>					</dd>';if(f){p+='           <dt>&nbsp;</dt>					<dd class="field" id="dd_privacy_field">                       <span id="pop_share_syscomment" class="float-right">                       <label id="pop_share_sclabel" style="font-weight:normal" >                           <input  type="checkbox" checked="true" id="pop_share_sendcomment" name="sendcomment" />                           同时评论到原内容                       </label>                       </span>					</dd>'}p+="				</dl>			</div>		</div>";p+='    <div id="shareFavContent" class="share_post">       <div class="share_fields">				<dl class="composer_fields clearfix">					<dt id="dt_message_field">                       <img src="'+XN.env.CDNstaticRoot+'a.gif"  class="shareSend_HeadImg"/>					</dt>					<dd class="field" id="dd_message_field">						<textarea name="message" id="sharer_fav_message"></textarea>					</dd>				</dl>       </div>    </div>'}p+='	 <div id="shareAjaxResult"></div></div><div class="loading" id="popShareLoading"><p>载入中...</p></div>';var x=XN.DO.confirm({title:q,message:p,callBack:function(i){if(i){this.preventHide();r()}else{if(v){XN.APP.share.onlyShowSendContent=false}XN.dom.enable();this.remove()}},submit:"分享",params:{addIframe:true},width:465,Y:XN.event.scrollTop()+100});x.setIndex(600);x.body.addClass("share_popup");x.header.hide();x.footer.hide();$("shareSelectFriends").setContent(c);c.reset();XN.form.help($("popShareSendMessage")).setDefaultValue("我分享的理由是...");XN.form.help($("sharer_popup_message")).setDefaultValue("我分享的理由是...");XN.form.help($("sharer_fav_message")).setDefaultValue("我收藏的原因是...");object.use("xn.mention",function(i){i.mention.Mention.init([{obj:$("sharer_popup_message"),ugcId:"",ugcType:"share",ownerId:XN.user.id}])});this.fireEvent("dialogPop",x);function g(G){var E=G.responseText;if(XN.string.isBlank(E)){if(G.status==0||G.status==302){$("popShareLoading").innerHTML="<center>您还没有登录，请登录后操作</center>";setTimeout(function(){x.hide()},1500);return false}}else{try{var D=XN.json.parse(E);if(D.code){XN.DO.showError(D.msg)}x.hide();return false}catch(H){XN.log(H)}}$("shareAjaxResult").innerHTML=E;$("popShareSubjectInput").value=$("popShareTitle").value;try{var C=XN.dom.getElementsByClassName("shareSend_HeadImg",$("popShareContainer"),"img");var i=$("popShareParams").currenUserTinyurl.value;XN.array.each(C,function(J,I){I.src=i})}catch(H){XN.log(H)}$("popShareContainer").show();$("popShareLoading").hide();x.header.show();x.footer.show();var F=$("popShareParams").link.value;XN.app.share.pop.sysMode=false;if(XN.config.share.enableSyncComment){if(new RegExp("^http://blog."+XN.env.domain_reg).test(F)){$("pop_share_syscomment").show();$("pop_share_sclabel").innerHTML="评论同步发送到日志";XN.app.share.pop.sysMode=true}else{if(new RegExp("^http://photo."+XN.env.domain_reg).test(F)){$("pop_share_syscomment").show();$("pop_share_sclabel").innerHTML="评论同步发送到照片";XN.app.share.pop.sysMode=true}else{XN.app.share.pop.sysMode=false}}}$("sharer_popup_message").focus();x.refresh();updateOuterShareTip();return true}function k(){XN.DO.showError("获取分享失败,请稍候重试")}var s=new XN.ui.tabView({selectedClass:"selected"}).addTab({label:"shareSendTab",content:"shareSendContent",active:t.send,onActive:function(){$("shareSendContent").show();u="send";var i=$("shareSelectFriends").getElementsByTagName("input");XN.array.each(i,function(D,C){if(C.id.indexOf("mfs_")!=-1){C.focus()}})}});if(a){s.addTab({label:"sharePageTab",content:"sharePageContent",onActive:function(){$("sharePageContent").show();u="page"}})}if(!v){s.addTab({label:"shareAddTab",content:"shareAddContent",active:t.add,onActive:function(){u="add";$("sharer_popup_message").focus()}});s.addTab({label:"shareFavTab",content:"shareFavContent",active:t.fav,onActive:function(){u="fav";$("sharer_fav_message").focus();x.getButton("分享").setText("收藏")},onInactive:function(){x.getButton("收藏").setText("分享")}})}if(v){$("shareSendContent").style.display="block"}d({url:j,data:A,onSuccess:g,onError:k,waitTime:10000,onTimeout:function(){$("popShareLoading").innerHTML="<p>获取分享数据超时，请稍后重试</p>";setTimeout(function(){x.hide()},1500)}});var m=new XN.app.share.action(n||{});m.addEvent("checkError",function(i){XN.DO.showError(i)});var B=null,l=this;m.addEvent("beforePost",function(){B=XN.DO.confirm({msg:'<div id="share_msg_dialog" class="share-success clearfix large">正在发送请求...</div><div id="pop_share_ads"></div>',width:460,params:{showCloseButton:true}});B.footer.hide()});m.addEvent("postSuccess",function(H,G){var I,C={a:"分享成功",b:'你还可以<a href="javascript:void(0)" onclick="pop_share_sendDefault()">发送给部分好友</a>',c:'观看更多精彩分享，<a target="_blank" href="http://share.'+XN.env.domain+'">请点击这里！</a>'};if(u==="send"){C.b="对方会通过站内信收到此分享内容。"}else{if(u==="fav"){C.a="收藏成功！";C.b="此内容已添加到你的收藏中，并且仅你自己可见。"}}var F=G.adObjArry||[{url:"http://samsungdrama.renren.com/",img:"http://a.xnimg.cn/imgpro/share/samsung/ad.jpg"},{url:"http://caihongtang.renren.com/",img:"http://a.xnimg.cn/imgpro/share/caihongtang/b1101.jpg"}];var i=F[Math.floor(F.length*Math.random())];I=' <div class="share-success-tip">	<p><img src="http://a.xnimg.cn/imgpro/share/share-success.gif"/></p>	<p>'+C.a+'</p></div><div class="share-success-more"><div id="share_success_link"></div>	<p>'+C.b+"</p>	<p>"+C.c+'</p><p>   <a href="'+i.url+'" target="_blank" >       <img height="80" width="280" src="'+i.img+'" />   </a></p></div>';$("share_msg_dialog").setContent(I);if(u=="add"){var D=(G.type==1?"http://blog.":"http://share.")+XN.env.domain+"/share/"+G.userid+"/"+G.shareid;var E='<p class="gray">复制分享链接,通过QQ或者MSN发送给你的好友.</p><p><input type="text" class="text-box" style="width:210px;height:20px" value="'+D+'" id="share_success_val" /><input type="button" class="input-submit" value="复制" id="share_success_btn" class="share_success_btn" /></p>';$("share_success_link").setContent(E);XN.app.share.copyExtralLink.init("share_success_btn",$("share_success_val").value)}l.fireEvent("postSuccessDialogPop",B);window.closeShareSucTimer=setTimeout(function(){XN.dom.enable();try{XN.app.share.copyExtralLink.clip.hide();B.remove()}catch(J){B.remove();XN.log(J)}},5000)});m.addEvent("postError",function(i){XN.DO.showError(i||"请求失败，请重试");B.hide()});function z(C){var i=$(C).value;return i.replace("我分享的理由是...","").replace("我收藏的原因是...","")}function r(){var i={},C;if(u=="add"){i=XN.form.serialize("popShareParams","hash");if($("pop_share_sendcomment")&&!$("pop_share_sendcomment").disabled){i.sendcomment=$("pop_share_sendcomment").checked}i.tsc=$("tsc_popShare").value;i.action="add";i.auth=99;i.body=z("sharer_popup_message");if($("summary")){i.summary=$("summary").innerHTML}i.noteId=$("noteId")?$("noteId").value:0;if(location.href.indexOf("http://page."+XN.env.domain+"")==0){i.pageId=i.fromno||($("fromno")&&$("fromno").value)}m.add(i)}else{if(u=="send"){if(v){XN.APP.share.onlyShowSendContent=false}i.tsc=$("tsc_popShare").value;i.action="sharetofriend";i.ids=c.getIds();i.form=XN.form.serialize("popShareParams","hash");if($("summary")){i.form["summary"]=$("summary").innerHTML}i.body=z("popShareSendMessage");i.subject=$("popShareSubjectInput").value;i.noteId=$("noteId")?$("noteId").value:0;m.send(i)}else{if(u=="page"){i=XN.form.serialize("popShareParams","hash");i.sendcomment=false;i.tsc=$("tsc_popShare").value;i.action="add";i.auth="99";i.body=z("popShareSendMessageForPage");if($("summary")){i.summary=$("summary").innerHTML}i.pageId=$("pagePid").value;i.noteId=$("noteId")?$("noteId").value:0;m.add(i)}else{if(u==="fav"){i=XN.form.serialize("popShareParams","hash");i.sendcomment=false;i.tsc=$("tsc_popShare").value;i.action="add";i.auth=-1;i.body=z("sharer_fav_message");if($("summary")){i.summary=$("summary").innerHTML}i.noteId=$("noteId")?$("noteId").value:0;if(location.href.indexOf("http://page."+XN.env.domain+"")==0){i.pageId=i.fromno||($("fromno")&&$("fromno").value)}m.add(i)}}}}}pop_share_sendDefault=function(){if(window.closeShareSucTimer){clearTimeout(window.closeShareSucTimer)}$extend(o,{tabDefault:"send"});XN.app.share.pop(j,o)}};XN.app.share.showDialog=XN.app.share.pop;XN.app.share.del=function(h,f,g,e){XN.DO.confirm({msg:"您确定要删除此分享吗",callBack:function(j){if(j){var i="http://share."+XN.env.domain+"/share/EditShare.do";var k="action=del&sid="+h;if(e){k+="&pid="+e}if(f!=""){k+="&type="+f}if(e&&location.href.indexOf("http://page."+XN.env.domain)==0){i="http://page."+XN.env.domain+"/share/del";k="id="+h+"&pid="+e}if(e&&location.href.indexOf("http://org."+XN.env.domain)==0){i="http://org."+XN.env.domain+"/share/del";k="id="+h+"&pid="+e}new XN.NET.xmlhttp({url:i,data:k,onSuccess:function(){$("share_"+h).remove();var l=XN.dom.getElementsByClassName("share-itembox","shareList","div");if(l&&l.length==0){window.location.reload()}},onError:function(){alert("删除错误")}})}}})}})();function pop_share_new(a,b){XN.APP.share.showDialog(a,b)}function create_share_div(f,a,e,d){var b="http://share."+XN.env.domain+"/share/ajax.do",c={};if(d){c.reqeustURI="http://share."+XN.env.domain+"/share/submit.do?ref="+d}XN.APP.share.showDialog(b,{id:f,owner:a,host:e},c)}function create_share_zhan(d,a){var b="http://share."+XN.env.domain+"/share/popup/zhan",c={};c.reqeustURI="http://share."+XN.env.domain+"/share/postshare";XN.APP.share.showDialog(b,{id:d,owner:a,type:140},c)}function create_share_feed(g,b,c){var f,e;if(c=="pageThread"||c=="pageBlog"||c=="pageAlbum"){if(!(XN.user&&!XN.string.isBlank(XN.user.id))){XN.DO.showError("请先登录！");return}}f=function(h){switch(h){case"blog":return"http://blog."+XN.env.domain+"/blog/"+b+"/"+g+"/homeShare";case"album":return"http://photo."+XN.env.domain+"/photo/"+b+"/album-"+g+"/share";case"photo":return"http://photo."+XN.env.domain+"/photo/"+b+"/photo-"+g+"/share";case"forum":return"http://xiaozu."+XN.env.domain+"/xiaozu/"+g+"/js";case"thread":return"http://xiaozu."+XN.env.domain+"/xiaozu/"+g+"/thread/"+b+"/share";case"clike":return"http://app."+XN.env.domain+"/like/likeInfo?feed_id="+g;case"pageThread":return"http://page."+XN.env.domain+"/"+g+"/group/"+b+"/getShareData";case"pageBlog":return"http://page."+XN.env.domain+"/"+b+"/note/"+g+"/share";case"pageAlbum":return"http://page."+XN.env.domain+"/"+b+"/album/"+g+"/share";case"video":return"http://video."+XN.env.domain+"/ajax/getVideoInfo?ownerId="+b+"&videoId="+g}};var d=function(h){switch(h){case"blog":return"日志";case"album":return"相册";case"photo":return"照片";case"forum":return"小组";case"thread":return"帖子";case"pageThread":return"话题";case"pageBlog":return"日志";case"pageAlbum":return"相册";case"video":return"视频"}};var a=function(i,h){new XN.net.xmlhttp({url:"http://blog."+XN.env.domain+"/share/incShareCount.do",data:"link="+encodeURIComponent((i.link||i.form.link))})};if(c=="blog"&&!XN.app.share.hasBlogListener){XN.app.share.hasBlogListener=true;XN.app.share.addEvent("postSuccess",a)}new XN.net.xmlhttp({url:f(c),method:"GET",onSuccess:function(j){if(!XN.string.isJSON(j.responseText)){if(j.responseText.indexOf("isProtected")!==-1){XN.DO.showMessage("只有所有人可见的"+d(c)+"才能被分享 :)","友情提示")}if(j.responseText.indexOf("error")!==-1){XN.DO.showMessage(d(c)+"已经被删除 :(")}return}try{var i=XN.json.parse(j.responseText);if(i.isProtected){XN.DO.showMessage("只有所有人可见的"+d(c)+"才能被分享 :)","友情提示");return}if(i.albumid){i.albumid=new Number(i.albumid).toString()}var h="http://share."+XN.env.domain+"/share/popup.do";pop_share_new(h,i)}catch(k){XN.log(k.description)}},onError:function(h){XN.DO.showError("获取分享错误!")}})}function create_share2friend_div(d,a,c){var b="http://share."+XN.env.domain+"/share/ajax.do";XN.APP.share.onlyShowSendContent=true;pop_share_new(b,{id:d,owner:a,host:c})}function create_share_div_send(d,a,c){var b="http://share."+XN.env.domain+"/share/ajax.do";pop_share_new(b,{id:d,owner:a,host:c,tabDefault:"send",sysn:true})}function create_share_nosysn_send(d,a,c){var b="http://share."+XN.env.domain+"/share/ajax.do";pop_share_new(b,{id:d,owner:a,host:c,tabDefault:"send",sysn:false})}function create_share_nosysn(d,a,c){var b="http://share."+XN.env.domain+"/share/ajax.do";pop_share_new(b,{id:d,owner:a,host:c,sysn:false})}function create_share_sysn(d,a,c){var b="http://share."+XN.env.domain+"/share/ajax.do";pop_share_new(b,{id:d,owner:a,host:c,sysn:true})}function create_share_jebe(b,c){var a="http://share."+XN.env.domain+"/share/ajax.do";XN.app.share.showDialog(a,b,{reqeustURI:c})}function create_thread_share_div(c,b){var a="/getshare.do";a="http://share."+XN.env.domain+""+a;pop_share_new(a,{tid:c,tribeId:b})}function create_share_edm(d,a,c){var b="http://edm."+XN.env.domain+"/feedshare.do?id="+d;new XN.net.xmlhttp({url:b,method:"GET",onSuccess:function(h){if(!XN.string.isJSON(h.responseText)){XN.DO.showMessage("服务器返回错误");return}try{var g=XN.json.parse(h.responseText);var f="http://share."+XN.env.domain+"/share/popup.do";pop_share_new(f,g)}catch(i){XN.log(i.description)}},onError:function(e){XN.DO.showError("获取分享错误!")}})}function create_share_popup(b){var a="http://share."+XN.env.domain+"/share/ajax.do";pop_share_new(a,b)}function getShowTipText(a){switch(a){case"1":return"日志";case"2":return"相片";case"8":return"相册"}return"内容"}function pop_share(){if($("isProtected")&&$("isProtected").value=="true"){XN.DO.showMessage("只有所有人可见的"+getShowTipText($("type").value)+"才能被分享 :)","友情提示");return false}var b={};try{b=XN.FORM.serialize("popShareParams","hash")}catch(c){b.link=$("link").value;b.type=$("type").value;b.title=$("title").value;b.pic=$("pic").value;b.fromno=$("fromno").value;b.fromname=$("fromname").value;b.fromuniv=$("fromuniv").value;b.albumid=$("albumid").value;b.largeurl=$("largeurl").value;if($("mainurl")){b.mainurl=$("mainurl").value}}b.summary=$("summary").innerHTML;var a="http://share."+XN.env.domain+"/share/popup.do";pop_share_new(a,b)}function pop_share_for_list(d){if($("isProtected")){var h=$("popShareParams_"+d).getElementsByTagName("input");var f=0;while(f<h.length){if(h[f].getAttribute("id")=="isProtected"){if(h[f].value=="true"){var g;for(var c=0;c<h.length;c++){if(h[c].getAttribute("name")=="type"){g=h[c].value}}XN.DO.showMessage("只有所有人可见的"+getShowTipText(g)+"才能被分享 :)","友情提示");return false}break}f++}}var e=XN.FORM.serialize("popShareParams_"+d,"hash");e.summary=$("summary_"+d).innerHTML;e.sysn=false;var b="http://share."+XN.env.domain+"/share/popup.do";pop_share_new(b,e);var a=function(j,i){new XN.net.xmlhttp({url:"http://blog."+XN.env.domain+"/share/incShareCount.do",data:"link="+encodeURIComponent((j.link||j.form.link))})};if(e.type=="1"&&!XN.app.share.hasBlogListener){XN.app.share.hasBlogListener=true;XN.app.share.addEvent("postSuccess",a)}}function delete_share(d,b,c,a){XN.APP.share.del(d,b,c,a)}function pop_share_msg(){var a="http://share."+XN.env.domain+"/share/popup.do";var b=XN.form.serialize($("popShareParams"),"hash");pop_share_new(a,b)}XN.app.share.copyExtralLink={};$extend(XN.app.share.copyExtralLink,{init:function(b,a){this.btnId=b;this.copyVal=a;this.createClient()},createClient:function(){var a=this;if(XN.BROWSER.IE){XN.event.addEvent(a.btnId,"click",function(){if(a.clip){a.clip.reposition(a.btnId);return}})}if(typeof ZeroClipboard!="undefined"){this.createClip();return}XN.loadFile(XN.env.staticRoot+"jspro/album/ZeroClipboard.js",function(){ZeroClipboard.setMoviePath(XN.env.CDNstaticRoot+"swf/album/ZeroClipboard.swf");a.createClip()})},createClip:function(){if(this.clip){this.clip.reposition(this.btnId);this.clip.show();this.clip.setText(this.copyVal);return false}var b=this;var a=new ZeroClipboard.Client();a.setHandCursor(true);a.addEventListener("complete",function(c,d){XN.DO.showMessage("已经复制到剪贴板");c.hide()});a.setText(this.copyVal);a.glue(this.btnId);a.div.style.zIndex=999999999;this.clip=a}});object.define("object/mvc","dom, events",function(b,a){var d=b("dom"),c=b("events");a.Controller=new Class(function(){Class.mixin(this,c.Events);this.option=property(function(e){return e.__option},function(e,f){e.__option=f});this.atts=property(function(e){return e.__atts},function(e,f){e.__atts=f});this._initEl=function(e){var f=e.get("option");e.el=f.el?(typeof f.el=="string"?d.getElement(f.el):f.el):d.wrap(document.createElement("div"));if(f.className){e.el.addClass(f.className)}};this._initInstanceFuncs=function(e){var f=e.get("option");for(key in f){if(typeof f[key]=="function"){e[key]=f[key]}}};this._initAtts=function(e){var f=e.get("atts");if(f){f.forEach(function(g){e[g.key]=g.value})}};this._initElements=function(e){var f=e.get("option");e._elementsSeletor=f.elementsSelector;e._refreshElements()};this._initEvents=function(e){var f=e.get("option");e._events=f.events;e._delegateEvents()};this._refreshElements=function(f){var g,i,h,e;h=f._elementsSeletor;if(!h){return}f._elements=f._elements||{};e=[];for(g in h){i=h[g];e.push(f._elements[i]=f.el.getElements(g))}return e};this._delegateEvents=function(e){var f=e._events,g;if(!f){return}f.forEach(function(h){if(!h[0]||!h[1]||!h[2]){return}g=h[2];if(typeof g=="function"){g=h[2].bind(e)}else{if(e[g]){g=e[g].bind(e)}else{g=null;throw new Error("method "+g+" no exsit")}}if(!h[0]){g&&e.el.addEvent(h[1],g)}else{g&&e.el.delegate(h[0],h[1],g)}h[2]=g})};this._undelegateEvents=function(e){var f=e._events,g;if(!f){return}f.forEach(function(h){g=h[2];if(!h[0]){g&&e.el.removeEvent(h[1],g)}else{g&&e.el.undelegate(h[0],h[1],g)}})};this._initModels=function(e){var g=e.get("option");e._modelsContent=g.models;if(e.__modelsContent){return}var i=e._modelsContent,f,h,j;e._models=e._models||{};i.forEach(function(k){f=k[0],h=k[1],j=k[2];if(!f||!f.id){return}if(typeof j=="function"){j=j.bind(e)}else{if(j&&e[j]){j=e[j].bind(e)}else{if(j){throw new Error("no method for method event: "+h)}}}f.addEvent(h,j);e._models[f.id]=f})};this.initialize=function(e,h){var g,f;e.set("option",h);e.set("atts",h.atts);e._initEl();e._initInstanceFuncs();e._initAtts();e._initElements();e._initEvents();e._initModels();e._setEngine(h.engine||"Mustache");if(e.init){e.init()}};this.destory=function(e){e._undelegateEvents()};this._setEngine=function(e,f){switch(f){case"Mustache":e._engine=window.Mustache;e.render=function(h,g,i){d.wrap(h);h.setHTML(e._engine.to_html(g,i))};break}if(!e._engine){throw new Error("no tpl engine can use"+f)}}});a.Model=new Class(function(){Class.mixin(this,c.Events);this.TOTALCOUNT=0;this.MODELS={};this.PREFIX="objectmodel_";this.getModel=classmethod(function(e,f){if(e.get("MODELS")[f]){return e.get("MODELS")[f]}return null});this.addModel=classmethod(function(e,f){var g=e.get("MODELS");if(!g[f.id]){g[f.id]=f;e.set("TOTALCOUNT",(e.get("TOTALCOUNT")+1))}});this.delModel=classmethod(function(e,g){var f=e.get("MODELS");if(f[g]){delete f[g];e.set("TOTALCOUNT",(e.get("TOTALCOUNT")-1))}});this._generateId=classmethod(function(e){var g=e.get("PREFIX"),f=e.get("TOTALCOUNT");return g+f.toString()});this.option=property(function(e){return e.__option},function(e,f){e.__option=f;e.name=f.name});this._reset=function(f){var e=a.Model,g=f.get("option"),h=e._generateId();f.id=h;f.name=g.name||f.id;f.recordsCount=0;f.records=[]};this._circulate=function(f,e){e.forEach(function(g){f.createRecord(g)});f.fireEvent("loaded records",{records:f.records})};this.initialize=function(f,g){var e=a.Model;f.set("option",g);f._reset();if(g.autoLoad){f.load(g)}e.addModel(f)};this.load=function(h,i){var f,j,e,g;f=function(k){if(k){h._circulate(k)}};i=i||h.get("option"),g=i.items;if(!i.append){h.removeAllRecords()}if(g){h._circulate(g);return}if(i.requestController&&i.requestController.getData){j=i.requestController;e=i.customConfig||{};e.cb=f;j.getData(e)}};this.filter=function(g,h){var e=[],f=g.records;f.forEach(function(j,k){if(h(j,k)){e.push(j)}});return e};this.propSelector=function(e,i,g,h){var f=function(j){if(h){return(j[i]!==undefined&&j[i].indexOf(g)!=-1)}else{return(j[i]!==undefined&&j[i]==g)}};return e.filter(f)};this.propMap=function(g,h){var e=[],f=g.records;f.forEach(function(i){if(i[h]){e.push(i[h])}});return e};this.createRecord=function(e,h){var f={},i=e.recordsCount,g=e.get("option");object.extend(f,h);f._id=i;if(g.customHandleData){g.customHandleData(f)}e.records.push(f);e.recordsCount++;e.fireEvent("created record",{record:f});e.fireEvent("updated records",{records:e.records});return f};this.removeRecord=function(f,h){var e=f.propSelector("_id",h)[0],g;if(e){g=f.records.indexOf(e);f.records.splice(g,1);f.fireEvent("remove record",{record:e});return e}};this.removeAllRecords=function(e){e.records=[];e.fireEvent("removeall records")};this.destory=function(e){e.removeAllRecords();e.get("delModel")(e.id)}})});XN.namespace("app.share");function show_or_hide(c,b,a){if(c=="show"){$("share_comment_"+b).style.display="block"}else{if(c=="hide"){$("share_comment_"+b).style.display="none";$("share_footer_"+b).style.display="block";$("share_"+b).scrollIntoView()}}}function share_hide_comments(b,a){ge("share_comment_"+b).style.display="none";show_or_hide("hide",b,a)}function share_show_comments(b,a,d){var c=$("boxcont_"+b);var e={share_id:b,share_owner:a};new XN.net.xmlhttp({url:"http://share."+XN.env.domain+"/share/showcomment.do",data:"post="+XN.json.build(e),onSuccess:function(f){c.innerHTML=f.responseText;object.use("xn.mention",function(g,h){h.mention.Mention.init([{obj:$("comment"+b),ugcId:"",ugcType:"share",ownerId:XN.user.id}])});$("comment"+b).focus()},onError:function(){alert("加载回复失败")}});show_or_hide("show",b,a)}function share_reply_comment(a,f,c,e){var d=$("comment_form_"+a);d.repetNo.value=f;if(e){d.replyToCommentId.value=e}if(!window._replyTextFix){window._replyTextFix={}}var b=d.comment.value;if(!!_replyTextFix[a]){b=b.replace(_replyTextFix[a].preText,"")}_replyTextFix[a]={preText:"回复"+c+":"};d.comment.value=_replyTextFix[a].preText+b;new XN.FORM.inputHelper(d.comment).focus()}function share_add_comment_submit(b,g){var e=$("comment_form_"+b);var a=e.comment.value;if(XN.STRING.isBlank(a)){XN.DO.showError("评论内容不能为空");return false}if(a.length>500){XN.DO.showError("评论内容不能超过500字");return false}var c=$("ajax_msgerror");if(c){c.parentNode.removeChild(c)}e.submit_comment.disabled=true;var f=XN.form.serialize($("comment_form_"+b),"hash");new XN.net.xmlhttp({url:"http://share."+XN.env.domain+"/share/addcomment.do",data:XN.form.serialize("comment_form_"+b),onSuccess:function(i){var l=i.responseText;if(!l.match(/<.+?>/g)||l.match(/<.+?>/g).length===0){if(l=="needVerfy"){try{if(!$("shareVerifyPic_"+b)){var d=new Image();d.className="validate-num";d.id="shareVerifyPic_"+b;d.onclick="this.src+=Math.random();return false";d.src="http://icode."+XN.env.domain+"/getcode.do?t=shareInfoCode"+b+"&r="+Math.random();$("shareVerify_"+b).appendChild(d)}$("shareVerify_"+b).show()}catch(k){XN.log(k.description)}XN.DO.alert("您的验证码输入错误，请重新输入验证码")}else{if(!l.length==0){XN.DO.alert(l)}}}else{var h=XN.dom.getElementsByClassName("replies",$("commContainer_"+b));var j=$(h[h.length-1]);j.show();j.appendHTML(l);if(!l.match("ajax_msgerror")){e.comment.value=""}try{if($("sysnblog")){$("sysnblog").checked=true;$("sysnblog").disabled=false}}catch(k){}}try{if($("shareVerifyPic_"+b)){$("shareVerifyPic_"+b).src+=Math.random();$("shareInfoCode"+b).value="";$("shareInfoCode"+b).blur()}}catch(k){XN.log(k.description)}try{if(!!$("doShare"+b)&&$("doShare"+b).checked){shareThat(f)}if(!!$("doShare")&&$("doShare").checked){shareThat(f,g)}if(!!$("doShare")){$("doShare").checked=false;$("doShare").disabled=false}if(!!$("doShare"+b)){$("doShare"+b).checked=false;$("doShare"+b).disabled=false}}catch(k){XN.log(k.description)}e.submit_comment.disabled=false;e.repetNo.value=0;e.replyToCommentId.value=0},onError:function(){alert("回复失败");e.submit_comment.disabled=false}})}function shareThat(e,f){var b=e.shareId;var c=e.shareOwner;var f=f||"0101090901";var a={action:"add",auth:99,body:encodeURIComponent(XN.string.ltrim(e.comment.replace(/[\r\n]/g," ")).replace(/"/g,"&quot;"))};new XN.NET.xmlhttp({url:"http://share.renren.com/share/submit.do",data:"shareId="+b+"&shareUserId="+c+"&post="+XN.json.build(a)+"&from="+f,onSuccess:function(g){var d=XN.json.parse(g.responseText);if(d.status==1){XN.DO.showError("分享失败："+d.msg)}},onError:function(){XN.DO.showError("分享失败！")}})}function share_delete_comment(h,c,b,d){var a="0";try{a=$(h).parent("dd").getAttribute("id").substr(8);if(a==""||a==null){a="0"}}catch(g){a="0"}var f="确定要删除吗?";if(XN.page&&XN.page.data&&(XN.page.data.type==1||XN.page.data.type==3)&&XN.page.data.isAdmin){f+='<label style="display:block;margin-top:5px;"><input id="banReply" type="checkbox" value="1"> 同时将该用户加入黑名单</label>'}XN.DO.confirm({title:"删除该评论",msg:f,callBack:function(l){if(l){try{var k=Sizzle("#comment_"+a+" > a.avatar")[0].getAttribute("href");k=k.match(/\bid=(\d+)\b/)[1];var n=jQuery("#banReply").is(":checked")?1:0;if(n){jQuery.post("http://page.renren.com/ajaxBanFans",{pid:XN.page.data.id,ban:n,createId:k})}}catch(m){XN.log(m)}var j={share_id:c.toString(),share_owner:b.toString(),comment_id:a};var i=$("comment_"+a);i.setContent(new XN.NET.xmlhttp({url:"http://share."+XN.env.domain+"/share/deletecomment.do",data:"post="+encodeURIComponent(XN.JSON.build(j)),onSuccess:function(){i.parentNode.removeChild(i);try{var q=XN.dom.getElementsByClassName("replies");var o=q[q.length-1].getElementsByTagName("dd").length;if(o==0){XN.element.hide(q[q.length-1])}}catch(p){XN.log(p)}},onError:function(){alert("删除错误")}}))}}})}function share_show_add_comment(e,b){var d=e.parentNode;remove_node(d);var c=$("add_comment_input"+b);show(c);var a=$("add_comment_button"+b);a.disabled=false;var f="comment"+b;$(f).focus();return false}function shareonkeydown(b){var a=(b.which)?b.which:window.event.keyCode;if(a==13){sharelink1();return}}function sharelink1(){var c=$("sharelink").weblink.value;var b=/\s/ig;c=c.replace(b,"");if((c=="")||(c=="http://")||(c=="在这里输入你要分享的站外链接、视频、音频的地址")){alert("请输入一个网址");return false}if(c.substr(0,7)!="http://"&&c.substr(0,6)!="ftp://"&&c.substr(0,8)!="https://"){c="http://"+c;$("isUrl").value=c}if(new RegExp("^http://([A-Za-z0-9.]*)"+XN.env.domain_reg,"i").test(c)){alert("站内内容可以直接分享，此处请分享站外内容");return false}var a=$("share-pre");a.style.display="none";document.sharelink.submit();var d=$("share-pre-hidden");d.style.display="block";d.src="http://s.xnimg.cn/img/upload_progress.gif"}XN.dom.ready(function(){var a=$("friendsPanel");if(a){var b=new XN.ui.friendSelectorWithMenu({autoSelectFirst:true});a.setContent(b);b.menu.setWidth(b.input.offsetWidth);b.addEvent("select",function(c){if(location.href.indexOf("http://blog."+XN.env.domain+"")!=-1){location.href="http://blog."+XN.env.domain+"/friendsBlog.do?friend="+c.id}else{if(location.href.indexOf("http://share."+XN.env.domain+"")!=-1){location.href="http://share."+XN.env.domain+"/share/ShareList.do?select=1&id="+c.id}}});new XN.FORM.inputHelper(b.input).setDefaultValue("输入好友姓名...")}});$extend(XN.app.share,{shareSubmit:function(){var c=XN.DOM.getElementsByClassName("vote-item","input");var e;for(var d=0;d<c.length;d++){if(c[d].value.length>20){XN.DO.alert("每个投票选项不能超过20个字");return false}}var a=XN.DOM.getElementsByClassName("input-button",$("shareForm"))[0];a.disabled=true;var b=XN.form.serialize($("shareForm"));var g="/share/ajaxSaveShare.do";var f=new XN.net.xmlhttp({url:g,data:b,onSuccess:function(i){if(i.responseText.indexOf("<title>校内 人人网 - 抱歉，出错了。</title>")!=-1){XN.DO.alert("服务器出错,请稍候重试");return}var h=XN.JSON.parse(i.responseText);if(h.code!=0){a.disabled=false;if(h.code==-7){XN.DO.confirm({msg:h.msg,title:"提示",callBack:function(j){location.href="http://share."+XN.env.domain}});return false}XN.DO.alert(h.msg)}else{location.href=h.msg}},onError:function(){XN.DO.alert("服务器出错,请稍候重试");a.disabled=false}});return false},checkForm:function(){var a=XN.DOM.getElementsByClassName("vote-item","input");if(a.length==0){return}for(var b=0;b<a.length;b++){(function(){var c;XN.event.addEvent(a[b],"focus",function(d){c=new checkMaxLength(XN.event.element(d||window.event));c.startCheck()});XN.event.addEvent(a[b],"blur",function(d){if(c){c.stopCheck()}})})()}},updateVoteUI:function(c){var b=XN.DOM.getElementsByClassName("pitem",$("share-vote-info"),"div");$("totalVoteCount").innerHTML=parseInt($("totalVoteCount").innerHTML,10)+1;var d=c.options;for(var a=0;a<b.length;a++){(function(e){var f=b[e].id.replace("item_","");$("bar_"+f).style.width=parseInt(d[e].percent*160/100,10)+"px";$("itemCount_"+f).innerHTML=d[e].count;$("itemPercent_"+f).innerHTML="("+d[e].percent+"%)"})(a)}},toggleVoteItems:function(){if(!!!$("summary-wrap")){return}var a=$("summary-wrap").getElementsByTagName("a")[0];if($("vote-item-list")){XN.EVENT.addEvent(a,"click",function(b){XN.EVENT.element(b||window.event).toggleClass("itemsClose");$("vote-item-list").toggleClass("hide")})}},itemToggle:function(){var b=XN.DOM.getElementsByClassName("pitem",$("share-vote-info"),"div");if(b.length==0){return}var c="/share/ajaxVoteShare.do";for(var a=0;a<b.length;a++){b[a].onmousemove=(function(d){return function(){var e=XN.DOM.getElementsByClassName("voteTip",this)[0];this.style.background="#c9dcec";e.style.visibility="visible"}})(a);b[a].onmouseout=(function(d){return function(){var e=XN.DOM.getElementsByClassName("voteTip",this)[0];this.style.background="#FFFFFF";e.style.visibility="hidden"}})(a);b[a].onclick=(function(d){return function(){var e=XN.array.toQueryString({optionId:this.id.replace("item_",""),shareId:$("shareSourceId").value,shareOwner:$("shareSourceOwner").value,tsc:$("shareTsc").value});var f=new XN.net.xmlhttp({url:c,data:e,onSuccess:function(h){var g=XN.json.parse(h.responseText);if(g.code!=0){XN.DO.showMessage(g.msg,"友情提醒")}else{XN.app.share.updateVoteUI(g);if(parseInt($("shareSourceOwner").value,10)!=XN.cookie.get("id")){XN.app.share.shareAfterVote()}}},onError:function(g){XN.DO.alert("服务器繁忙，请稍候重试")}})}})(a)}},shareAfterVote:function(){var a=XN.DO.confirm({title:"分享给好友",message:"内容很精彩，分享给好友？",callBack:function(b){if(b){var c=new XN.net.xmlhttp({url:"/share/ajaxSaveVoteShare.do",data:XN.array.toQueryString({shareId:$("shareSourceId").value,shareUserId:$("shareSourceOwner").value,tsc:$("shareTsc").value}),onSuccess:function(e){var d=XN.json.parse(e.responseText);if(d.code!=0){XN.DO.showMessage(d.msg,"分享提示")}else{XN.DO.showMessage("分享成功！")}},onError:function(){XN.DO.alert("服务器繁忙，请稍候重试")}})}}})}});function checkMaxLength(b){var a=this;this.max=30;this.checkFun=function(){var d=XN.DOM.getElementsByClassName("share-check-msg",b.parentNode,"span");if(b.value.length>=20){b.value=b.value.substr(0,20);if(d.length==0){var c=document.createElement("span");c.className="share-check-msg";c.style.cssText="position:relative;right:0px;text-align:right;display:block;top:-7px;";c.innerHTML="最多只能输入20个字";b.parentNode.appendChild(c);XN.event.addEvent(b,"keydown",function(f){XN.event.element(f||window.event).value=XN.event.element(f||window.event).value.substr(0,20)})}else{d[0].style.display="block"}}else{if(d.length!=0){d[0].style.display="none"}}};this.startCheck=function(){this._timer=setInterval(this.checkFun,200)};this.stopCheck=function(){clearInterval(this._timer);this._timer=null}}XN.app.share.hotShareRoll=function(){var f,d=4000;var k=1;var j=$("previewImg");var n=$("previewLink");var e=$("share_hot_video_list").getElementsByTagName("a");var a=$("share_hot_video_from");var b=$("share_hot_video_count");var i=$("share_hot_video_quote");var g=$("share_hot_video_btn");var m=null;var l=function(o){if(!$(o)||!$("share_list_change")){clearTimeout(f);return false}h(o);var q=o.getAttribute("data-share");document.getElementById("share_list_change").setAttribute("data-share",q);var p=k?k-1:e.length-1;if(/current/.test(e[p].parentNode.className)){XN.element.delClass(e[p].parentNode,"current")}if(m){XN.element.delClass(m.parentNode,"current")}XN.element.addClass(o.parentNode,"current")};var h=function(o){var p=o.href;var q=XN.json.parse(o.getAttribute("vinfo").replace(/[\n\r\t]/g,""));j.src=q.img;n.href=p;n.title=o.title;a.setContent("来源:"+q.from);b.setContent("分享:"+q.count+"次");if(XN.string.trim(q.quote).length>0){q.quote='<img class="quote-l" src="'+XN.env.CDNstaticRoot+'a.gif"/>'+q.quote+'<img class="quote-r" src="'+XN.env.CDNstaticRoot+'a.gif"/>'}else{q.quote="&nbsp;"}i.setContent(q.quote);if(g){g.onclick=function(){create_share_div(q.shareInfo[0],q.shareInfo[1],q.shareInfo[2])}}};var c=function(){f=setTimeout(function(){l(e[k]);f=setTimeout(arguments.callee,d);k==e.length-1?k=0:k+=1},d)};XN.array.each(e,function(p,o){XN.event.addEvent(o.parentNode,"mouseover",function(s){var q=XN.event.element(s);if(q.tagName.toLowerCase()==="li"){q=q.getElementsByTagName("a")[0]}var r=q.getAttribute("data-share");document.getElementById("share_list_change").setAttribute("data-share",r);clearTimeout(f);var t=k?k-1:e.length-1;XN.element.delClass(e[t].parentNode,"current");h(q);if(m){XN.element.delClass(m.parentNode,"current")}XN.element.addClass(q.parentNode,"current");m=q});XN.event.addEvent(o.parentNode,"mouseout",function(q){c()})});$("previewLink").onmouseover=function(o){clearTimeout(f)};$("previewLink").onmouseout=function(o){c()};c()};XN.DOM.readyDo(function(){if($("previewImg")&&$("previewLink")){XN.app.share.hotShareRoll()}});var edmComments={};edmComments.urls={reply:"http://status."+XN.env.domain+"/feedcommentreply.do",getList:"http://status."+XN.env.domain+"/feedcommentretrieve.do",del:"http://status."+XN.env.domain+"/feedcommentdelete.do"};edmComments.tplComment=function(b,d){var a='<div class="statuscmtitem clearfix" id="{{commentType}}comment_{{id}}">                {{#showDelete}}                    <span class="float-right">                        <a class="x-to-hide" onclick="share_del_edm_ct({{edmId}}, {{id}});" href="javascript:void(0)"></a>                    </span>                {{/showDelete}}                <a class="minfriendpic" style="background-image: url({{replyer_tinyurl}})" namecard="{{ubname}}" title="{{ubname}}" href="http://www.renren.com/profile.do?id={{ubid}}"></a>                <p class="replybody">                    <a title="{{liveUserTitle}}" href="http://www.renren.com/profile.do?id={{ubid}}" class="{{liveUserClass}}" namecard="{{ubname}}">{{ubname}}</a>:                    {{#iconUrl}}                        <a title="VIP" target="_blank" href="http://i.renren.com/index.action?wc=290000"><img alt="VIP" src="{{vipIconUrl}}"></a>                    {{/iconUrl}}                    <span class="replycontent">{{{replyContent}}}</span>                    <br />                    <span class="btn-box">                        {{#showReply}}                            <a class="btn-reply" onclick="share_reply_comment({{edmId}}, {{ubid}}, \'{{ubname}}\', {{id}}) ;return false" href="#nogo">回复</a>                        {{/showReply}}                    </span>                    <span class="time">{{replyTime}}</span>                </p>            </div>',c;d.edmId=b;d.showReply=(d.ubid!=XN.user.id);d.showDelete=(d.ubid==XN.user.id);c=Mustache.to_html(a,d);return c};edmComments.getComments=function(c,f,d){if(XN.string.trim($("boxcont_"+d).innerHTML)!==""){var e=$("share_comment_"+d);e.getStyle("display")!=="none"?e.hide():e.show();return}var a={doingId:c,owner:f,source:c,feedId:0,t:5};var g=function(n){edmComments.curIsAdmin=XN.json.parse(n.responseText).isAdmin;var h=['<div class="statuscmtlist" id="commContainer_'+c+'">'];var m=XN.json.parse(n.responseText).replyList;for(var l=0,k=m.length;l<k;l++){h.push(edmComments.tplComment(c,m[l]))}h.push("</div>",'<div class="postcomment">','    <form onkeydown="if(event.keyCode == 13 &amp;&amp; event.ctrlKey){share_rp_edm_ct('+c+');}" id="comment_form_'+c+'" onsubmit="return false;" method="post">','        <textarea class="cmtbody w370" id="comment'+c+'" name="comment"></textarea>','        <p class="postbtn">','            <input type="button" onclick="share_rp_edm_ct('+c+');" class="input-button" value="发表评论" name="submit_comment" id="submit_comment">','            <input type="button" onclick="$(\'share_comment_'+d+'\').hide();" class="input-button gray" value="取消">',"        </p>",'        <input type="hidden" id="repetNo" name="repetNo" value="0">','        <input type="hidden" id="currentShareOwner_'+c+'"  value="'+f+'">','        <input type="hidden" id="shareId_'+c+'"  value="'+d+'">',"    </form>","</div>");$("share_comment_"+d).show();$("boxcont_"+d).setContent(h.join(""))};var b=function(h){XN.DO.showMessage("回复失败，请稍候重试")};new XN.net.xmlhttp({url:edmComments.urls.getList,data:XN.array.toQueryString(a),onSuccess:g,onError:b})};edmComments.replyComment=function(d){var b=$("comment_form_"+d).repetNo.value;var a={doingId:$("shareId_"+d).value,owner:$("currentShareOwner_"+d).value,rplayerId:b,replyTo:b,source:d,feedId:0,c:$("comment"+d).value,t:5};var e=function(i){var g=XN.json.parse(i.responseText);g.ubid=g.replyerId;g.ubname=g.replyerName;g.replyer_tinyurl=g.replyerHead;var f=edmComments.tplComment(d,g);var h=XN.dom.getElementsByClassName("statuscmtlist",$("cmtContainer_"+d),"div")[0];h.innerHTML+=f;$("comment"+d).value=""};var c=function(f){XN.DO.showMessage("回复失败，请稍候重试")};if(XN.string.isBlank(a.c)){XN.DO.alert("评论内容不能为空");return false}new XN.net.xmlhttp({url:edmComments.urls.reply,data:XN.array.toQueryString(a),onSuccess:e,onError:c})};edmComments.delComment=function(d,a){var b={doingId:d,owner:0,replyId:a,feedId:0,source:d,t:5};var f=function(g){$("comment_"+a).remove()};var c=function(g){XN.DO.showMessage("删除错误，请稍后重试。")};var e=function(){new XN.net.xmlhttp({url:edmComments.urls.del+"?"+XN.array.toQueryString(b),method:"GET",onSuccess:f,onError:c})};XN.DO.confirm({title:"删除该评论",msg:"确定要删除吗?",callBack:function(g){if(g){e()}}})};window.share_del_edm_ct=edmComments.delComment;window.share_show_edm_comments=edmComments.getComments;window.share_rp_edm_ct=edmComments.replyComment;(function(){var a=function(){var c=(window.asyncHTMLManager?asyncHTMLManager:window)["location"].href,g=(function(i){return function(j){return XN.string.getQuery(j,i)}})(c),f=g("comment"),e=g("share_id"),b=g("edmId"),d=g("userid"),h=g("id");if($("isUrl")&&!f&&!(/share_\d+/).test(location.hash)){setTimeout(function(){new XN.form.inputHelper($("isUrl")).focus()},2000)}if(!f||!e){return false}$("share_comment_"+e).scrollIntoView();if(!b){share_show_comments(e,d)}else{share_show_edm_comments(b,h,e)}};if(window.asyncHTMLManager){window.asyncHTMLManager.addEvent("load",a)}else{XN.dom.ready(a)}})();XN.app.share.CommentManger={};(function(a){a.init=function(f){this._options={};$extend(this._options,f);this.initTabs();this.initProxy();try{var d=getActiveILike(),c=this;d.addEvent("startAdd",function(){c.tabView.setCurrentTab("friendCmts")});d.addEvent("remove",function(){c.tabView.setCurrentTab("friendCmts")})}catch(b){XN.log(b)}};a.initTabs=function(){var b=this;this.tabs=[];this.tabView=new XN.ui.tabView({selectedClass:"select"});XN.array.each(this.getOptions("tabs"),function(d,c){var e=(c.content==b.getOptions("activeTab"));b.tabs.push(c.tab);b.tabView.addTab({label:c.tab,content:c.content,active:e,onActive:function(){b.activeTab=c.tab;b.onTabChange(this)}});if(e){b.activeTab=c.tab}})};a.onTabChange=function(b){$(this.getOptions("cmtForm")).reset();$(this.getOptions("cmtToInput")).value=0};a.initProxy=function(){var b=this;XN.event.addEvent(this.getOptions("cmtsListCon"),"click",function(f){var c=XN.event.element(f||window.event),d=c.getAttribute("cmd");if(d){d=XN.json.parse(d);switch(d.t){case"reply":b.replyCmt(d);break;case"del":b.delCmt(d);break}}})};a.delCmt=function(d){var e=this,c=d;var b=function(g){if(!g){return false}var f={share_id:c.sid,share_owner:c.oid,comment_id:c.cid};new XN.NET.xmlhttp({url:"http://share."+XN.env.domain+"/share/deletecomment.do",data:"post="+encodeURIComponent(XN.JSON.build(f)),onSuccess:function(i){var h=XN.json.parse(i.responseText);if(h.status!=1){XN.DO.showError(h.msg)}else{if(h.status==1){XN.array.each(e.tabs,function(k,j){if($(j+"_comment_"+c.cid)){$(j+"_comment_"+c.cid).remove()}if($(j+"_comment_list").getElementsByTagName("dd").length==0){$(j+"_comment_list").hide()}})}}},onError:function(){alert("删除错误")}})};XN.DO.confirm({title:"删除该评论",msg:"确定要删除吗?",callBack:b})};a.save=function(){var e=$(this.getOptions("cmtForm")),b=e.comment.value,f=this,d=this.getOptions("shareId");if(XN.STRING.isBlank(b)){XN.DO.showError("评论内容不能为空");return false}if(b.length>500){XN.DO.showError("评论内容不能超过500字");return false}var c=$("ajax_msgerror");if(c){c.parentNode.removeChild(c)}e.submit_comment.disabled=true;var g=XN.form.serialize(e,"hash");if(f.activeTab=="allCmts"){g.all=1;if(e.repetNo.value!=0){g.preComment=f.toCmtId}}new XN.net.xmlhttp({url:"http://share."+XN.env.domain+"/share/comment/addterm",data:XN.array.toQueryString(g),onSuccess:function(i){var l=XN.json.parse(i.responseText);if(l.code!=0){if(l.needVerfy==true){try{if(!$("shareVerifyPic_"+d)){var h=new Image();h.className="validate-num";h.id="shareVerifyPic_"+d;h.onclick="this.src+=Math.random();return false";h.src="http://icode."+XN.env.domain+"/getcode.do?t=shareInfoCode"+d+"&r="+Math.random();$("shareVerify_"+d).appendChild(h)}$("shareVerify_"+d).show()}catch(j){XN.log(j.description)}XN.DO.alert("您的验证码输入错误，请重新输入验证码")}else{XN.DO.showError(l.msg)}}else{if(l.code==0){var k=XN.json.parse(l.msg);if(f.activeTab=="allCmts"&&e.repetNo.value!=0){$("allCmts_comment_list").appendHTML(f.buildOneCmt(k))}else{XN.array.each(f.tabs,function(n,m){$(m+"_comment_list").show();$(m+"_comment_list").appendHTML(f.buildOneCmt(k,m))})}if(!!$("doShare")&&$("doShare").checked){f.shareThis(g)}}}try{if($("shareVerifyPic_"+d)){$("shareVerifyPic_"+d).src+=Math.random();$("shareInfoCode"+d).value="";$("shareInfoCode"+d).blur()}}catch(j){XN.log(j.description)}e.submit_comment.disabled=false;e.comment.value="";if($("sysnblog")){$("sysnblog").checked=true;$("sysnblog").disabled=false}if($("doShare")){$("doShare").checked=false;$("doShare").disabled=false}e.repetNo.value=0;e.replyToCommentId.value=0},onError:function(){alert("回复失败");e.submit_comment.disabled=false}})};a.shareThis=function(d){var c=d.shareId;var e=d.shareOwner;var b={action:"add",auth:99,body:encodeURIComponent(XN.string.ltrim(d.comment.replace(/[\r\n]/g," ")).replace(/"/g,"&quot;"))};new XN.NET.xmlhttp({url:"http://share.renren.com/share/submit.do",data:"shareId="+c+"&shareUserId="+e+"&post="+XN.json.build(b)+'&from="0101030901"',onSuccess:function(f){},onError:function(){XN.DO.showError("分享失败！")}})};a.replyCmt=function(b){share_reply_comment(b.sid,b.oid,b.oname,b.id||b.cid);this.toCmtId=b.cid};a.quickShare=function(){var e=this,b=$(this.getOptions("cmtForm")),d=106,c=$(b.comment).realTop()-122;XN.Do.confirm({title:"评论成功",message:'<center><img src="http://a.xnimg.cn/imgpro/icons/yes.png"/> 评论成功了，将精彩内容也分享给好友吧</center>',params:{showCloseButton:true},width:300,X:d,Y:c,callback:function(f){if(!f){return false}var g=new XN.net.xmlhttp({url:"http://share."+XN.env.domain+"/share/ajaxSaveVoteShare.do?from=shareaftercomment",data:XN.array.toQueryString({shareId:e.getOptions("shareId"),shareUserId:e.getOptions("shareOwner"),tsc:XN.get_check}),onSuccess:function(i){var h=XN.json.parse(i.responseText),j;if(h.code!=0){j=XN.DO.confirm({title:"分享提示",message:h.msg,X:d,Y:c})}else{j=XN.DO.confirm({title:"提示",message:"分享成功",X:d,Y:c})}j.footer.hide();setTimeout(function(){j.hide()},3000)},onError:function(){XN.DO.alert("服务器繁忙，请稍候重试")}})}})};a.buildOneCmt=function(j,c){var i=this,l=i.getOptions("isAdmin")=="true"?true:false,q=parseInt(XN.cookie.get("id"),10),m=this.getOptions("shareId"),o=this.getOptions("shareOwner"),b=j,r="";var n=b.keepUse?" lively-user":"";var d=b.keepUse?"连续登录7天, 即可获得橙名特权":b.name;var g="";var h="http://admin.renren.com/admin/newuserreport.do?type=30&owner="+o+"&contentId="+b.id+"&userId="+b.author+"&origURL="+encodeURIComponent(document.location.href);var p=j.isVip;var s=j.vipIconUrl;if(!b.showDelete&&!(i.activeTab=="allCmts")){g='<span class="float-right"><a target="_blank" href="'+h+'" class="reply-report" style="display: none;">举报</a></span>'}r+='<dd id="'+c+"_comment_"+b.id+'">'+g+'     <a class="avatar" namecard="'+b.author+'" title="'+b.name+'" href="http://www.'+XN.env.domain+"/profile.do?id="+b.author+'">            <img height="50" width="50" src="'+b.headUrl+'" alt="'+b.name+'" class="avatar"/>     </a>     <div class="info">';if(b.showDelete){r+='            <span class="float-right">                 <a class="x-to-hide" cmd="{t:\'del\',sid:'+m+",oid:"+o+",cid:"+b.id+'}" href="javascript:void(0)"></a>            </span>'}r+='<a namecard="'+b.author+'" title="'+d+'" href="http://www.'+XN.env.domain+"/profile.do?id="+b.author+'" class="'+n+'">'+b.name+"</a> ";if(b.vipIconUrl){r+='<a title="VIP" target="_blank" href="http://i.renren.com/index.action?wc=290000"><img alt="VIP" src="'+s+'"></a>'}r+='</div>      <div class="reply">            <p class="content" style="display: block">'+b.body+"            </p>";r+='<div class="control-box clearfix">';r+='<span class="time"> '+b.time+" </span>";r+='<div class="btn-box">';if(XN.user&&XN.user.id&&(b.liked!==undefined)&&(b.likeCount!==undefined)){var e="<a style=\"margin-left: 10px;\" class=\"ilike_comment\" comment-data=\"{'stype':'share','cid':'{{commentId}}', 'rid':'{{resourceId}}', 'uid':'{{userId}}', 'oid':'{{ownerId}}', 'roid':'{{resourceUserId}}', 'name':'{{userName}}', 'url':'{{url}}', 'liked':{{islike}} }\" href=\"javascript:void(0)\">{{comment}}</a>",f={commentId:b.id,ownerId:b.author,resourceId:m,resourceUserId:o,userId:XN.user.id,userName:XN.user.name,url:"http://share.renren.com/share/"+o+"/"+m,islike:b.liked,comment:b.liked?((b.likeCount===0)?"取消":b.likeCount+" 取消"):((b.likeCount===0)?"喜欢":b.likeCount+" 喜欢")},k=Mustache.to_html(e,f);r+=k}if(q!==b.author){if(i.activeTab!="allCmts"){r+=" &nbsp; <a cmd=\"{t:'reply',sid:"+m+",oid:"+b.author+",oname:'"+b.name+"',cid:"+b.id+'}" href="javascript:void(0);">回复</a>'}}r+="</div>";r+="</div>";r+="      </div></dd>";return r};a.getMoreCmt=function(d,c){var e,h=this;this.share_owner=c;this.share_id=d;var b=function(){var j=$(h.activeTab+"_commContainer_"+d).getElementsByTagName("dd")[0];return j.id.match(/\d+/)[0]};var g={shareId:d,owner:c,commentId:b()};if(h.activeTab=="allCmts"){e="http://share."+XN.env.domain+"/share/comment/moreurlcomment";$extend(g,{md5:h.getOptions("shareUrlMd5")})}else{if(h.activeTab=="friendCmts"){e="http://share."+XN.env.domain+"/share/getmorecomment.do"}}var i=function(n,j){var l=$element("dl");l.className="replies";var k=[];for(var m=0;n[m];m++){k.push(h.buildOneCmt(n[m]))}l.innerHTML=k.join("");return l};$(h.activeTab+"_tempLoading_"+d).style.visibility="visible";var f=new XN.net.xmlhttp({url:e,data:XN.array.toQueryString(g),onSuccess:function(o){$(h.activeTab+"_tempLoading_"+d).style.visibility="hidden";var k=XN.json.parse(o.responseText);if(k.code!==0){XN.DO.showError(k.msg);return false}if(k.code==0){if(!k.hasMore){$(h.activeTab+"_showMore_"+d).hide()}var n=$(h.activeTab+"_commContainer_"+d);var p=null;var m=XN.dom.getElementsByClassName("replies",n);var l=0;while(m[l]){if(!m[l].getElementsByTagName("dt").length){p=m[l];break}l++}n.insertBefore(i(k.comments,d),p)}},onError:function(j){XN.DO.showError("服务器错误，请稍后重试")}})};a.getOptions=function(b){return this._options[b]}})(XN.app.share.CommentManger);XN.dom.ready(function(){var a={};object.use("xn.mention",function(b,c){a=c.mention.Mention});if(Sizzle(".share-home #miniEditorTextarea")[0]){a.init([{obj:Sizzle(".share-home #miniEditorTextarea")[0],ugcId:"",ugcType:"share",ownerId:XN.user.id}])}if(Sizzle(".share-home #cmtbody")[0]&&Sizzle(".share-home #cmtbody").length>0){a.init([{obj:Sizzle(".share-home #cmtbody")[0],ugcId:"",ugcType:"share",ownerId:XN.user.id}])}if($("linkcmt")){a.init([{obj:$("linkcmt"),ugcId:"",ugcType:"share",ownerId:XN.user.id}])}if(Sizzle(".share-newhome #miniEditorTextarea")[0]){a.init([{obj:Sizzle(".share-newhome #miniEditorTextarea")[0],ugcId:"",ugcType:"share",ownerId:XN.user.id}])}},true);(function(a){var c="";function b(d){$extend(this,{wrapHtml:'<div class="relative-content">{{content}}</div>'});$extend(this,d);this.getHtml()}b.prototype={getHtml:function(){var d=this;new XN.net.xmlhttp({url:d.url,data:XN.array.toQueryString(d.data),onSuccess:function(e){if(XN.string.trim(e.responseText)==""){return false}d.htmlTxt=e.responseText;d.buildHtml()}})},buildHtml:function(){this.htmlContent=this.wrapHtml.replace("{{content}}","<h4>"+this.title+"</h4>"+this.prefix+this.htmlTxt+this.suffix);this.display()},display:function(){var d=this;setTimeout(function(){d.con.innerHTML=d.htmlContent},50)}};a.initRBlog=function(d){$extend(d,{title:"相关日志",prefix:'<div class="hot-blog-sidebar"><ul class="blog-list clearfix">',url:"http://rcd.renren.com/cwf_blog",suffix:"</ul></div>"});return new b(d)};a.initRVideo=function(d){$extend(d,{title:"相关视频",url:"http://rcd.renren.com/cwf_video",prefix:'<div class="shares-list">',suffix:"</div>"});return new b(d)}})(XN.app.share);var UGC_PING="http://s.xnimg.cn/a30917/performance_v1/script/client/UGC-ping.js";var sharePopUp=null;var NetWorkConfirm=function(p,l,d,c,o,b,a,m,i){var f={type:"normal",width:400,modal:false,yes:"\u786E\u5B9A",no:"\u53D6\u6D88",callBack:XN.func.empty,focus:null,addIframe:true,closeFire:false};if(!isString(p)&&!isNumber(p)){extendObject(f,p)}else{if(isString(p)||arguments.length>1){var g=arguments;XN.array.each(["message","title","callBack","yes","no","X","Y","w","h"],function(h,e){if(g[h]){f[e]=g[h]}})}}var n=f.params;delete f.params;f=extendObject({},f,n);f.callback=f.callback||f.callBack;try{currentConfirm.remove(f.modal===true)}catch(j){}var k=(new XN.ui.dialog(f)).setType(f.type).setTitle(f.title||(f.type=="error"?"\u9519\u8BEF\u63D0\u793A":"\u63D0\u793A")).setBody(f.msg||f.message||"").setWidth(f.width).setHeight(f.height).setX(f.X).setY(f.Y).addButton({text:f.submit||f.yes,onclick:function(){k.setAutoHide(true);return f.callback.call(k,true)}}).show();if(f.focus=="submit"){f.focus=f.submit}if(f.closeFire===true){k.addEvent("close",function(){f.callback.call(k,false)})}k.getButton(f.focus||f.submit||f.yes).focus();currentConfirm=k};window.__getShareName=function(a){switch(a){case"blog":return"日志";case"album":return"相册";case"photo":return"照片";case"forum":return"小组";case"thread":return"帖子";case"pageThread":return"话题";case"pageBlog":return"日志";case"pageAlbum":return"相册";default:return""}};window.__shareProtect={t1:function(){try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(a){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}},t2:function(){try{sharePopUp.dialog.error("已经被删除 :(")}catch(a){XN.DO.showMessage("已经被删除:(","友情提示")}}};XN.mstpl=function(d,b){var a={};var c=function(g,f){var e=!/\W/.test(g)?a[g]=a[g]||this.tmpl(document.getElementById(g).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+g.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return f?e(f):e};return c(d,b)};XN.copyExtralLink={btnId:"",copyVal:"",init:function(b,a){this.btnId=b;this.copyVal=a;this.createClient()},createClient:function(){var a=this._link;var b=this;if(XN.BROWSER.IE){XN.event.addEvent(b.btnId,"click",function(){if(b.clip){b.clip.reposition(b.btnId);return}})}if(typeof ZeroClipboard!="undefined"){this.createClip();return}XN.loadFile(XN.env.staticRoot+"jspro/album/ZeroClipboard.js",function(){ZeroClipboard.setMoviePath(XN.env.CDNstaticRoot+"swf/album/ZeroClipboard.swf");b.createClip()})},createClip:function(){if(this.clip){this.clip.reposition(this.btnId);this.clip.show();this.clip.setText(this.copyVal);return false}var b=this;var a=new ZeroClipboard.Client();a.setHandCursor(true);a.addEventListener("complete",function(c,d){XN.DO.showMessage('<p style="text-align:center; font-size:14px;padding:10px">已经复制到剪贴板<p>');c.hide()});a.setText(this.copyVal);a.glue(this.btnId);this.clip=a}};var XNShareObject={gFloatTimeOut:"",gCloseShareSucTimer:"",_register:function(c){if(window.gHasRunedShare){return false}if(c.autoRegister){this._registerOldInterface()}window.gHasRunedShare=true;var d=this,b="";for(var a in d){if(typeof d[a]=="function"&&!/^_(.*)/.test(String(a))){XN[a]=d[a]}else{if(/^create(.*)/.test(String(a))&&c.autoRegister){(d[a]).call(this)}else{if(/^g(.*)/.test(String(a))){window[a]=d[a]}}}}if(c.floatMode){XNShareObject._registerFloatDiv()}},_registerOldInterface:function(){var b=this.interfaceOld;for(var a in b){if(typeof b[a]=="function"&&/^create(.*)/.test(String(a))){(b[a]).call(b)}}},_base:{data:"",liveRegister:function(d,b,i,h){var g=this,e=XNShareObject._base;function f(m){var l=m.srcElement||m.originalTarget;var k=e._hitSelector(d,l);if(k&&k.data){i.call(this,h,k);if(l._bridged){return}l._bridged=true;function n(){XN.event.enableCustomEvent(XN.app);XN.app.fireEvent("bridgeSharePostSuccess",l);XN.app.share.delEvent("postSuccess",n);l._bridged=false}XN.app.share.addEvent("postSuccess",n)}}try{XN.event.addEvent(document,b,f,2)}catch(c){try{document.attachEvent("on"+b,f)}catch(a){try{document.addEventListener(b,f,false)}catch(j){throw new Error("event bind is error!")}}}},_hitSelector:function(b,a){return/^#(.*)$/.test(b)?(function(){return b.replace(/^#/,"")==a.id?(XN.json.parse(a.getData("share"))||{err:-1,e:a}):false}()):(/^\.(.*)$/.test(b)?(function(){var g=b.replace(/^\./,""),f="";try{f=a.className.split(/\s+/)}catch(j){}for(var d=0;d<f.length;d++){if(g==f[d]){var h="";try{h=a.getData("share")}catch(j){try{a=$(a);h=a.getData("share")}catch(c){h=false}}return h?{data:XN.json.parse(h),e:a,err:0}:{err:-1,e:a}}}return false}()):false)},hitSelector:function(){this._hitSelector.apply(this,arguments)},toPix:function(a){return parseInt(a,10)+"px"},toStyleString:function(c){var a=[];for(var b in c){a.push(b+":"+c[b])}return a.join(";")}},_registerFloatDiv:function(){var DOMAIN=null,CONST=null,CGI=null,XHR=null,Cfg=null,tpl=null,selector=null,vaild=null,dataSet=null,cbManager=null,request=null,shareTypeCom=null,sharePopUp=null,eventRegister=null;DOMAIN={BLOG:"http://blog."+XN.env.domain,SHARE:"http://share."+XN.env.domain,FRIEND:"http://sg."+XN.env.domain+"/s/f",EDM:"http://edm."+XN.env.domain+"/feedshare.do?",PAGE:"http://page."+XN.env.domain,APP:"http://app."+XN.env.domain,VIDEO:"http://video."+XN.env.domain,TV:"http://tv."+XN.env.domain,PHOTO:"http://photo."+XN.env.domain,XIAOZU:"http://xiaozu."+XN.env.domain,MUSIC:"http://music."+XN.env.domain,HUODONG:"http://huodong."+XN.env.domain};CONST={CHN:{TITLE_1:"分享",TITLE_2:"站内信给好友",MSG_1:"我分享的理由是...",MSG_2:"我收藏的原因是",ALERT_COMMENT:"评论字数不能超过500"}};CGI={SUBMIT:"/share/submit.do",GETSHARE:"/getshare.do",POPUP:"/share/popup.do",AJAX:"/share/ajax.do",ZHAN:"/share/popup/zhan",LINK:"/share/linkparse"};XHR=function(obj){var hasTimeout=false,cloneObj=$extend({},obj),localXHR=null;if(obj.waitTime&&obj.onTimeout){hasTimeout=true;cloneObj.onSuccess=function(r){window.clearTimeout(localXHR._timeoutTimer);obj.onSuccess(r)}}localXHR=new XN.net.xmlhttp(cloneObj);if(hasTimeout){localXHR._timeoutTimer=setTimeout(function(){obj.onTimeout.call(localXHR);try{localXHR.abort()}catch(e){XN.log(e)}},obj.waitTime)}return localXHR};Cfg={url:"",poptype:"",shareType:"",postParam:{},requestParam:{},commentMax:500,groupStack:[],feedCgiUrl:function(o){var type=o.type,owner=o.owner,id=o.id;switch(type){case"blog":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","562","share.blog",1000)}catch(ex){}});return DOMAIN.BLOG+"/blog/"+owner+"/"+id+"/homeShare";case"album":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","564","share.album",1000)}catch(ex){}});return DOMAIN.PHOTO+"/photo/"+owner+"/album-"+id+"/share";case"photo":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","565","share.photo",1000)}catch(ex){}});return DOMAIN.PHOTO+"/photo/"+owner+"/photo-"+id+"/share";case"zujiPlace":return DOMAIN.PHOTO+"/photo/zuji/"+owner+"/"+o.siteId+"/share?zujiId="+o.mt_zujiId;case"zujiPhoto":return DOMAIN.PHOTO+"/photo/zuji/"+owner+"/"+o.siteId+"/share?zujiId="+o.mt_zujiId+"&itemId="+o.itemId;case"forum":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","566","share.forum",1000)}catch(ex){}});return DOMAIN.XIAOZU+"/xiaozu/"+id+"/js";case"thread":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","567","share.thread",1000)}catch(ex){}});return DOMAIN.XIAOZU+"/xiaozu/"+id+"/thread/"+owner+"/share";case"clike":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","568","share.clike",1000)}catch(ex){}});return DOMAIN.APP+"/like/likeInfo?feed_id="+id;case"pageThread":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","569","share.pageThread",1000)}catch(ex){}});return DOMAIN.PAGE+"/"+id+"/group/"+owner+"/getShareData";case"pageBlog":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","570","share.pageBlog",1000)}catch(ex){}});return DOMAIN.PAGE+"/"+owner+"/note/"+id+"/share";case"pageAlbum":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","571","share.pageAlbum",1000)}catch(ex){}});return DOMAIN.PAGE+"/"+owner+"/album/"+id+"/share";case"pagePhoto":return DOMAIN.PAGE+"/"+owner+"/photo/"+id+"/share";case"video":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","572","share.video",1000)}catch(ex){}});return DOMAIN.VIDEO+"/ajax/getVideoInfo?ownerId="+owner+"&videoId="+id;case"tv":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","573","share.tv",1000)}catch(ex){}});return DOMAIN.TV+"/ajax/getVideoInfo?ownerId="+owner+"&videoId="+id;case"song":XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","574","share.songdu",1000)}catch(ex){}});return DOMAIN.MUSIC+"/share/json/song/"+id;case"gytv":return"http://www.uume.com/share/"+id+"/renren";case"huodong":return DOMAIN.HUODONG+"/event/share/"+id;case"huodong_pic":return DOMAIN.HUODONG+"/event/photo/share/"+id;case"wikicomment":return"http://wiki.renren.com/ajax/commentshare/commentinfo/"+id;case"custom_feed_share":return"http://widget.renren.com/feedshare/"+id;case"interview":return"http://xiaozhao.renren.com/interview/question/"+id;case"renren_huodong":var hid=o.sourceId,htype=o.huodongType;return"http://huodong.renren.com/event/feed/share?sourceType="+htype+"&sourceId="+hid;case"jebe":var adtype=o.adtype,feedId=o.feedId,creativeId=o.creativeId;return"http://mapapi.renren.com/biz/open/action/share?adtype="+adtype+"&feedId="+feedId+"&creativeId="+creativeId;case"shortvideo":return"http://mvideo.renren.com/ajax/video4Share?ownerId="+owner+"&videoId="+id;case"campusphoto":return"http://xiaoyuan.renren.com/album/share/"+owner+"/"+id;case"campusposts":return"http://xiaoyuan.renren.com/posts/share/"+owner+"/"+id}},hideTime:500,tagObject:{add:{defaultInputMsg:CONST.CHN.MSG_1,dialogTitle:CONST.CHN.TITLE_1,vaild:function(o){if(vaild.comment()){return true}return false},getPostData:function(){if($("pop_share_sendcomment")&&!$("pop_share_sendcomment").disabled){Cfg.requestParam.sendcomment=$("pop_share_sendcomment").checked}Cfg.requestParam.action="add";Cfg.requestParam.auth=99;delete Cfg.requestParam.form}},fav:{defaultInputMsg:CONST.CHN.MSG_2,dialogTitle:CONST.CHN.TITLE_1,vaild:function(){return true},getPostData:function(){Cfg.requestParam.action="add";Cfg.requestParam.auth=-1;delete Cfg.requestParam.form}},pageAdd:{defaultInputMsg:CONST.CHN.MSG_1,dialogTitle:CONST.CHN.TITLE_1,vaild:function(o){if(vaild.comment()&&pageUtil.getIds()){return true}return false},getPostData:function(){if($("pop_share_sendcomment")&&!$("pop_share_sendcomment").disabled){Cfg.requestParam.sendcomment=$("pop_share_sendcomment").checked}Cfg.requestParam.action="add";Cfg.requestParam.auth=80;Cfg.requestParam.pagelist=pageUtil.getIds();delete Cfg.requestParam.form}},send:{defaultInputMsg:CONST.CHN.MSG_1,dialogTitle:CONST.CHN.TITLE_2,vaild:function(){var data=selector.friend.getFriends();if(vaild.comment()&&vaild.friend(data)){return true}return false},getPostData:function(){Cfg.requestParam.action="sharetofriend";Cfg.requestParam.ids=selector.friend.data.getIds();Cfg.requestParam.form=XN.form.serialize("popShareParams","hash");Cfg.requestParam.subject=$("popShareSubjectInput").value}},qun:{defaultInputMsg:CONST.CHN.MSG_1,dialogTitle:CONST.CHN.TITLE_1,vaild:function(){var data=selector.qun.data;if(vaild.comment()&&vaild.qun(data)){return true}return false},getPostData:function(){Cfg.requestParam.action="sendtoqun";Cfg.requestParam.ids=selector.qun.getQunData();delete Cfg.requestParam.form}}}};tpl={msg:"<div><center>{{MSG}}</center></div>",ansyc:{add:"",fav:"",send:"",qun:""},beforePost:'<div id="share_msg_dialog" class="share-success clearfix large">正在发送请求...</div><div id="pop_share_ads"></div>',loadingHTML:function(){return'<div class="loading">                            <center>                                <img src="'+XN.env.CDNstaticRoot+'/imgpro/indicator/blue_large.gif" />                            </center>                        </div>'},shareTypeLayer:function(){return'<a href="javascript:;" class="st-now st-item add">                            <span class="st-text">发新鲜事</span>                            <span class="st-arrow st-down"></span>                        </a>                        <a href="javascript:;" class="st-select st-item fav">仅自己收藏</a>                        <a href="javascript:;" class="st-select2 st-item page">公共主页发布</a>'},shareLink:function(o){var t='<p class="gray">复制分享链接,通过QQ或者MSN发送给你的好友.</p>                               <p>                                   <input type="text" class="text-box" style="width:210px;height:20px" value="<%=url%>" id="share_success_val" />                                   <input type="button" class="input-submit" value="复制" id="share_success_btn" class="share_success_btn" />                               </p>';return XN.mstpl(t,o)},shareCallback:function(o){var t=' <div class="share-success-tip">                            <p><img src="http://a.xnimg.cn/imgpro/share/share-success.gif"/></p>                            <p>                                <%if(action=="fav"){ %>                                    <%=tips_e%>                                <%} else if(action=="qun"){ %>                                                                    <% }else{ %>                                    <%=tips_a%>                                <% } %>                            </p>                          </div>                          <div class="share-success-more">                            <div id="share_success_link"></div>                            <p>                                <%if(action=="send"){ %>                                    <%=tips_d%>                                <% } else if(action=="fav"){%>                                    <%=tips_f%>                                <% } else if(action=="qun"){%>                                    <%=tips_g%>                                <% }else{ %>                                    <%=tips_b%>                                <% } %>                            </p>                            <% if(action=="qun"){%>                                <p><%=tips_h%></p>                            <% }else{ %>                                <p><%=tips_c%></p>                            <% } %>                            <%if(adObjArry){ %>                            <p>                                <a href="<%=url%>" target="_blank" >                                    <img height="80" width="280" src="<%=img%>" />                                </a>                            </p>                            <% } %>                          </div>';return XN.mstpl(t,o)}};selector={qun:{data:null,getQunData:function(){if(!selector.qun.data){selector.qun.data=[]}else{return selector.qun.data}},addQun:function(id){selector.qun.data.push(id)},removeQun:function(id){var len=selector.qun.data.length;while(len--){if(selector.qun.data[len]==id){selector.qun.data.splice(len,1);break}}},init:function(){if(selector.qun.data){selector.qun.data.length=0}var qunCon=$("sharer_pop_qunlist"),_this=this;XN.event.addEvent(qunCon,"click",function(e){var el=XN.event.element(e||window.event),tag=el.tagName.toLowerCase(),id=0,target=e.srcElement||e.originalTarget;if(tag=="a"&&el.getAttribute("cmdtype")=="get-more"){while(Cfg.groupStack.length>0){Cfg.groupStack.pop().setStyle("display:block")}$(target).setStyle("display:none");return false}if(tag=="img"){el=el.parentNode}id=el.getAttribute("cmddata");if(el.className.indexOf("selected")!==-1){selector.qun.removeQun(id)}else{_this.addQun(id)}XN.element.toggleClass(el,"selected");XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","574","share.group.select",1000)}catch(ex){}})});this.getQunData()}},friend:{ids:null,data:null,init:function(){var friendSelector=selector.friend.data=new XN.ui.multiFriendSelector({url:DOMAIN.FRIEND,maxNum:10});friendSelector.addEvent("overMaxNum",function(n){XN.DO.showError("一次最多只能分享给"+n+"位好友^_^")});$("shareSelectFriends").setContent(friendSelector);friendSelector.reset()},getFriends:function(){return selector.friend.data.getIds()}}};vaild={comment:function(){var length=$("sharer_popup_message").value.split("").length;if(length>Cfg.commentMax){XN.DO.showError(CONST.CHN.ALERT_COMMENT);return false}return true},qun:function(d){if(d.length===0){XN.DO.showError("请至少选择一个群");return false}return true},friend:function(d){if(d.length===0){XN.DO.showError("请至少选择一个好友");return false}return true}};dataSet={defaultMsg:function(){var input=$("sharer_popup_message"),st=Cfg.shareType;msg=Cfg.tagObject[st].defaultInputMsg;if(input.value==""){}},requestParam:function(o,reset){var _getBaseData=function(){var data=XN.form.serialize($("popShareParams"),"hash");data.forwardComment=XN.form.help("sharer_popup_message").getRealValue();if($("summary")){data.summary=$("summary").innerHTML}data.noteId=$("noteId")?$("noteId").value:0;if(/^(.*?[^:]?)\/\/[^\/]+\:/.test(data.forwardComment.replace(/[\n\r]/g,""))){data.body=/^(.*?[^:]?)\/\/[^\/]+\:/.exec(data.forwardComment.replace(/[\n\r]/g,""))[1]}else{data.body=data.forwardComment}if(dataSet.postUrl(Cfg.postParam.stype).fs==1){data.body=data.forwardComment}if(Sizzle("input[type=checkbox]",$("shareAjaxResult")).length>0){data.sendcomment=Sizzle("input[type=checkbox]",$("shareAjaxResult"))[0].checked}if(location.href.indexOf("http://page."+XN.env.domain+"")==0){data.pageId=data.fromno||($("fromno")&&$("fromno").value)}if(typeof Cfg.postParam.from!=="undefined"){data.from=Cfg.postParam.from}if(typeof Cfg.postParam.shfrom!=="undefined"){data.shfrom=Cfg.postParam.shfrom}return data};var d=_getBaseData();return $extend(o,d)},postParam:function(o,delMode){if(delMode){Cfg.postParam={}}for(var key in o){Cfg.postParam[key]=o[key]}return Cfg.postParam},cmdType:function(type){var _set=function(v){Cfg.postParam.poptype=v;Cfg.poptype=v;Cfg.shareType=type};switch(type){case"add":_set(1);XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","576","share.click.add",1000)}catch(ex){}});break;case"fav":_set(1);XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","577","share.click.fav",1000)}catch(ex){}});break;case"pageAdd":_set(1);XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","577","share.click.pageAdd",1000)}catch(ex){}});break;case"send":_set(2);XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","578","share.click.send",1000)}catch(ex){}});break;case"qun":_set(3);XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","579","share.click.qun",1000)}catch(ex){}});break}},beforePost:function(type,cb){switch(type){case"create_share_video":request.getVideoPostData({url:Cfg.feedCgiUrl(Cfg.postParam),callback:function(json){dataSet.postParam(json);cb()}});break;case"create_share_feed":request.getFeedPostData({url:Cfg.feedCgiUrl(Cfg.postParam),callback:cb});break;case"create_share_edm":request.getEdmPostData({id:Cfg.postParam.id,callback:function(json){dataSet.postParam(json);cb()}});break;case"pop_share":if($("isProtected")&&$("isProtected").value=="true"){try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(ex){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}return false}var post={};try{post=XN.FORM.serialize("popShareParams","hash")}catch(e){post.link=$("link").value;post.type=$("type").value;post.title=$("title").value;post.pic=$("pic").value;post.fromno=$("fromno").value;post.fromname=$("fromname").value;post.fromuniv=$("fromuniv").value;post.albumid=$("albumid").value;post.largeurl=$("largeurl").value;if($("mainurl")){post.mainurl=$("mainurl").value}}post.summary=$("summary").innerHTML;post.content_clear=$("summary").innerHTML||"";dataSet.postParam(post);cb();break;case"pop_share_msg":var post=XN.form.serialize($("popShareParams"),"hash");dataSet.postParam(post);cb();break;case"pop_share_for_list":var index=Cfg.postParam.index;if($("isProtected")){var tInputs=$("popShareParams_"+index).getElementsByTagName("input");var i=0;while(i<tInputs.length){if(tInputs[i].getAttribute("id")=="isProtected"){if(tInputs[i].value=="true"){var tType;for(var j=0;j<tInputs.length;j++){if(tInputs[j].getAttribute("name")=="type"){tType=tInputs[j].value}}try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(ex){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}return false}break}i++}}var post=XN.FORM.serialize("popShareParams_"+index,"hash");post.summary=$("summary_"+index).innerHTML;post.sysn=false;dataSet.postParam(post);cb();break;default:cb();break}},postUrl:function(type){var _setUrl=function(url,fs){Cfg.url={url:url,fs:fs}};switch(type){case"pop_share_new":Cfg.postParam.url==undefined?_setUrl(DOMAIN.SHARE+CGI.AJAX):_setUrl(Cfg.postParam.url,1);break;case"create_share_div":case"create_share_div_send":case"create_share_nosysn_send":case"create_share_nosysn":case"create_share_sysn":case"create_share_jebe":_setUrl(DOMAIN.SHARE+CGI.AJAX,0);break;case"create_thread_share_div":_setUrl(DOMAIN.SHARE+CGI.GETSHARE,0);break;case"create_share_popup":_setUrl(DOMAIN.SHARE+CGI.POPUP,0);break;case"create_share_link":Cfg.postParam.type=6;case"create_share_feed":case"create_share_edm":case"pop_share":case"pop_share_msg":case"pop_share_for_list":_setUrl(DOMAIN.SHARE+CGI.POPUP,1);break;case"pop_share_link":_setUrl(DOMAIN.SHARE+CGI.LINK,1);break;case"create_share_zhan":_setUrl(DOMAIN.SHARE+CGI.ZHAN,0);break;default:throw new Error("share type error")}return Cfg.url}};cbManager={showDialogMsg:function(msg){var d=sharePopUp.dialog.instance;d.setBody(tpl.msg.replace("{{MSG}}",msg));setTimeout(function(){d.hide()},1500)},error:function(msg){XN.DO.showError(msg||"请求失败，请重试");try{sharePopUp.dialog.instance.hide()}catch(e){}},postSuccess:function(r,fullres){var _this=this,dialog=sharePopUp.dialog.instance,dialogHtml="",action=Cfg.shareType,success={tips_a:"分享成功",tips_b:"",tips_c:'观看更多精彩分享，<a target="_blank" href="http://share.'+XN.env.domain+'">请点击这里！</a>',tips_d:"对方会通过站内信收到此分享内容",tips_e:"收藏成功！",tips_f:"此内容已添加到你的收藏中，并且仅你自己可见。",tips_g:"已分享到指定群，仅群成员可见。",tips_h:'你还可以<a href="javascript:void(0)" class="share_new" data-share="">分享给好友</a>。'};var adObjArry=fullres.adObjArry,htmlObj={};if(adObjArry){htmlObj=adObjArry[Math.floor(adObjArry.length*Math.random())];htmlObj.adObjArry=true}else{htmlObj.adObjArry=false}htmlObj.action=Cfg.shareType;dialog.setBody(tpl.shareCallback($extend(htmlObj,success)));if(action=="add"){$("share_success_link").setContent(tpl.shareLink({url:(fullres.type==1?DOMAIN.BLOG:DOMAIN.SHARE)+"/share/"+fullres.userid+"/"+fullres.shareid}));try{XN.copyExtralLink.init("share_success_btn",$("share_success_val").value)}catch(ex2){}}XN.app.share.fireEvent("postSuccessDialogPop",dialog);var _setTimeout=window.asyncHTMLManager?window.asyncHTMLManager.__timer.setTimeout:setTimeout;gCloseShareSucTimer=_setTimeout(function(){XN.dom.enable();try{dialog.hide();XN.copyExtralLink.clip&&XN.copyExtralLink.clip.hide()}catch(e){XN.log(e)}},5000)}};request={getVideoPostData:function(o){var url=o.url;new XN.net.xmlhttp({url:url,method:"GET",onSuccess:function(r){var jsonString=r.responseText;o.callback(eval("("+jsonString+")"))}})},getEdmPostData:function(o){var url=DOMAIN.EDM+"id="+o.id;new XN.net.xmlhttp({url:url,method:"GET",onSuccess:function(r){if(!XN.string.isJSON(r.responseText)){XN.DO.showMessage("服务器返回错误");return}try{var json=XN.json.parse(r.responseText);o.callback(json)}catch(e){XN.log(e.description)}},onError:function(r){XN.DO.showError("获取分享错误!")}})},getFeedPostData:function(o){var url=o.url;if(/uume.com/i.test(url)){var id=url.match(/uume.com\/share\/(\d+)\//i)[1],script,uumeShareData,uumeTimer;if(typeof window["uumeShareData_"+id]=="undefined"){script=document.createElement("script");script.src=url;document.body.appendChild(script)}uumeTimer=setInterval(function(){uumeShareData=window["uumeShareData_"+id];if(uumeShareData){clearInterval(uumeTimer);try{if(uumeShareData.code!==0&&uumeShareData.msg){try{sharePopUp.dialog.error(uumeShareData.msg)}catch(ex){XN.DO.showMessage(uumeShareData.msg,"友情提示")}return}if(uumeShareData.isProtected){try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(ex){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}return}if(uumeShareData.albumid){uumeShareData.albumid=new Number(uumeShareData.albumid).toString()}window._share_type=Cfg.postParam.type;$extend(Cfg.postParam,uumeShareData);o.callback&&o.callback()}catch(e){XN.log(e.description)}}},100)}else{new XN.net.xmlhttp({url:url,method:"GET",onSuccess:function(r){if(!XN.string.isJSON(r.responseText)){if(r.responseText.indexOf("isProtected")!==-1){try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(ex){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}}if(r.responseText.indexOf("error")!==-1){try{sharePopUp.dialog.error("该已经被删除 :(")}catch(ex){XN.DO.showMessage(getName(type)+"已经被删除 :(")}}return}try{var json=XN.json.parse(r.responseText);if(json.isProtected){try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(ex){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}return}if(json.albumid){json.albumid=new Number(json.albumid).toString()}window._share_type=Cfg.postParam.type;$extend(Cfg.postParam,json);o.callback&&o.callback()}catch(e){XN.log(e.description)}},onError:function(r){XN.DO.showError("获取分享错误!")}})}},doShare:function(pointer){if(!Cfg.tagObject[Cfg.shareType].vaild()){return false}dataSet.requestParam({},false);Cfg.tagObject[Cfg.shareType].getPostData();dataSet.requestParam(Cfg.requestParam);if(dataSet.tags){Cfg.requestParam.tags=dataSet.tags.toArray()}sharePopUp.dialog.before();XHR({url:(DOMAIN.SHARE+CGI.SUBMIT),data:"post="+encodeURIComponent(XN.json.build(Cfg.requestParam)),waitTime:5000,onSuccess:function(r){var data=Cfg.requestParam;try{var rs=XN.json.parse(r.responseText)}catch(e){cbManager.error(r)}if(rs.status===0){cbManager.postSuccess(rs.msg,rs,Cfg.requestParam);XN.app.share.fireEvent("postSuccess",data,rs);if(new RegExp("(page|org)."+XN.env.domain_reg+"(/\\d+)?/note").test((data.link||data.form.link))){new XN.net.xmlhttp({url:"http://page."+XN.env.domain+"/note/addShareCount",method:"post",data:"id="+(data.noteId||data.form.noteId)+"&pid="+(data.fromno||data.form.formno)})}}else{cbManager.error(rs.msg)}Cfg.postParam.type=window._share_type},onTimeout:function(){cbManager.error()},onError:function(){cbManager.error()}})},getShareInterface:function(){sharePopUp.dialog.loading();if(Cfg.shareType=="add"){Cfg.postParam.popupCategory=0}else{if(Cfg.shareType=="fav"){Cfg.postParam.popupCategory=1}}var p=encodeURIComponent(XN.json.build(Cfg.postParam));dataSet.beforePost(Cfg.postParam.stype,function(){XHR({url:dataSet.postUrl(Cfg.postParam.stype).url,data:"post="+encodeURIComponent(XN.json.build(Cfg.postParam)),waitTime:10000,onSuccess:function(r){var html=r.responseText;if(XN.string.isBlank(html)){sharePopUp.dialog.error("该分享不存在或者已被删除");return false}else{try{var j=XN.json.parse(html);if(j.code){if(j.code==400){sharePopUp.dialog.instance.hide();NetWorkConfirm(j.msg,"提示",function(){},"知道了","")}else{sharePopUp.dialog.error(j.msg)}}else{if(!j.code&&j.redirect){sharePopUp.dialog.instance.hide();XN.DO.confirm({message:"您还没有群，需要创建群吗？",callBack:function(r){if(r){location.href="http://qun.renren.com/?showcreate=true"}}})}}return false}catch(e){XN.log(e)}}sharePopUp.dialog.complete({html:html});var input=$("sharer_popup_message");object.use("xn.mention",function(exports,xn){xn.mention.Mention.init([{obj:$("sharer_popup_message"),ugcId:"",ugcType:"share",ownerId:XN.user.id,whisper:false}])});if($("tag-el")){$("tag-el").show()}object.use("mvc/ui/tags, dom",function(tags,dom){var config={el:"#tag-el",add:"#tag-add",del:".tag-del",list:"#tag-list",input:"#tag-input",switcher:"#tag-switch",switchOne:".tag-record",errorBox:"#tag-error-box",items:JSON.parse(dom.getElement("#tag-el").getData("tags")).items};dataSet.tags=new tags.Tags(config)});Cfg.requestParam.sendcomment=false;if(Sizzle("input[type=checkbox]",$("shareAjaxResult")).length>0){Sizzle("input[type=checkbox]",$("shareAjaxResult"))[0].checked=true}XN.app.share.fireEvent("getInterface",dataSet.postUrl(Cfg.postParam.stype))},onTimeout:function(){cbManager.showDialogMsg("获取分享数据超时，请稍候重试")},onError:function(){cbManager.showDialogMsg("服务器错误，请稍候重试")}})})}};pageUtil={tips:{NoResult:"您未管理任何公共主页",NoSelect:"您未选择任何公共主页"},wrap:null,list:null,get:function(){if(Sizzle(".page-list-wrap",this.container).length==0){var tpl='<div class="page-list-wrap" style="display: none;">                                    <div><input type="checkbox" id="pageSelectAll" class="page-select-all" /> <label for="pageSelectAll" style="display:inline;">全部</label></div>                                    <ul></ul>                                    <p class="page-list-tip" style="display: none;"></p>                                </div>',data,This=this;new XN.net.xmlhttp({url:"http://share.renren.com/share/popup/pagelist?user="+XN.user.id+"&limit=20",method:"GET",onSuccess:function(d){var json,data;try{json=XN.JSON.parse(d.responseText)}catch(e){This.error("服务器返回数据格式错误")}if(json.code!=0&&json.msg){This.error(json.msg);return false}data=json.pages;$("shareAjaxResult").parentNode.appendHTML(tpl);This.wrap=Sizzle(".page-list-wrap")[0];This.list=Sizzle("ul",This.wrap)[0];XN.array.each(data,function(i,v){$(This.list).appendHTML('<li><label><input type="checkbox" name="page-item" value="'+v.pageId+'" /> '+v.pageName+"</label></li>")});This.show()},onError:function(){This.error("服务器请求失败")},onTimeout:function(){This.error("服务器请求超时")}})}else{this.show()}},show:function(){if(!!this.wrap){$(this.wrap).show();this.bindEvents();if(XN.browser.IE&&Sizzle(".st-now").length>0){setTimeout(function(){Sizzle(".st-now")[0].style.zoom=1},0)}}},hide:function(){if(!!this.wrap){$(this.wrap).hide()}if(Cfg.requestParam.pagelist){delete Cfg.requestParam.pagelist}},bindEvents:function(){var selectAll=Sizzle(".page-select-all",this.wrap),inputs=Sizzle("input",this.list);$(selectAll).addEvent("click",function(){if(!!this.checked){XN.array.each(inputs,function(i,v){v.checked=true})}else{XN.array.each(inputs,function(i,v){v.checked=false})}})},getIds:function(){if(!this.list){return}var ids=[],inputs=Sizzle("input",this.list);XN.array.each(inputs,function(i,v){if(!!v.checked){ids.push(v.value)}});if(ids.length==0){this.error(this.tips.NoSelect);return false}return ids},error:function(msg){if(!msg){return}XN.Do.alert({msg:msg,type:"error",autoHide:2});if(msg!==this.tips.NoSelect){this.hide();shareTypeCom.toggle(shareTypeCom.selectCon2)}return false}};shareTypeCom={CONST:{TITLE_ADD:"发新鲜事",TITLE_FAV:"仅自己收藏",TITLE_PAGE:"公共主页发布"},container:null,eventSplitter:/^(\w+)\s*(.*)$/,elements:{".st-now":"nowCon",".st-select":"selectCon",".st-text":"textCon",".st-arrow":"arrowCon",".st-select2":"selectCon2"},events:{"click nowCon":"show","click selectCon":"select","click selectCon2":"select2"},init:function(father){if(this.has(father)){return}this.createShareInterface(father);this.refreshElements();if($("isPageShare")&&($("isPageShare").value=="true"||$("isPageShare").value==true)){this.selectCon2.hide()}this.delegateEvents()},eventsFuncBuilder:function(){var self=this;self.show=function(e){var e=e||window.event;self.selectCon.addClass("st-show");self.selectCon2.addClass("st-show");self.arrowCon.delClass("st-down");self.arrowCon.addClass("st-up");XN.event.stop(e)};self.hide=function(){self.selectCon.delClass("st-show");self.selectCon2.delClass("st-show");self.arrowCon.addClass("st-down");self.arrowCon.delClass("st-up")};self.select=function(e){var e=e||window.event;self.hide();self.toggle(self.selectCon);if(self.nowCon.hasClassName("page")){pageUtil.get()}else{pageUtil.hide()}XN.event.stop(e)};self.select2=function(e){var e=e||window.event;self.hide();self.toggle(self.selectCon2);if(self.nowCon.hasClassName("page")){pageUtil.get()}else{pageUtil.hide()}XN.event.stop(e)}},delegateEvents:function(){this.eventsFuncBuilder();for(var key in this.events){var methodName=this.events[key],method=this[methodName],match=key.match(this.eventSplitter),o=this[match[2]],eventName=match[1];XN.event.addEvent(o,eventName,method)}var self=this;XN.event.addEvent(document,"click",function(){self.hide()})},toggleClass:function(elm,clsArr,cls){XN.Array.each(clsArr,function(i,v){if(v==cls){$(elm).addClass(v)}else{$(elm).delClass(v)}})},toggle:function(elm){var clsArr=["fav","add","page"];if(elm.hasClassName("fav")){this.toggleClass(this.nowCon,clsArr,"fav");this.toggleClass(this.selectCon,clsArr,"add");this.toggleClass(this.selectCon2,clsArr,"page");this.textCon.innerHTML=this.CONST.TITLE_FAV;this.selectCon.innerHTML=this.CONST.TITLE_ADD;this.selectCon2.innerHTML=this.CONST.TITLE_PAGE;dataSet.cmdType("fav");if(Sizzle("input[type=checkbox]",$("shareAjaxResult")).length>0){Sizzle("input[type=checkbox]",$("shareAjaxResult"))[0].checked=true}}else{if(elm.hasClassName("add")){this.toggleClass(this.nowCon,clsArr,"add");this.toggleClass(this.selectCon,clsArr,"fav");this.toggleClass(this.selectCon2,clsArr,"page");this.textCon.innerHTML=this.CONST.TITLE_ADD;this.selectCon.innerHTML=this.CONST.TITLE_FAV;this.selectCon2.innerHTML=this.CONST.TITLE_PAGE;dataSet.cmdType("add");if(Sizzle("input[type=checkbox]",$("shareAjaxResult")).length>0){Sizzle("input[type=checkbox]",$("shareAjaxResult"))[0].checked=true}}else{if(elm.hasClassName("page")){this.toggleClass(this.nowCon,clsArr,"page");this.toggleClass(this.selectCon,clsArr,"fav");this.toggleClass(this.selectCon2,clsArr,"add");this.textCon.innerHTML=this.CONST.TITLE_PAGE;this.selectCon.innerHTML=this.CONST.TITLE_FAV;this.selectCon2.innerHTML=this.CONST.TITLE_ADD;dataSet.cmdType("pageAdd");if(Sizzle("input[type=checkbox]",$("shareAjaxResult")).length>0){Sizzle("input[type=checkbox]",$("shareAjaxResult"))[0].checked=false}}}}},refreshElements:function(){for(var key in this.elements){this[this.elements[key]]=this.getEl(key)}},getEl:function(selector){return $(Sizzle(selector,this.container)[0])},createShareInterface:function(father){var p=document.createElement("div");p.className="st-container";p.innerHTML=tpl.shareTypeLayer();this.container=p;father.insertBefore(p,father.childNodes[0])},has:function(father){var childs=father.childNodes,len=childs.length;for(var i=0;i<len;i++){if(childs[i].hasClassName("st-container")){return ture}}return false}};sharePopUp={dialog:{instance:"",error:function(msg){return cbManager.showDialogMsg(msg)},before:function(){sharePopUp.dialog.instance.setBody(tpl.beforePost);sharePopUp.dialog.instance.footer.hide()},loading:function(){var dialog=XN.DO.confirm({message:tpl.loadingHTML(),callBack:function(r){if(r){this.preventHide();request.doShare(this)}else{XN.dom.enable();this.remove()}},submit:Cfg.shareType=="fav"?"收藏":"确定",params:{showCloseButton:true},width:475,Y:XN.event.scrollTop()+100});sharePopUp.dialog.instance=dialog;dialog.header.hide();dialog.footer.hide()},complete:function(o,type){var dialog=sharePopUp.dialog.instance,emoId;html='<div style="display:none" id="share_frame_out">'+o.html+"</div>";dialog.setBody(html);XN.loadFiles(["http://s.xnimg.cn/csspro/module/minieditor.css","http://s.xnimg.cn/jspro/xn.ui.emoticons.js"],function(){setTimeout(function(){new XN.ui.emoticons({input:$("sharer_popup_message"),button:$("emoBtn"),btnAlignType:"4-1",url:"http://status.renren.com/getubblist.do?type=2"});emoId=$("sharer_popup_message").getAttribute("eicons_obj_id")},0)});dialog.addEvent("hide",function(){try{emoId=emoId||$("sharer_popup_message").getAttribute("eicons_obj_id");$(window.getEmoticonsInstance(emoId).emotionsContainer).hide()}catch(e){XN.log(e)}});dialog.setTitle(Cfg.tagObject[Cfg.shareType].dialogTitle);dialog.header.show();dialog.footer.show();dataSet.defaultMsg();function countLimit(){var length=$("sharer_popup_message").value.split("").length;$("share_count").innerHTML=length;if(length>500){$("share_count").style.color="red"}else{$("share_count").style.color=""}}setTimeout(function(){if(!!$("share_count")){var length=$("sharer_popup_message").value.split("").length;$("share_count").innerHTML=length;XN.event.addEvent("sharer_popup_message","keyup",function(){countLimit()});XN.event.addEvent("sharer_popup_message","focus",function(){countLimit()})}var frame=$("share_frame_out"),input=$("sharer_popup_message");frame.setStyle("display:block");if(input.setSelectionRange){input.focus();input.setSelectionRange(0,0)}else{if(input.createTextRange){var range=input.createTextRange();range.moveStart("character",0);range.moveEnd("character",0);range.collapse(true);range.select();input.focus()}else{input.focus()}}XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","560","share.all.complate",1000)}catch(ex){}})},0);setTimeout(function(){shareTypeCom.init(dialog.footer)},0)}}};eventRegister={done:function(){var d={s:".share_new",e:"click",cb:function(e,d){dataSet.postParam(d.data,true);dataSet.cmdType("add");request.getShareInterface();XN.loadFiles([UGC_PING],function(){try{UGC.Network.ping.clickStream("400","561","share.add.fromclick",1000)}catch(ex){}})}};XNShareObject._commonRegister({selector:d.s,event:d.e,callback:d.cb})}};XNShareObject.forceShowFloat=function(el){};eventRegister.done()},_commonRegister:function(a){XNShareObject._base.liveRegister.call(this,a.selector,a.event,function(b,c){a.callback(b,c)},a.args)},_innerClosure:function(a){XNShareObject._commonRegister.call(this,{selector:(a.selector?a.selector:".share_pop"),event:(a.event?a.event:"click"),callback:a.cb,args:a.args})},interfaceOld:{createShareDiv:function(b){var a=function(e,c){XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:{id:c.id,owner:c.owner,host:c.host},actionParams:{reqeustURI:c.ref?("http://share."+XN.env.domain+"/share/submit.do?ref="+c.ref):""}})};XNShareObject._innerClosure({selector:".share_div",cb:a,args:arguments})},createShareZhan:function(){var a=function(c,b){XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/popup/zhan",data:{id:b.id,owner:b.owner,type:140},actionParams:{reqeustURI:"http://share."+XN.env.domain+"/share/postshare"}})};XNShareObject._innerClosure({selector:".share_zhan",cb:a,args:arguments})},createShareFriendDiv:function(){XNShareObject._innerClosure({selector:".share_friend_div",cb:function(b,a){XN.APP.share.onlyShowSendContent=true;XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:{id:a.id,owner:a.owner,host:a.host}})},args:arguments})},createShareDivSend:function(){XNShareObject._innerClosure({selector:".share_friend_div",cb:function(b,a){XN.APP.share.onlyShowSendContent=true;XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:{id:a.id,owner:a.owner,host:a.host,tabDefault:"send",sysn:true}})},args:arguments})},createShareNosysnSend:function(){XNShareObject._innerClosure({selector:".share_nosysn_send",cb:function(b,a){XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:{id:a.id,owner:a.owner,host:a.host,tabDefault:"send",sysn:false}})},args:arguments})},createShareNosysn:function(){XNShareObject._innerClosure({selector:".share_nosysn",cb:function(b,a){XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:{id:a.id,owner:a.owner,host:a.host,sysn:false}})},args:arguments})},createShareSysn:function(){XNShareObject._innerClosure({selector:".share_sysn",cb:function(b,a){XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:{id:a.id,owner:a.owner,host:a.host,sysn:true}})},args:arguments})},createShareJebe:function(){XNShareObject._innerClosure({selector:".share_jebe",cb:function(b,a){XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/ajax.do",data:a,actionParams:{reqeustURI:a.saveAction}})},args:arguments})},createThreadShareDiv:function(){XNShareObject._innerClosure({selector:".share_thread_div",cb:function(b,a){XN.app.share.pop({url:"http://share."+XN.env.domain+"/getshare.do",data:{tid:a.tid,tribeId:a.tribeId}})},args:arguments})},createShareEdm:function(){XNShareObject._innerClosure({selector:".share_edm",cb:function(e,c){var f=c.id,a=c.owner,b=c.type;new XN.net.xmlhttp({url:"http://edm."+XN.env.domain+"/feedshare.do?id="+f,method:"GET",onSuccess:function(d){if(!XN.string.isJSON(d.responseText)){XN.DO.showMessage("服务器返回错误");return}try{XN.app.share.pop({url:"http://share."+XN.env.domain+"/share/popup.do",data:XN.json.parse(d.responseText)})}catch(g){XN.log(g.description)}},onError:function(d){XN.DO.showError("获取分享错误!")}})},args:arguments})},createShareFeed:function(){var a=function(f,i){var h,g,c=i.id,j=i.type,e=i.owner;if(j=="pageThread"||j=="pageBlog"||j=="pageAlbum"){if(!(XN.user&&!XN.string.isBlank(XN.user.id))){XN.DO.showError("请先登录！");return}}h=function(d){switch(d){case"blog":return"http://blog."+XN.env.domain+"/blog/"+e+"/"+c+"/homeShare";case"album":return"http://photo."+XN.env.domain+"/photo/"+e+"/album-"+c+"/share";case"photo":return"http://photo."+XN.env.domain+"/photo/"+e+"/photo-"+c+"/share";case"forum":return"http://xiaozu."+XN.env.domain+"/xiaozu/"+c+"/js";case"thread":return"http://xiaozu."+XN.env.domain+"/xiaozu/"+c+"/thread/"+e+"/share";case"clike":return"http://app."+XN.env.domain+"/like/likeInfo?feed_id="+c;case"pageThread":return"http://page."+XN.env.domain+"/"+c+"/group/"+e+"/getShareData";case"pageBlog":return"http://page."+XN.env.domain+"/"+e+"/note/"+c+"/share";case"pageAlbum":return"http://page."+XN.env.domain+"/"+e+"/album/"+c+"/share";case"video":return"http://video."+XN.env.domain+"/ajax/getVideoInfo?ownerId="+e+"&videoId="+c;case"chewen_news":return"";break}};var b=function(d){switch(d){case"blog":return"日志";case"album":return"相册";case"photo":return"照片";case"forum":return"小组";case"thread":return"帖子";case"pageThread":return"话题";case"pageBlog":return"日志";case"pageAlbum":return"相册";case"video":return"视频"}};var k=function(l,d){new XN.net.xmlhttp({url:"http://blog."+XN.env.domain+"/share/incShareCount.do",data:"link="+encodeURIComponent((l.link||l.form.link))})};if(j=="blog"&&!XN.app.share.hasBlogListener){XN.app.share.hasBlogListener=true;XN.app.share.addEvent("postSuccess",k)}new XN.net.xmlhttp({url:h(j),method:"GET",onSuccess:function(n){if(!XN.string.isJSON(n.responseText)){if(n.responseText.indexOf("isProtected")!==-1){try{sharePopUp.dialog.error("只有所有人可见才能被分享 :)")}catch(m){XN.DO.showMessage("只有所有人可见才能被分享 :)","友情提示")}}if(n.responseText.indexOf("error")!==-1){try{sharePopUp.dialog.error("已经被删除 :(")}catch(m){XN.DO.showMessage("已经被删除:(","友情提示")}}return}try{var l=XN.json.parse(n.responseText);if(l.isProtected){window.__shareProtect.t2();return}if(l.albumid){l.albumid=new Number(l.albumid).toString()}var d="http://share."+XN.env.domain+"/share/popup.do";pop_share_new(d,l)}catch(o){XN.log(o.description)}},onError:function(d){XN.DO.showError("获取分享错误!")}})};XNShareObject._innerClosure({selector:".share_feed",cb:a,args:arguments})}}};XN.dom.ready(function(){XNShareObject._register({autoRegister:false,floatMode:true})});function school_bbs_share(a,b){new XN.net.xmlhttp({url:"http://school.renren.com/qa/question/share/share?questionId="+a+"&questionUserId="+b,method:"get",onSuccess:function(c){create_share_popup(XN.json.parse(c.responseText))},onError:function(){XN.DO.showError("")}})}(function(){var g="";var b='<div style="width:450px;height:30px;" id="y_tip_frame">			<div class="tip-box">				<span class="tip-arrow"></span>				<a href="#" onclick="return false;" class="tip-close" id="y_tip_close">关闭</a>				<span>已许可评论同步到该视频来源网站！（回复好友的评论除外哦）点击可取消许可</span>			</div>		</div>';function f(i){var h=document.createElement("div");h.innerHTML=b;h.style.cssText="position:absolute;top:"+i.top+"px;left:"+i.left+"px";document.getElementsByTagName("body")[0].appendChild(h);setTimeout(function(){XN.event.addEvent($("y_tip_close"),"click",function(){$("y_tip_frame").style.display="none";var j="http://www.connect.renren.com/sync/comment/notifyForComment";new XN.net.xmlhttp({url:j,method:"post",data:"url="+g,onSuccess:function(k){}});return false})},0)}function a(){var h=$("intercommunicate");h.setAttribute("status","enable");h.setAttribute("title","已许可评论同步到该视频来源网站！（回复好友的评论除外哦）点击取消许可。");h.src="http://a.xnimg.cn/imgpro/share/icon-plht-on.png";XN.DO.alert({message:"已许可评论同步到该视频来源网站！（回复好友的评论除外哦）点击取消许可。",modal:true,autoHide:3})}function e(){var h=$("intercommunicate");h.setAttribute("status","disable");h.setAttribute("title","让更多的人看到你的精彩评论吧，点亮后即可将评论同步到该视频来源网站！");h.src="http://a.xnimg.cn/imgpro/share/icon-plht-off.png";XN.DO.alert({message:"已取消许可评论同步！点击图标可再次设定。",modal:true,autoHide:3})}function c(){new XN.net.xmlhttp({url:"http://www.connect.renren.com/sync/comment/unauthorize",method:"post",data:"url="+g,onSuccess:function(h){var h=XN.json.parse(h.responseText);if(h[0].op){e()}},onError:function(h){var h=h.responseText;XN.DO.showError("接口小问题，请刷新页面或稍后重试")}})}function d(){new XN.net.xmlhttp({url:"http://www.connect.renren.com/sync/comment/authorize",method:"post",data:"url="+g,onSuccess:function(h){var h=XN.json.parse(h.responseText);if(h[0].op){a()}},onError:function(h){var h=h.responseText;XN.DO.showError("接口小问题，请刷新页面或稍后重试")}})}XN.dom.ready(function(){if($("intercommunicate")){var h=$("intercommunicate");setTimeout(function(){if(showInterflowCommentPrompt){f({left:h.realLeft()-45,top:h.realTop()+22})}},3000);g=XN.app.share.shareVideoUrl;XN.event.addEvent("intercommunicate","click",function(k){var j=XN.event.element(k),i=j.getAttribute("status");if(i=="enable"){c()}else{if(i=="disable"){d()}}})}})})();function share_show_more_comments(c,b){var d="http://share."+XN.env.domain+"/share/getmorecomment.do";var a=function(){var h=$("commContainer_"+c).getElementsByTagName("dd")[0];return h.id.match(/\d+/)[0]};var g=function(h,u){var y=$element("dl");y.className="replies";var D="",k;var C=parseInt(XN.cookie.get("id"),10);var t=false;if($("isAdmin")){$("isAdmin").value=="true"?true:false}for(var z=0;h[z];z++){k=h[z];var v=k.keepUse?" lively-user":"",l=k.keepUse?"连续登录7天, 即可获得橙名特权":k.name,q="",r="http://admin.renren.com/admin/newuserreport.do?type=30&owner="+b+"&contentId="+k.id+"&userId="+k.author+"&origURL="+encodeURIComponent(document.location.href),B=k.isVip,n=k.vipIconUrl,j="01",w="01",x;if(k.vocal_url&&k.vocal_length){var o=/^回复.+[:：](?!\/)/,A=o.test(k.body)?k.body.match(o)[0]:"";x=A+"<a class=\"vocal-player vocal-player-tiny\"                 data-vocal=\"{'url': '"+k.vocal_url+"', 'time': "+k.vocal_length+",'ownerId':"+k.replyerId+",'voiceId':"+k.commentId+", 'sourceOwner':"+b+", 'sourceId':"+u+', \'ugcType\':9}" href="javascript:;">                    <span class="btn"></span>                    <span class="time"><span class="num">'+k.vocal_length+"</span>秒</span>                </a>"}else{x=k.body}if(!k.showDelete){q='<span class="float-right"><a target="_blank" href="'+r+'" class="reply-report" style="display: none;">举报</a></span>'}D+='<dd id="comment_'+k.id+'">'+q+'     <a class="avatar" namecard="'+k.author+'" title="'+k.name+'" href="http://www.'+XN.env.domain+"/profile.do?id="+k.author+'">            <img height="50" width="50" src="'+k.headUrl+'" alt="'+k.name+'" class="avatar"/>     </a>     <div class="info">';if(k.showDelete){D+='            <span class="float-right">                 <a class="x-to-hide" onclick="share_delete_comment(this,'+u+","+b+","+k.id+');" href="javascript:void(0)"></a>            </span>'}D+='<a title="'+l+'" href="http://www.'+XN.env.domain+"/profile.do?id="+k.author+'" class="'+v+'" namecard="'+k.author+'">'+k.name+"</a> ";if(n){D+='<a title="VIP" target="_blank" href="http://i.renren.com/index.action?wc=290000"><img alt="VIP" src="'+k.vipIconUrl+'"></a>'}D+='</div>      <div class="reply">            <p class="content"  style="display: block">'+x+"            </p>";D+='<div class="control-box clearfix">';D+='<span class="time"> '+k.time+" </span>";D+='<div class="btn-box">';if(!k.vocal_url&&XN.user&&XN.user.id&&(k.liked!==undefined)&&(k.likeCount!==undefined)){var m="<a style=\"margin-left: 10px;\" class=\"ilike_comment\" comment-data=\"{'stype':'share','cid':'{{commentId}}', 'rid':'{{resourceId}}', 'uid':'{{userId}}', 'oid':'{{ownerId}}', 'roid':'{{resourceUserId}}', 'name':'{{userName}}', 'url':'{{url}}', 'liked':{{islike}} }\" href=\"javascript:void(0)\">{{comment}}</a>",p={commentId:k.id,ownerId:k.author,resourceId:u,resourceUserId:b,userId:XN.user.id,userName:XN.user.name,url:"http://blog.renren.com/blog/"+this.ownerId+"/"+this.blogId,islike:k.liked,comment:k.liked?((k.likeCount===0)?"取消":k.likeCount+" 取消"):((k.likeCount===0)?"喜欢":k.likeCount+" 喜欢")},s=Mustache.to_html(m,p);D+=s}if(C!==k.author){D+='&nbsp; <a onclick="share_reply_comment('+u+","+k.author+",'"+k.name+"',"+k.id+');return false" href="#nogo">回复</a>'}D+="</div>";D+="</div>";D+="      </div></dd>"}y.innerHTML=D;return y};var f={shareId:c,owner:b,commentId:a()};$("tempLoading_"+c).style.visibility="visible";var e=new XN.net.xmlhttp({url:d,data:XN.array.toQueryString(f),onSuccess:function(k){$("tempLoading_"+c).style.visibility="hidden";var h=XN.json.parse(k.responseText);if(h.code!==0){XN.DO.alert(h.msg);return}if(h.code==0){if(!h.hasMore){$("showMore_"+c).hide()}var i=$("commContainer_"+c);i.insertBefore(g(h.comments,c),i.findFirstClass("replies"))}},onError:function(h){XN.DO.showError("服务器错误，请稍后重试")}})}object.define("mvc/ui/tags","object/mvc, dom, events",function(b,a){var d=b("object/mvc"),e=b("dom"),c=b("events");a.Tags=new Class(function(){Class.mixin(this,c.Events);this.option=property(function(f){return f.__option},function(f,g){f.__option=g});this.defaultOption=property(function(){return{maxCount:20,maxSelectedCount:5,maxShowCount:10,swtichText:["展开>>","<<收起"],errors:{type:"不能输入特殊符号",maxLength:"超过10个字符啦",empty:"请先输入内容",repeat:"不能添加重复元素",overrange:"总共不能添加超过5个选中标签，每个标签用空格分开",overrange2:"标签总数不能超过20个，每个标签用空格分开"},tpl:'<ul class="ui-tags">                        {{#items}}                            {{^checked}}                                <li data-tag="{{tagData}}" model-id="{{_id}}">                                    <a class="tag-record" href="javascript:">{{tagName}}</a>                                    <a style="display: none;" class="tag-server-remove" data-tag=\'{"tag": "{{tagName}}"}\' href="javascript:"></a>                                </li>                            {{/checked}}                            {{#checked}}                                <li class="checked" data-tag="{{tagData}}" model-id="{{_id}}">                                    <a class="tag-record" href="javascript:">{{tagName}}</a>                                    <a style="display: none;" class="tag-server-remove" data-tag=\'{"tag": "{{tagName}}"}\' href="javascript:"></a>                                </li>                            {{/checked}}                        {{/items}}                    </ul>'}});this.recordsLoaded=function(g,i){var f=i.records,h=g.get("option").maxShowCount;if(f.length<=h&&g.switchEl){g.switchEl.hide()}if(h&&h>0&&g.switchEl){f=i.records.slice(0,h)}g.renderTags(f);if(g.inputEl){g.inputEl.hasTags=i.records;g.inputEl.selectedTags=g.selectedTags}};this.renderTags=function(h,g){var j=h.get("option"),i,f;i=Mustache.to_html(j.tpl,{items:g});h.listEl.setHTML(i);if(h.switchEl){h.switchEl.setHTML(h.extended?j.swtichText[1]:j.swtichText[0]);h.listEl.getElement("ul").grab(h.switchEl,"bottom")}};this.switchTags=function(g){var h=g.get("option"),f;if(h.maxShowCount&&h.maxShowCount>0){f=g.extended?g.model.records.slice(0,h.maxShowCount):g.model.records;g.extended=!g.extended;g.switchEl.setHTML(g.extended?h.swtichText[1]:h.swtichText[0])}else{f=g.model.records}g.renderTags(f)};this.switchTag=function(f,j){var i=j.srcElement||j.target,h=e.wrap(i).getParent("li"),k,g;k=parseInt(h.getAttribute("model-id"));g=f.model.propSelector("_id",k)[0];if(g.checked){h.removeClass("checked");g.checked=false;f.fireEvent("tag unselected",{element:h,data:g});f.handleSelectedTag(h,false)}else{if(f.handleSelectedTag(h,true)){h.addClass("checked");g.checked=true;f.fireEvent("tag selected",{element:h,data:g})}}};this.handleSelectedTag=function(g,f,l){var i=g.selectedTags,k=g.get("option"),h=0;var j=f.getElement(".tag-record")||f.getElement(".text");f.tagValue=j.innerHTML;if(l){if(i.length+1>k.maxSelectedCount){g.fireEvent("show error",{error:k.errors.overrange});return false}if(i.indexOf(f)==-1){i.push(f)}}else{if(f.nodeName.toLowerCase()=="li"){for(h=0;h<i.length;h++){if(f.getAttribute("model-id")==i[h].getAttribute("model-id")){i.splice(h,1);break}}}else{if(i.indexOf(f)!=-1){i.splice(i.indexOf(f),1)}}}return true};this.addTags=function(f,i){var j=f.inputEl.value,h=f.get("option"),g;if(h.valid(j)){g=j.split(" ");g.forEach(function(k){var l=f.model.propSelector("tagName",k);if(l.length>0){l.forEach(function(m){m.checked=true})}else{f.model.createRecord({tagName:k,checked:true})}});f.renderTags(f.model.records);if(!f.extended){f.switchTags()}}else{f.fireEvent("valid error",{error:h.errorMsg});f.inputError()}};this.delTag=function(f,j){var i=j.srcElement||j.target,h=e.wrap(i).getParent("li"),k,g;k=parseInt(h.getAttribute("model-id"));if(g=f.model.removeRecord(k)){h.dispose();f.fireEvent("tag removed",{element:h,data:g});f.handleSelectedTag(h,false)}};this.showErrorBox=function(f,g){f.errorBox.setHTML(g);if(!f.timer){f.timer=setTimeout(function(){f.timer=null},2000)}};this.toArray=function(g){var h=g.selectedTags,f=[];h.forEach(function(i){f.push(i.tagValue)});return f};this.initialize=function(f,g){var h={};object.extend(h,f.get("defaultOption"));f.set("option",object.extend(h,g));f.model=new d.Model({items:g.items});f.extended=false;f.selectedTags=[];f.el=e.getElement(g.el);if(!f.el){return false}f.el.addClass("share-tags");g=f.get("option");if(g.selectedCount){g.maxSelectedCount-=g.selectedCount;g.maxCount-=g.selectedCount}f.controller=new d.Controller({init:function(){f.listEl=e.getElement(g.list);if(g.input){f.inputEl=new a.MultiInput({el:g.input,maxCount:g.maxCount,maxSelectedCount:g.maxSelectedCount,errors:g.errors});f.inputEl.addEvent("label removed",function(i){f.handleSelectedTag(i.label,false)});f.inputEl.addEvent("label created",function(i){f.handleSelectedTag(i.label,true)});f.inputEl.addEvent("show error",function(i){f.showErrorBox(i.error)})}if(g.switcher){f.switchEl=e.getElement(g.switcher)}if(g.add){f.addEl=e.getElement(g.add);f.addEl.hide()}if(g.errorBox){f.errorBox=e.getElement(g.errorBox)}},el:g.el,events:[[g.switcher,"click",f.switchTags.bind(f)],[g.switchOne,"click",f.switchTag.bind(f)],[g.add,"click",f.addTags.bind(f)],[g.del,"click",f.delTag.bind(f)]],models:[[f.model,"loaded records",f.recordsLoaded.bind(f)]]});f.model.load();f.addEvent("show error",function(i){f.showErrorBox(i.error)})}});a.MultiInput=new Class(function(){Class.mixin(this,c.Events);this.option=property(function(f){return f.__option},function(f,g){f.__option=g});this.defaultOption=property(function(){return{labelInputTpl:"<input></input>",labelTpl:'<a class="label" href="javascript:"><span class="text">{{labelText}}</span><span class="close"></span></a>',maxLength:10,maxCount:20,maxSelectedCount:5,errors:{type:"请不要输入特殊符号",maxLength:"超过10个字符啦",empty:"请输入标签名",repeat:"请勿添加重复标签",overrange:"总共不能添加超过5个选中标签，每个标签用空格分开",overrange2:"标签总数不能超过20个，每个标签用空格分开"}}});this.initialize=function(f,g){var h={};object.extend(h,f.get("defaultOption"));f.set("option",object.extend(h,g));f.addEvent("label created",f.updateInput.bind(f));f.addEvent("label removed",f.updateInput.bind(f));f.labels=[];f._initEl()};this.updateInput=function(f){var g=f.get("option"),i=f.labels,h=[];i.forEach(function(j){var k=j.getElement(".text").innerHTML;h.push(k)});f.el.value=h.join(" ")};this._initEl=function(f){var g=f.get("option");f.el=e.getElement(g.el);f.elAttributes={};f.elAttributes.placeholder=f.el.getAttribute("placeholder");f.wrap=e.wrap(document.createElement("div"));f.wrap.style.width=f.el.style.width;f.wrap.addClass("multiBox");f.wrap.addEvent("click",function(){f.currentLabel.getElement("input").focus()});f.addLabelBox();f.addErrorLabel();f.el.hide();f.el.grab(f.wrap,"after")};this.addErrorLabel=function(f){var g=e.wrap(document.createElement("span"));g.addClass("error");g.hide();f.currentLabel.grab(g,"after");f.errLabel=g};this.addLabelBox=function(g){var i=g.get("option"),h=e.wrap(document.createElement("span")),j=Mustache.to_html(i.labelInputTpl),f;h.setHTML(j);h.addClass("labelBox");f=h.getElement("input");if(g.elAttributes.placeholder&&g.elAttributes.placeholder!=""){if(!XN.browser.IE){f.setAttribute("placeholder",g.elAttributes.placeholder)}e.wrap(f)}g.currentLabel=h;g.wrap.grab(g.currentLabel,"bottom");g.currentLabel.delegate("input","keydown",g.inputChange.bind(g));g.currentLabel.delegate("input","keyup",g.inputChangeUp.bind(g));g.currentLabel.getElement("input").addEvent("blur",g.inputBlur.bind(g))};this.inputBlur=function(g,k){var j=g.get("option"),i=k.srcElement||k.target,f=e.wrap(i).value,h;if(f!=""){g._valid(f,true,function(l){if(l){g.errLabel.setHTML(l);g.errLabel.show()}else{g.errLabel.hide();h=g.createLabel({labelText:f});if(h){g.currentLabel.grab(h,"before");g.labels.push(h);g.currentLabel.getElement("input").value="";g.fireEvent("label created",{label:h})}}})}};this.inputChange=function(g,k){var j=g.get("option"),i=k.srcElement||k.target,f=e.wrap(i).value,h;if(k.keyCode==32&&f!=""){XN.event.stop(k);g._valid(f,true,function(l){if(l){g.errLabel.setHTML(l);g.errLabel.show()}else{g.errLabel.hide();h=g.createLabel({labelText:f});if(h){g.currentLabel.grab(h,"before");g.labels.push(h);g.currentLabel.getElement("input").value="";g.fireEvent("label created",{label:h})}}})}};this.inputChangeUp=function(g,j){var i=g.get("option"),h=j.srcElement||j.target,f=e.wrap(h).value;if(f!=""){g._valid(f,false,function(k){if(k){g.errLabel.setHTML(k);g.errLabel.show()}else{g.errLabel.hide()}})}else{g.errLabel.hide()}};this._valid=function(r,j,f,k){var g=/^(\w|[\u4E00-\u9FA5]|-|_)*$/,n=r.labels,m=r.get("option"),q=0,p=r.hasTags,h=0;if(f){n.forEach(function(i){if(r.selectedTags.indexOf(i)!=-1){h++}});if(r.selectedTags.length+n.length-h+1>m.maxSelectedCount){r.fireEvent("show error",{error:m.errors.overrange});return}}if(f){if(r.hasTags.length+n.length+1>m.maxCount){r.fireEvent("show error",{error:m.errors.overrange2});return}}for(var l=0,o=n.length;l<o;l++){if(n[l].getElement(".text").innerHTML==j){k(m.errors.repeat);return}}for(var l=0,o=p.length;l<o;l++){if(p[l].tagName==j){k(m.errors.repeat);return}}if(j==""){k(m.errors.empty);return}if(!g.test(j)){k(m.errors.type);return}for(var l=0;l<j.length;l++){if(j.charCodeAt(l)>10000){q+=2}else{q+=1}}if(q>m.maxLength){k(m.errors.maxLength);return}k()};this.createLabel=function(f,i){var h=f.get("option"),g;g=Mustache.to_html(h.labelTpl,i);g=e.wrap(e.getDom(g).firstChild);g.delegate(".close","click",function(j){if(f.labels.indexOf(g)!=-1){f.labels.splice(f.labels.indexOf(g),1);g.dispose();f.fireEvent("label removed",{label:g})}});return g}})});object.define("tags/edit","dom, events, mvc/ui/tags",function(b,a){var e=b("dom"),d=b("events"),c=b("mvc/ui/tags");this.TagsEdit=new Class(function(){Class.mixin(this,d.Events);this.option=property(function(f){return f.__option},function(f,g){f.__option=g});this.defaultOption=property(function(){return{tpl:'<ul>                        {{#items}}                            {{#all}}                                {{#current}}                                    <li class="checked">                                        {{#untag}}                                            <a class="tag-record" ui-async="async" href="{{baseUrl}}&type={{type}}&tag={{tagNameUrl}}&untag={{untag}}">{{tagName}}</a>                                        {{/untag}}                                        {{^untag}}                                            <a class="tag-record" ui-async="async" href="{{baseUrl}}&type={{type}}">{{tagName}}</a>                                        {{/untag}}                                    </li>                                {{/current}}                                {{^current}}                                    <li>                                        {{#untag}}                                            <a class="tag-record" ui-async="async" href="{{baseUrl}}&type={{type}}&tag={{tagNameUrl}}&untag={{untag}}">{{tagName}}</a>                                        {{/untag}}                                        {{^untag}}                                            <a class="tag-record" ui-async="async" href="{{baseUrl}}&type={{type}}">{{tagName}}</a>                                        {{/untag}}                                    </li>                                {{/current}}                            {{/all}}                            {{^all}}                                {{#current}}                                    <li class="checked">                                        <a class="tag-record" ui-async="async" href="{{baseUrl}}&type={{type}}&tag={{tagNameUrl}}">{{tagName}}</a><a class="tag-server-remove tag-record" href="javascript:" tagName="{{tagName}}" style="display:none" data-tag=\'{"tag": "{{tagName}}"}\'></a>                                    </li>                                {{/current}}                                {{^current}}                                    <li>                                        <a class="tag-record" ui-async="async" href="{{baseUrl}}&type={{type}}&tag={{tagNameUrl}}">{{tagName}}</a><a class="tag-server-remove tag-record" href="javascript:" tagName="{{tagName}}" style="display:none" data-tag=\'{"tag": "{{tagName}}"}\'></a>                                    </li>                                {{/current}}                            {{/all}}                        {{/items}}                    </ul>',tagTpl:'<a href="{{baseUrl}}&tag={{tagNameUrl}}" class="tag-record">{{tagName}}</a>                    <a style="display: none;" class="tag-server-remove hover-show" href="javascript:" data-tag=\'{"tag": "{{tagName}}", "shareId": {{shareId}}, "isCollection": {{isCollection}} }\' tagname="{{tagName}}" ></a>',btn:"#tags-edit",DEL_TAG_ALL:"http://share.renren.com/share/tag/deleteUserShareTag",DEL_TAG_ONE:"http://share.renren.com/share/tag/deleteShareTag",DEL_COLLECTION:"http://share.renren.com/share/tag/deleteCollectionTag",GET_TAG:"http://share.renren.com/share/tag/userTags",ADD_TAGS:"http://share.renren.com/share/tag/addShareTag",ADD_COLLECTION_TAGS:"http://share.renren.com/share/tag/addCollectionTag",maxSelectedCount:5}});this.initialize=function(f,g){var h={};object.extend(h,f.get("defaultOption"));f.set("option",object.extend(h,g));g=f.get("option");f.el=e.getElement(g.el);f.listEl=e.getElement(g.list);f.btn=e.getElement(g.btn);if(f.el&&f.listEl){f.initPlane()}f.initDelegates()};this.initPlane=function(f){var i=f.get("option"),j=f.el.getData("tags"),g=i.tpl,h;j=JSON.parse(j);f.listData=f.handleData(j);f.renderPlane()};this.renderPlane=function(f){var h=f.get("option"),g;g=Mustache.to_html(h.tpl,f.listData);f.listEl.setHTML(g)};this.handleData=function(f,k){var j=k.type,g=XN.user.id,i=k.currentTag,h=false;k.items.unshift({tagName:"未分类",type:j,untag:1,all:true});k.items.unshift({tagName:"全部",type:j,all:true});k.items.forEach(function(l){l.type=j;l.userId=g;l.baseUrl=k.baseUrl;l.tagNameUrl=encodeURIComponent(l.tagName);if(l.tagName==i){l.current=true;h=true}});if(!h){k.items[0].current=true}return k};this.ismouseleave=function(f,i,h){var j=i.relatedTarget;while(j&&j!=h){try{j=j.parentNode}catch(g){j=h}}return j!==h};this.initDelegates=function(g){var f;if(g.el&&g.listEl){g.el.delegate(".tags-edit","click",function(h){g.switchEditBtn(g.btn)})}f=e.getElement(".share-main-content");if(!f){return}f.delegate(".tag-server-remove","click",function(i){var h=i.srcElement||i.target;g.removeTag(e.wrap(h));XN.event.stop(i)});f.delegate(".share-tags li","mouseover",function(h){var i;i=e.wrap(this).getElement(".tag-server-remove");if(i&&i.hasClass("hover-show")){i.show()}});f.delegate(".share-tags li","mouseout",function(i){var j,h;j=e.wrap(this).getElement(".tag-server-remove");if(j&&j.hasClass("hover-show")&&!Sizzle.contains(this,i.relatedTarget||i.toElement)){j.hide()}});f.delegate(".tag-server-add","click",function(o){var l=g.get("option"),k=o.srcElement||o.target,n=JSON.parse(e.wrap(k).getData("tag")),j=k.getParent("li"),i,h,m;n.userId=XN.user.id;m=n.baseUrl;i=j.getParent("ul").getElements("li").length-2;if(i>=l.maxSelectedCount){h=j.getParent("ul").getElement(".tag-error-box");h.show();setTimeout(function(){h.hide()},3000);return null}new XN.net.xmlhttp({url:l.GET_TAG,data:XN.array.toQueryString(n),onSuccess:function(r){var p=JSON.parse(r.responseText),q;if(p.items.length==0){XN.Do.showError("已经没有标签了");return}XN.Do.confirm({title:"选择标签",msg:' <div class="share-tags clearfix" id="share-tags-add">                                    <div class="share-list" id="share-tags-add-list"></div>                                    <input style="width: 300px;" id="tag-input" placeholder="自定义标签">                                    <span id="tag-error-box">总共不能添加超过5个选中标签，每个标签用空格分开</span>                                </div>',callBack:function(u){if(u){var t=q.toArray(),s={};if(t.length>0){s.shareId=n.shareId;s.userId=n.userId;s.tags=t}else{return null}new XN.net.xmlhttp({url:n.isCollection?l.ADD_COLLECTION_TAGS:l.ADD_TAGS,data:XN.array.toQueryString({post:JSON.stringify(s)}),onSuccess:function(B){var x=JSON.parse(B.responseText),z=XN.json.parse(g.el.getData("tags")),y=false,v,w,A;if(x.code===0){t.forEach(function(C){y=false;A={};A.shareId=n.shareId;A.isCollection=n.isCollection||0;A.tagName=C;A.tagNameUrl=encodeURIComponent(C);A.baseUrl=m;v=e.wrap(document.createElement("li"));v.setHTML(Mustache.to_html(l.tagTpl,A));j.grab(v,"before");z.items.forEach(function(D){if(!y){if(D.tagName==A.tagName){y=true}}});if(!y){z.items.push({tagName:A.tagName})}});g.el.setAttribute("data-tags",JSON.stringify(z));g.initPlane()}else{XN.Do.showError(x.msg)}},method:"post"})}}});q=new c.Tags({el:"#share-tags-add",list:"#share-tags-add-list",switchOne:".tag-record",errorBox:"#tag-error-box",input:"#tag-input",selectedCount:i,maxShowCount:20,items:p.items})},method:"get"})})};this.removeTag=function(f,h){var i=f.get("option"),j=JSON.parse(h.getData("tag")),g;j.userId=XN.user.id;if(j.isCollection){g=i.DEL_COLLECTION}else{g=j.shareId?i.DEL_TAG_ONE:i.DEL_TAG_ALL}XN.Do.confirm({title:"删除标签",message:"确定删除"+j.tag+"标签吗？",callback:function(k){if(k){new XN.net.xmlhttp({url:g,data:XN.array.toQueryString({post:JSON.stringify(j)}),onSuccess:function(m){var l=JSON.parse(m.responseText);if(l.code===0){if(!j.shareId){f.removeTagAll(j.tag)}else{h.getParent("li").dispose()}}else{XN.Do.showError(l.msg)}},method:"post"})}}})};this.removeTagAll=function(f,h){var g=e.getElements("[tagName="+h+"]");g.forEach(function(i){i.getParent("li").dispose()})};this.switchEditBtn=function(f,g){if(g.getAttribute("opened")==="true"){f.listEl.getElements(".tag-record").forEach(function(h){if(h.hasClass("tag-server-remove")){h.hide()}else{h.setAttribute("ui-async","async");h.href=h.getAttribute("link-data")}});g.setAttribute("opened","false");g.setHTML('<span class="icon-edit"></span>管理标签')}else{f.listEl.getElements(".tag-record").forEach(function(h){if(h.hasClass("tag-server-remove")){h.show()}else{h.removeAttribute("ui-async");h.setAttribute("link-data",h.href);h.href="javascript:;"}});g.setHTML('<span class="icon-edit"></span>退出管理');g.setAttribute("opened","true")}}})});object.use("tags/edit",function(a){XN.dom.ready(function(){new a.TagsEdit({el:"#share-tags-show",list:"#share-tags-list"})})});(function(){if(!!XN.app.share.shareGetInterfaced){return}XN.app.share.shareGetInterfaced=true;var b="",d="",a=null,c=false;XN.app.share.addEvent("getInterface",function(e){if(!e||!e.url||!e.url.indexOf("popup.do")===-1){return}b=document.getElementsByName("srccmturl")[0];d=document.getElementsByName("srccmtdata")[0];a=$("comment_on_firstshare");if(!b||!d||!a){return}b=b.value;d=d.value;a.checked=c=true;$(a).addEvent("click",function(){c=this.checked})});XN.app.share.addEvent("postSuccess",function(e){if(!e||!e.body||!c){return}new XN.net.xmlhttp({url:b,data:d+e.body})})})();