/*
 * 各种缩图计算
 * author: huaxin.huang@renren-inc.com
 * 
 * ow,oh 为原先的图片尺寸
 * ww, wh 为需要的图片尺寸
 * 说明: ow, oh 必需提供,如果没有,返回的图片尺寸为0,需要再做判断

 * getUrl: 获取缩图后的链接, type:/p/m2w180hq85lt_
 * getSize: 获取缩图后的图片尺寸
 * getFullSize: 获取刚好可以拉伸到铺满屏幕的图片大小,以及margin值
 * getOriginalSize: 图片不拉伸,获取margin值
 * getSuotuSize: getSize 和 getFullSize 的结合
 */(function(){XN.namespace("XN.photo.suotu");var e={getUrl:function(e,t){var n=e.split("/"),r=n.pop(),i=n.join("/");return i+t+r},getSize:function(e,t,n,r){var i=height=0;if(!!e&&!!t)if(!r)e<=n?(i=e,height=t):(i=n,height=n*t/e);else if(!n)t<=r?(i=e,height=t):(height=r,i=r*e/t);else if(r&&n){var s=0;e<=n&&t<=r?s=1:e>n&&t>r?s=Math.max(n/e,r/t):s=Math.min(n/e,r/t),i=s*e,height=s*t}return{imgWidth:i,imgHeight:height}},getFullSize:function(e,t,n,r){var i=height=lv=tv=0;if(!e||!t)return{imgWidth:0,imgHeight:0,imgLeft:0,imgTop:0};if(e>n&&t>r)i=e,height=t;else{var s=Math.max(n/e,r/t);i=e*s,height=t*s}return lv=(n-i)/2,tv=(r-height)/2,{imgWidth:i,imgHeight:height,imgLeft:lv,imgTop:tv}},getOriginalSize:function(e,t,n,r){if(!e||!t)return{imgLeft:0,imgTop:0};var i=e,s=t;return{imgLeft:(n-i)/2,imgTop:(r-s)/2}},getSuotuSize:function(e,t,n,r,i,s){var o=this.getSize(e,t,n,r);return this.getFullSize(o.imgWidth,o.imgHeight,i,s)}};XN.photo.suotu=e})(),function(){function t(t,n){var r=this;this.history=t,this.blankHTML="/blank.html",this._ignoreHashChange=!1,t.pushState=function(){r.pushState.apply(r,arguments)},n&&(r.fireEvent=n.fireEvent,n.blankHTML&&(r.blankHTML=n.blankHTML)),e?(t._oniframechange=function(){r.onIFrameChange.apply(r,arguments)},window.attachEvent("onload",function(){r.firePopState(),r.makeIFrame(function(){r._isInit=!0,r.makeIFrameHistory("")})})):window.addEventListener?(window.addEventListener("hashchange",function(){r.onHashChange.apply(r,arguments)},!1),window.addEventListener("load",function(){r.firePopState()},!1)):(window.attachEvent("onhashchange",function(){r.onHashChange.apply(r,arguments)}),window.attachEvent("onload",function(){r.firePopState()}))}var e=!!window.ActiveXObject&&(!window.XMLHttpRequest||!!window.XMLHttpRequest&&(!document.documentMode||document.documentMode===7));t.prototype={makeIFrame:function(e){var t="html5history-iframe",n=document.createElement("iframe");n.setAttribute("id",t),document.domain!=location.hostname&&n.setAttribute("src","http://"+document.domain+this.blankHTML),n.style.display="none",n.attachEvent("onload",function(){n.detachEvent("onload",arguments.callee),setTimeout(function(){e()},0)}),document.body.appendChild(n),this.iframe=n},makeIFrameHistory:function(e){var t=this.iframe.contentWindow.document;t.open(),t.write(["<html>","<head>",'<meta http-equiv="Pragma" content="no-cache" />','<meta http-equiv="Expires" content="-1" />',"<script>",document.domain!=location.hostname?'	document.domain="'+document.domain+'";':"","	function pageLoad() {",'		try { top.window.history._oniframechange("'+e+'") } catch(e) {}',"	}","</script>","</head>",'<body onload="pageLoad()">','<div id="url">'+e+"</div>","</body>","</html>"].join("")),t.title=document.title,t.close()},firePopState:function(){if(this.fireEvent)this.fireEvent(window,"popstate");else if(document.createEvent){var e=document.createEvent("UIEvents");e.initEvent("popstate",!1,!1),e.state=null,window.dispatchEvent(e)}typeof window.onpopstate=="function"&&window.onpopstate()},pushState:function(e,t,n){if(n.substr(0,1)!="#"||location.hash==n)throw"由于浏览器限制，你必须传入一个与当前hash不同的hash值";this._pushState(e,t,n)},_pushState:e?function(e,t,n){this._ignoreHashChange=!0,this.makeIFrameHistory(n)}:function(e,t,n){this._ignoreHashChange=!0,window.location.hash=n},onIFrameChange:function(e){this._isInit?this._isInit=!1:(location.hash=e,this._ignoreHashChange||this.firePopState(),this._ignoreHashChange=!1)},onHashChange:function(e){this._ignoreHashChange||this.firePopState(),this._ignoreHashChange=!1}},t.bind=function(e,n){if(e.pushState)return;new t(e,n)},window.HTML5History=t}(),XN.namespace("XN.photo"),XN.photo.libs={},function(){function t(t){var n=this;this.settings={range:200,event:"scroll",elements:"img",container:window,loadHide:!1,mode:"vertical",realSrcAttribute:"data-src",loadImage:e.funcBind(function(e){e.onload=function(){e.loaded=!0,e.removeAttribute(this.settings.realSrcAttribute)},e.src=e.getAttribute(this.settings.realSrcAttribute)},n)},e.$extend(this.settings,t),this.init()}var e={addEvent:XN.event.addEvent,delEvent:XN.event.delEvent,id:$,$extend:$extend,getDoc:function(){var e=document.compatMode,t=e=="CSS1Compat"?document.documentElement:document.body;return t},getScroll:function(e){function r(e){return Math.max(document.documentElement[e],document.body[e])}var t=0,n=0;return e==window?(t=r("scrollLeft"),n=r("scrollTop")):(t=e.scrollLeft,n=e.scrollTop),{x:t,y:n}},getPosition:function(e,t,n){var r=0,i=0;if(e.getBoundingClientRect){var s=e.getBoundingClientRect(),o=Math.max(document.documentElement.scrollTop,document.body.scrollTop),u=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return s.left==0&&s.top==0?{x:s.left,y:s.top}:{x:s.left+u,y:s.top+o}}do{if(t&&e==t)break;r+=parseInt(e.offsetLeft),i+=parseInt(e.offsetTop)}while(e=e.offsetParent);return{x:r,y:i}},getSize:function(t){var n=e.getDoc();return{x:n.clientWidth,y:n.clientHeight}},funcBind:function(e,t){var n=e;return function(){return n.apply(t,arguments)}}};e.$extend(t.prototype,{lastRunTime:new Date,times:null,refresh:function(){var t=this;this.elements=Sizzle(this.settings.elements),this.filter(function(e){return e.getAttribute(t.settings.realSrcAttribute)?!0:!1}),this.filter(function(e){return t.isLoadImage(e)?(t.settings.loadImage(e),!1):!0}),this.bindEventListener=e.funcBind(this.eventFunc,this),e.addEvent(this.container,this.settings.event,this.bindEventListener)},init:function(){var t=this;this.container=e.id(this.settings.container),this.elements=Sizzle(this.settings.elements),this.largestPosition=0,this.axis=this.settings.mode=="vertical"?"y":"x",this.offset=this.container!=document.body&&this.container!=document.body?this.container:null,this.filter(function(e){return e.getAttribute(t.settings.realSrcAttribute)?!0:!1}),this.filter(function(e){return t.isLoadImage(e)?(t.settings.loadImage(e),!1):!0}),this.bindEventListener=e.funcBind(this.eventFunc,this),e.addEvent(this.container,this.settings.event,this.bindEventListener)},isLoadImage:function(t){var n=e.getPosition(t,this.offset,this.settings.loadHide)[this.axis],r=e.getScroll(this.settings.container)[this.axis],i=e.getSize(this.container)[this.axis];return n>r-this.settings.range&&n<r+this.settings.range+i&&n!=0},filter:function(e){var t=[],n;for(var r=0,i=this.elements.length;r<i;r++)n=this.elements[r],e(n)&&t.push(n);this.elements=t},eventFunc:function(){var t=this;this.scrollTimer(function(){t.filter(function(e){return t.isLoadImage(e)?(t.settings.loadImage(e),!1):!0}),t.elements.length==0&&e.delEvent(t.container,t.settings.event,t.bindEventListener)},250)},scrollTimer:function(e,t){new Date-this.lastRunTime>t&&(clearTimeout(this.times),this.times=setTimeout(function(){e.apply()},100),this.lastRunTime=new Date)}}),XN.photo.libs.lazyload=function(e){return new t(e)}}(),XN.namespace("XN.photo"),function(){function e(e){this.settings={container:window,elements:"img",offsetX:0,offsetY:0,bound:15,pagerShow:function(){},pagerChange:function(e){},itemsAllShowed:function(){},perPageCount:15},$extend(this.settings,e),this.curPageNum=0,this.init()}function t(e){var t=0,n=0;while(e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t,y:n}}$extend(e.prototype,{lastScrollTop:0,init:function(){this.bindEvtListener=this.evtListener.bind(this),this.elements=Sizzle(this.settings.elements),this.evtListener(),XN.event.addEvent(this.settings.container,"scroll",this.bindEvtListener)},refresh:function(){this.bindEvtListener=this.evtListener.bind(this),this.elements=Sizzle(this.settings.elements),this.evtListener(),XN.event.addEvent(this.settings.container,"scroll",this.bindEvtListener)},evtListener:function(){var e=XN.event.scrollTop(),t=0,n=this.settings;if(Math.abs(e-this.lastScrollTop)<n.bound)return!1;for(var r=0,i=this.elements.length;r<i;r++){if(!this.checkViewed(this.elements[r]))break;t+=1}var s=t/n.perPageCount,o;parseInt(s)==s?o=++s:o=Math.ceil(s),o!=this.curPageNum&&(this.curPageNum=o,n.pagerChange(this.curPageNum)),t==this.elements.length&&(this.curPageNum++,n.itemsAllShowed()),this.lastScrollTop=XN.event.scrollTop()},getScrolledArea:function(){return{x:XN.event.winWidth(),y:XN.event.scrollTop()}},checkViewed:function(e){var n=this.settings,r=this.getScrolledArea(),i=e.offsetWidth,s=e.offsetHeight;if(i==0&&s==0)return!1;var o=t(e),u={x:o.x+i,y:o.y+s};return u.x<r.x+n.offsetX&&u.y<r.y+n.offsetY?!0:!1}}),XN.photo.libs.fixpager=function(t){return new e(t)}}(),function(){function e(e){var t=0,n=0;while(e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t,y:n}}function t(e){this.setting={dragable:!0,dropable:!0,showMask:!0,container:document,maskOpacity:.8,minMoveX:10,minMoveY:10,selector:"img",onStart:function(e){},onEnd:function(){},onMove:function(){}},$extend(this.setting,e),this.startX=0,this.startY=0,this.cursorX=0,this.cursorY=0,this.hasMoved=!1,this.init()}$extend(t.prototype,{init:function(){this.getElements(),this.bindMousedown=this.bindEventListener(this.mousedown),this.bindMousemove=this.bindEventListener(this.mousemove),this.bindMouseup=this.bindEventListener(this.mouseup),XN.event.addEvent(this.setting.container,"mousedown",this.bindMousedown)},refresh:function(){this.elements=Sizzle(this.setting.selector,this.setting.container)},bindEventListener:function(e){var t=this;return function(n){var r=n||window.event;e.apply(t,[r])}},getElements:function(){this.elements=Sizzle(this.setting.selector,this.setting.container)},checkCanbeAction:function(e){var t=this.elements,n=!1;for(var r=0,i=t.length;r<i;r++)if(t[r]===e){n=!0;break}return n},setStyle:function(){if(!this.mask)return;$(this.mask).style.position="absolute",$(this.mask).style.zIndex="1000"},createDragEl:function(e){var t=$element("div");return t.addClass("drag-photo-el"),t.appendChild(e),t},createPlaceHolderEl:function(){var e=$element("li");return e.addClass("drag-photo-holder"),e},getParentLi:function(e){while(e.tagName.toLowerCase()!="li")e=e.parentNode;return e},insertAfter:function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},insertBefore:function(e,t){e.parentNode.insertBefore(t,e)},mousedown:function(e){var t=XN.event.element(e);return this.checkCanbeAction(t)?(this.startX=XN.event.pointerX(e),this.startY=XN.event.pointerY(e),this.elX=$(t).realLeft(),this.elY=$(t).realTop(),this.dragSourceEl=this.getParentLi(t),this.mask=this.createDragEl(t.cloneNode("true")),XN.browser.IE?(XN.event.addEvent(t,"losecapture",this.bindMouseup),this.mask&&this.mask.setCapture(),this.addEvent(this.mask,"mousemove",this.bindMousemove),this.addEvent(this.mask,"mouseup",this.bindMouseup)):(XN.event.addEvent(window,"blur",this.bindMouseup),e.preventDefault(),this.addEvent(document,"mousemove",this.bindMousemove),this.addEvent(document,"mouseup",this.bindMouseup)),this.setDomValue(),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),!1):!1},mouseup:function(e){var t=XN.event.element(e);return XN.browser.IE?(XN.event.delEvent(t,"losecapture",this.bindMouseup),this.mask&&this.mask.releaseCapture(),this.delEvent(this.mask,"mousemove",this.bindMousemove),this.delEvent(this.mask,"mouseup",this.bindMouseup)):(XN.event.delEvent(window,"blur",this.bindMouseup),e.preventDefault(),this.delEvent(document,"mousemove",this.bindMousemove),this.delEvent(document,"mouseup",this.bindMouseup)),this.hasMoved?(XN.event.stop(e),this.holderEl.parentNode.replaceChild(this.dragSourceEl,this.holderEl),$(this.mask).remove(),this.mask=null,this.hasMoved=!1,this.setting.onEnd(this.dragSourceEl)):(this.mask&&this.mask.parentNode&&$(this.mask).remove(),this.mask=null,this.hasMoved=!1,this.startX=0,this.startY=0),!1},mousemove:function(e){var t=XN.event.pointerX(e),n=XN.event.pointerY(e);if(Math.abs(t-this.startX)>5||Math.abs(n-this.startY)>5){if(!this.hasMoved){this.setStyle();if(!this.mask)return!1;document.body.appendChild(this.mask),XN.browser.IE&&this.mask&&this.mask.setCapture(),this.holderEl=this.createPlaceHolderEl(this.dragSourceEl),this.dragSourceEl.parentNode.replaceChild(this.holderEl,this.dragSourceEl),this.hasMoved=!0}if(this.setting.photoCount>1e3)XN.DO.alert({title:"提示",message:"抱歉，超过1000张的相册不能排序"});else{this.cursorX=t,this.cursorY=n,this.curDragElX=t-this.startX+this.elX,this.curDragElY=n-this.startY+this.elY;if(!this.mask)return!1;this.mask.style.left=this.curDragElX+"px",this.mask.style.top=this.curDragElY+"px",this.checkHit(),this.checkToScroll()}}},setLimit:function(){},checkLimit:function(){},addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},delEvent:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)},setDomValue:function(){var t=this.setting.container.getElementsByTagName("li");for(var n=0,r=t.length;n<r;n++){var i=e(t[n]);t[n].setAttribute("drag_left",i.x),t[n].setAttribute("drag_top",i.y),this.hasRecord||(this.imgWidth=t[n].offsetWidth,this.imgHeight=t[n].offsetHeight,this.hasRecord=!0)}},checkHit:function(){var e=this.setting.container.getElementsByTagName("li"),t=0,n=0;for(var r=0,i=e.length;r<i;r++)if(this.cursorY>e[r].getAttribute("drag_top")&&this.cursorY<this.imgHeight+parseInt(e[r].getAttribute("drag_top"))&&e[r]!=this.holderEl){t=parseInt(e[r].getAttribute("drag_left")),n=this.imgWidth;if(this.cursorX>t&&this.cursorX<=t+n/2){this.insertAfter(e[r],this.holderEl),this.setDomValue();break}if(this.cursorX>t+n/2&&this.cursorX<t+n){this.insertBefore(e[r],this.holderEl),this.setDomValue();break}}},checkToScroll:function(){var e=XN.event.pageHeight(),t=XN.event.winHeight(),n=30,r=XN.event.scrollTop();t+r<=e&&t+r-this.cursorY<n&&window.scrollTo(0,r+n),r!=0&&this.cursorY-r<n&&window.scrollTo(0,r-n)}}),XN.photo.libs.dragdrop=function(e){return new t(e)}}(),object.define("xn/photo/album_preview","dom",function(require,e){function n(e,t){var n,i=e.type.toLowerCase();if(i=="mouseover")n=e.relatedTarget||e.fromElement;else{if(i!="mouseout")return!0;n=e.relatedTarget||e.toElement}return n&&n.prefix!="xul"&&!r(t,n)}function r(e,t){return t===e?!0:e.contains?e.contains(t):!!(e.compareDocumentPosition(t)&16)}var t=require("dom");e.albumPreview=new Class(function(){var e={initialize:function(e,n){e.option={cavansSelector:".album-home .album-list",hoverSelector:"li a.photo-collection",itemSelector:"img",startTime:200,changeDuration:1500,duration:2e3},$extend(e.option,n),e.canvas=t.getElement(e.option.cavansSelector),e.playTimer=null,e.current=e.showMotion=e.hideMotion=null,e.itemCollection={}},addEvent:function(e){e.canvas.delegate(e.option.hoverSelector,"mouseover",function(r){if(!n(r,this))return;var i=this.getData("preview");if(i!="1")return;var s=0,o=1,u=this.uid,a;e.itemCollection.hasOwnProperty("ele"+u)?a=e.itemCollection["ele"+u]:a=e.itemCollection["ele"+u]=t.getElements(e.option.itemSelector,this);if(a.length<2)return;e.playTimer&&clearTimeout(e.playTimer),e.playTimer=setTimeout(function(){e.current=a[o],e.showPhoto(a,s,o),s=o,o=o+1>=a.length?0:o+1,o!=0&&(e.playTimer=setTimeout(arguments.callee,e.option.duration))},e.option.startTime)}),e.canvas.delegate(e.option.hoverSelector,"mouseout",function(r){if(!n(r,this))return;e.playTimer&&clearTimeout(e.playTimer);var i=this.uid,s=e.itemCollection["ele"+i]||t.getElements(e.option.itemSelector,this);e.showMotion&&e.showMotion.stop(),e.hideMotion&&e.hideMotion.stop(),e.current!=s[0]&&e.hide(e.current),e.show(s[0])})},showPhoto:function(e,t,n,r){if(t.length==0)return;e.hide(t[n],!0),e.show(t[r],!0)},show:function(e,t,n){if(!t)return;n?(e.showMotion=new XN.effect.Motion("linear",200),e.showMotion.onTweening=function(){XN.browser.IE&&!XN.browser.IE9&&!XN.browser.IE10?t.style.filter="alpha(opacity="+this.equation(0,100)+")":t.style.opacity=this.equation(0,1)},e.showMotion.onComplete=function(){t.style.display="block"},e.showMotion.start()):(t.style.display="block",XN.browser.IE&&!XN.browser.IE9&&!XN.browser.IE10?t.style.filter="alpha(opacity=100)":t.style.opacity=1)},hide:function(e,t,n){if(!t)return;n?(e.hideMotion=new XN.effect.Motion("linear",200),e.hideMotion.onTweening=function(){XN.browser.IE?t.style.filter="alpha(opacity="+this.equation(100,0)+")":t.style.opacity=this.equation(1,0)},e.hideMotion.onComplete=function(){t.style.display="none"},e.hideMotion.start()):t.style.display="none"}},r=this;Object.keys(e).forEach(function(t){r[t]=e[t]})})}),XN.namespace("XN.page"),XN.page.albumList={},XN.page.photoList={},function(){function checkInSelector(e,t,n){var r=Sizzle(t,n||document),i=!1;for(var s=0,o=r.length;s<o;s++)if(e===r[s]){i=!0;break}return i}function getParentMath(e,t){while(!t(e))e=e.parentNode;return e}function getParentLi(e){return getParentMath(e,function(e){return e.tagName.toLowerCase()=="li"})}function errFunc(){XN.DO.showMessage("服务器有点小问题，请稍候重试 :)")}function fadeInTip(e){var t=XN.DO.showMessage("<span>"+e+"</span>",null,2);t.setWidth(t.body.getElementsByTagName("span")[0].offsetWidth+50),t.header.hide(),t.body.parentNode.style.border="none",t.header.parentNode.style.border="none"}function listReOrder(e,t,n){var r=Sizzle(e),i=null;for(var s=0,o=r.length;s<o;s++){var i=Sizzle(t,r[s]);s<o-1&&o>1&&(i.length<n&&r[s].appendChild(Sizzle(t,r[s+1]).shift()),i.length>n&&r[s+1].insertBefore(i.pop(),Sizzle(t,r[s+1])[0]))}}var hasChild=function(e,t){return e.contains?e.contains(t):!!(e.compareDocumentPosition(t)&16)},fixedMouse=function(e,t){var n,r=e.type.toLowerCase();if(r=="mouseover")n=e.relatedTarget||e.fromElement;else{if(r!="mouseout")return!0;n=e.relatedTarget||e.toElement}return n&&n.prefix!="xul"&&!hasChild(t,n)},mstpl=function(e,t){var n={},r=function(e,t){var r=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):n[e]=n[e]||this.tmpl(document.getElementById(e).innerHTML);return t?r(t):r};return r(e,t)};XN.page.albumList.initFriendsPhotoSelector=function(e){if(!$(e))return!1;var t=new XN.ui.friendSelectorWithMenu({autoSelectFirst:!0,noInput:"输入好友的姓名"});t.input.style.width="175px",$(e).setContent(t),t.menu.setWidth(t.input.offsetWidth),t.addEvent("select",function(e){window.location.href="http://photo."+XN.env.domain+"/photo/"+e.id+"/album/relatives"}),(new XN.FORM.inputHelper(t.input)).setDefaultValue("输入好友姓名")},XN.page.albumList.getRunOnceFunc=function(e){var t=!1;return function(){t||e(),t=!0}},XN.page.albumList.initLazyLoad=function(e,t){XN.photo.libs.lazyload||XN.log("lazyload没有准备好");var n="http://img.xiaonei.com/photos/0/0/main.png",r=Sizzle(".photo-list")[0].id,i=XN.photo.libs.lazyload({range:200,elements:e,realSrcAttribute:"data-src",loadImage:function(e){var s=e.getAttribute("data-src"),o=new Image,u="id_small_"+Math.random();o.onload=function(){if(e.className.indexOf("preview-hide")!=-1){e.style.backgroundImage='url("'+s+'")';return}if(e.style.opacity!=1&&e.style.filter!="alpha(opacity=100)"){var t=new XN.effect.Motion("linear",200);t.onStart=function(){XN.browser.IE?e.style.filter="alpha(opacity=0)":e.style.opacity=0,e.style.backgroundImage='url("'+s+'")'},t.onTweening=function(){XN.browser.IE?e.style.filter="alpha(opacity="+this.equation(0,100)+")":e.style.opacity=this.equation(0,1)},t.start();try{delete window[u]}catch(n){window[u]=undefined}}},o.onerror=function(){e.style.backgroundImage='url("'+n+'")';try{delete window[u]}catch(t){window[u]=undefined}},window[u]=o,o.src=s;if(t){t.lazyPage<3&&(t.lazyPage=3);var a=document.getElementById(r).getElementsByTagName("img"),f=document.getElementById(r).getElementsByTagName("li"),l=a[a.length-1]}t&&e==l&&f.length<t.aPhotoCount&&new XN.net.xmlhttp({url:"http://photo.renren.com/photo/"+t.ownerId+"/album-"+t.albumId+"/bypage/ajax?curPage="+(t.lazyPage-1)+"&pagenum=20",method:"GET",onSuccess:function(e){var e=XN.json.parse(e.responseText),n=Math.ceil(e.photoList.length/20),r=e.photoList.length%20||20,s=20;for(var o=0;o<n;o++){var u=[];t.lazyPage+=1;var a=document.createElement("div");a.className="other-page clearfix",u[0]='<div class="page-num clearfix page-at-photolist" id="page-fixer1-'+(t.lazyPage-1)+'" style="visibility: visible;" > 第'+(t.lazyPage-1)+"页</div><ul>",s=o!=n-1?s:r;for(var f=0;f<s;f++){var l="photo",c=e.photoList[f+o*20].largeUrl,h=t.ownerId,p=e.photoList[f+o*20],d=e.photoList[f+o*20].photoId;u[f+1]='<li data-info="{album:'+t.albumId+", photo:"+e.photoList[f+o*20].photoId+", owner:"+t.ownerId+", position:"+e.photoList[f+o*20].position+", positionSaved:"+e.photoList[f+o*20].positionSaved+'}">'+"<a"+(t.uoShowOrder?' style="cursor:move"':" ")+'href="'+t.asUrlPhoto+"/photo/"+t.ownerId+"/photo-"+e.photoList[f+o*20].photoId+'" class="picture">'+'<img src="'+t.asUrlStatic+'/a.gif" data-src="'+e.photoList[f+o*20].mainUrl+'" data-photo="{ptype: &quot;'+l+"&quot;,large:&quot;"+c+"&quot;,owner:&quot;"+h+"&quot;,id: &quot;"+d+"&quot;,xLarge:&quot;"+e.photoList[f+o*20].xLarge+"&quot;,xWidth:"+"&quot;"+e.photoList[f+o*20].xWidth+"&quot;,xHeight:&quot;"+e.photoList[f+o*20].xHeight+'&quot;}"/>'+"</a>"+'<div class="photo-oper">'+(t.uoShowEditTitle?'<a class="photo-edit" href="javascript:;">编辑</a>':'<a class="photo-list-like-handler photo-list-zan'+(p.like?e.likeType=="xihuan"?"photo-list-liked":"photo-list-zaned":"")+'" href="javascript:;" data-liked="'+p.like+'"></a>')+"</div>"+(t.uoShowEditTitle?'<div class="myphoto-info"><span class="descript">'+e.photoList[f+o*20].titleWithAt+'</span></div><div class="edit-desc"><div class="edit-content"><input type="text" value="'+e.photoList[f+o*20].title+'" data-privacy='+e.photoList[f+o*20].privacyV7Ext+' /><p>可按<span class="enter-ico">回车</span>保存、<span class="">Esc</span>取消</p></div></div>':'<div class="myphoto-info"><span class="descript">'+e.photoList[f+o*20].titleWithAt+"</span></div>")+"</li>"}u[s+1]="</ul>",a.innerHTML=u.join(""),Sizzle(".photo-list")[0].appendChild(a)}e.photoList.length>0&&i.refresh(),dd.refresh();if(XN.browser.IE6){var v=Sizzle(".photo-list li");XN.array.each(v,function(e,t){XN.event.addEvent(t,"mouseover",function(){this.addClass("hover")}),XN.event.addEvent(t,"mouseout",function(){this.delClass("hover")})})}}})}});return i},XN.page.albumList.initFixPager=function(e,t,n,r){var i=null,t=t||"page-fixer-",n=n||15,r=r||document.body,s=!0,o,u=XN.photo.libs.fixpager({elements:e,perPageCount:n,pagerShow:function(){},pagerChange:function(e){XN.browser.IE6||(e>1?(console.log(o),o||(o=$($(t+e).cloneNode(!0)),o.removeAttribute("id"),o.addClass("page-fixed"),o.style.width=r.offsetWidth+"px",r.appendChild(o)),o.show(),o.innerHTML=o.innerHTML.replace(/\d+/,e)):o&&o.hide(),s?s=!1:u.refresh())},itemsAllShowed:function(){o&&o.hide()}})};var albumPage=XN.page.albumList,ev=XN.event;albumPage.protect={init:function(e){var t=this,n=$(e);ev.addEvent(n,"click",function(e){var n=e||window.event,r=ev.element(n),i=r.getAttribute("ui-command")||r.parentNode.getAttribute("ui-command");if(i){var s=i.split(";");i&&s[0]=="password"&&(XN.event.stop(n),t.setUrl(s[1],s[2]),t.popup())}})},setUrl:function(e,t){this.url="http://photo."+XN.env.domain+"/photo/"+e+"/album-"+t},popup:function(){var e=this;XN.dom.disable(),this.dialog=XN.DO.confirm({title:"输入密码",message:e.buildHTML(),callBack:function(t){if(!t)return;this.preventHide(),e.check()}}),this.elMsgCon=$("_temp_body"),$("_temp_body").removeAttribute("id"),this.elVal=$("_temp_val"),$("_temp_val").removeAttribute("id"),this.elMsg=$("_temp_msg"),$("_temp_msg").removeAttribute("id")},check:function(e){if(XN.string.trim(this.elVal.value)=="")return this.showMsg("请填写密码"),!1;var t=this;new XN.net.xmlhttp({url:t.url+"/private/ajax",data:"password="+t.elVal.value,onSuccess:function(e){var n=XN.json.parse(e.responseText);n.code!=0?t.showMsg(n.msg):location.href=t.url+"?t="+n.msg},onError:function(){errFunc()}})},showMsg:function(e){this.elMsg.setContent(e),this.elMsg.show(),this.elMsgCon.addClass("password-error")},clearMsg:function(){this.elMsg.setContent(""),this.elMsgCon.delClass("password-error"),this.elMsg.hide()},buildHTML:function(){return['<div class="password-float" id="_temp_body">',"    <h1>相册的密码 ：</h1>","    <p>",'        <input type="text" class="input-text" style="width: 165px;" value="" id="_temp_val"/>',"        <br/>",'        <span id="_temp_msg" style="display:none"></span>',"    </p>","</div>"].join("")}},function(){function i(){n.blur(),s();var r=t,u=XN.json.parse(r.getData("info"));if(!u.photo)return!1;new XN.net.xmlhttp({url:e.replace(/{owner}/,u.owner).replace(/{photo}/,u.photo),data:"description="+encodeURIComponent(Sizzle(".edit-content input",r)[0].value),onSuccess:function(e){var t=XN.json.parse(e.responseText);t.code?XN.DO.showMessage(t.msg):(Sizzle(".descript",r)[0].innerHTML=t.titleWithAt,Sizzle(".edit-content input",r)[0].value=t.title,r.delClass("select"),XN.event.delEvent(document,"keydown",o),XN.event.delEvent(document,"click",i))},onError:function(){XN.DO.showMessage("服务器有点小问题，请稍候重试 :)")}})}function s(){var e=Sizzle(".mentionFrdList");XN.array.each(e,function(e,t){t.style.left="-8999px",t.style.top="-8999px"})}function o(e){var u=(e||window.event).keyCode;u==13?n.value==""?(s(),n.blur(),Sizzle(".descript",t)[0].innerHTML="",t.delClass("select"),XN.event.delEvent(document,"keydown",o),XN.event.delEvent(document,"click",i)):i():u==27&&(n.blur(),n.value=r,t&&t.delClass("select"),XN.event.delEvent(document,"keydown",o),XN.event.delEvent(document,"click",i),s());if(u==13||u==27)if(document.createEventObject){var a=document.createEventObject();n.fireEvent("onblur",a)}else{var a=document.createEvent("HTMLEvents");a.initEvent("blur",!0,!0),n.dispatchEvent(a)}}function u(e){t&&t.delClass("select"),t=$(getParentLi(e)),t.addClass("select");var s=Sizzle(".edit-content input",t)[0];n=s,r=s.value;var u=XN.json.parse(t.getData("info"));s.mention||object.use("xn.mention",function(e,t){t.mention.Mention.init([{obj:s,ugcId:u.photo,ugcType:"photo",ownerId:u.owner}])}),s.focus(),XN.event.addEvent(s.parentNode,"click",function(e){var e=e||window.event;XN.Event.stop(e)}),XN.event.addEvent(document,"keydown",o),XN.event.addEvent(document,"click",i)}var e="http://photo.renren.com/photo/{owner}/photo-{photo}/description",t=null,n=null,r="";XN.page.photoList.initEditInfo=function(e,t){$(t).addEvent("click",function(n){var r=XN.event.element(n||window.event);checkInSelector(r,e,t)&&(n.stopPropagation(),u(r))})}}(),function(){var e=function(e,t){var n="http://like.renren.com/"+(e.liked?"addlike":"removelike"),r={gid:"photo_"+e.photo,uid:XN.user.id,owner:e.owner,name:XN.user.name,type:2,t:Math.random()},i=Object.keys(r).map(function(e){return e+"="+encodeURIComponent(r[e])}).join("&");new XN.net.xmlhttp({url:n,data:i,method:"get",onSuccess:function(e){var n=XN.json.parse(e.responseText);n.code==0?t&&t():XN.DO.showError(n.msg)},onError:function(){new XN.DO.showError("通信错误")}})},t=$(Sizzle(".photo-list")[0]);if(!t)return;t.delegate(".photo-list-like-handler","click",function(t){var n=XN.event.element(t||window.event),r=XN.element.parent(n,"li"),i=XN.json.parse(r.getData("info")),s=n.getData("liked")=="1",o=n.hasClassName("photo-list-like")?"like":"zan";i.liked=s=!s,e(i,function(){n.setAttribute("data-liked",+s),o=="like"?n.toggleClass("photo-list-liked"):n.toggleClass("photo-list-zaned"),XN.browser.IE6&&(n.style.display="none",n.style.display="block")})});if(XN.browser.IE6){var n=function(e,t){var n=Sizzle(".photo-list-like-handler",e);n&&n.length>0&&(n[0].style.display=t=="show"?"block":"none")};XN.element.delegate(t,"li","mouseover",function(e){n(this,"show")}),XN.element.delegate(t,"li","mouseout",function(e){n(this,"hide")})}}(),function(){function s(e,t,i){new XN.net.xmlhttp({url:t,data:XN.form.serialize(Sizzle("form",e.body)[0]),onSuccess:function(t){var s=XN.json.parse(t.responseText),o=Sizzle("img",e.body)[0];s.code?(r(s.msg).addEvent("hide",function(){n&&XN.dom.disable()}),o&&(o.src+=new Date)):(e.remove(),e=null,n=!1,i())},onError:errFunc})}function o(r,i){t=$(r);if(!t)return!1;var o=XN.json.parse(t.getData("info")),u=e.replace(/{owner}/,o.owner).replace(/{type}/,i).replace(/{id}/,o[i]),a={photo:"照片",album:"相册"},f=function(e){var n=function(){i=="photo"?(t.remove(),setTimeout(function(){location.reload()},2e3)):setTimeout(function(){location.href="http://photo.renren.com/photo/"+o.owner},2e3),XN.DO.showMessage("删除"+a[i]+"成功")};s(e,u,n)};new XN.net.xmlhttp({url:u,method:"GET",onSuccess:function(e){var t=e.responseText;XN.dom.disable();var r=(new XN.ui.dialog).setTitle("删除该"+a[i]+"？").setBody(t).addButton({text:"确定",onclick:function(){this.preventHide(),f(this)}}).addButton({text:"取消",onclick:function(){r.remove(),r=null,n=!1}}).show();n=!0,r.getButton("取消").addClass("gray"),XN.event.addEvent(Sizzle("form input",r.body)[0],"keydown",function(e){e.keyCode==13&&(XN.event.stop(e),f(r))}),Sizzle("input",r.body)[0].focus()},onError:errFunc})}var e="http://photo.renren.com/photo/{owner}/{type}-{id}/delete",t=null,n=!1,r=function(e){return XN.DO.alert({msg:e,type:"error",title:"错误提示",noFooter:!0,modal:!0,autoHide:2})},i;XN.page.photoList.initDel=function(e,t,n,r){var n=n||"photo";$(t).addEvent("click",function(r){var i=XN.event.element(r||window.event),s;checkInSelector(i,e,t)&&(r?r.preventDefault():window.event.returnValue=!1,s=n=="photo"?$(getParentLi(i)):i,o(s,n))})}}(),function(){XN.page.photoList.preview=function(e){e=e||{},object.use("xn/photo/album_preview",function(t){var n=new t.albumPreview(e);n.addEvent()})}}(),function(){XN.page.photoList.sortPhotos={init:function(e,t,n,r,i,s){this.icon=$(t),this.menu=$(n),this.itemMenu=$(r),this.type_selector=i||".function-nav .sort-type-menu li",this.item_selector=s||".function-nav .sort-type-item li",this.lastType=this.timer=null,this.albumId=e,this.addEvent()},bind:function(e,t){return function(){e.apply(t,arguments)}},addEvent:function(){var e=this;this.icon.addEvent("click",this.bind(this.showMenu,this)),this.menu.delegate(this.type_selector,"click",function(t){XN.event.stop(t);var n=this.getData("info");n==="reverse"&&e.ajaSort(5)}),XN.event.addEvent(document.body,"click",function(t){if(jxn(t.target).attr("class")==="sort-photos"||jxn(t.target).parent().attr("class")==="sort-photos")return;e.hideAll()}),$(Sizzle(".sort-photo-tips a")[0]).addEvent("click",function(){XN.cookie.set("close","noShow",7)}),this.menu.delegate(this.type_selector,"mouseover",function(t){e.timer&&clearTimeout(e.timer),e.showItemMenu.call(this,t,e),XN.browser.IE6&&(this.style.background="#F0F5F8"),e.itemMenu.className=e.itemMenu.className}),this.menu.delegate(this.type_selector,"mouseout",function(t){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.hideAll()},500),XN.browser.IE6&&(this.style.background="#FFF")}),this.itemMenu.delegate(this.item_selector,"mouseover",function(t){e.timer&&clearTimeout(e.timer),XN.browser.IE6&&(this.style.background="#F0F5F8")}),this.itemMenu.delegate(this.item_selector,"mouseout",function(t){e.timer&&clearTimeout(e.timer),e.setClose(e.lastType),e.timer=setTimeout(function(){e.hideAll()},500),XN.browser.IE6&&(this.style.background="#FFF")}),this.itemMenu.delegate(this.item_selector,"click",function(t){e.sortPhotos.call(this,t,e)}),XN.dom.ready(function(){var e=$(Sizzle(".sort-photo-tips")[0]);e&&XN.cookie.get("close")&&(e.style.display="none")})},showMenu:function(e){var t=this.icon.getData("open");t==="open"?this.hideAll():(this.show(this.menu),this.setOpen(this.icon))},showItemMenu:function(e,t){if(!fixedMouse(e,this))return;var n=$(this),r=n.getData("info"),i=n.getData("open");if(r==="reverse"){t.hide(t.itemMenu),t.setClose(t.lastType);return}i==="open"?(t.hide(t.itemMenu),t.setClose(n)):(t.showItems(r),t.show(t.itemMenu),t.setOpen(n),t.lastType!=n&&t.setClose(t.lastType),t.lastType=n)},showItems:function(e){this.show(this.itemMenu);var t=this,n=[],r=[];e=="token"?(n=Sizzle(".token-item",this.itemMenu),r=Sizzle(".upload-item",this.itemMenu),this.itemMenu.className="sort-type-item"):e=="upload"&&(n=Sizzle(".upload-item",this.itemMenu),r=Sizzle(".token-item",this.itemMenu),this.itemMenu.className="sort-type-item second-postion"),XN.Array.each(n,function(e,t){$(t).delClass("item-hide"),$(r[e]).addClass("item-hide")})},sortPhotos:function(e,t){var n=this.getData("info"),r="http://photo.renren.com/photo/"+XN.user.id+"/album-"+t.albumId+"/sortPhoto";t.hideAll();var i={uploadDesc:1,uploadAsc:2,exifDesc:3,exifAsc:4},s={type1:"exifDesc",type2:"exifAsc",type3:"uploadDesc",type4
:"uploadAsc"};if(!s["type"+n]||!i[s["type"+n]]){XN.Do.showError("呵呵");return}var o=i[s["type"+n]];t.ajaSort(o)},ajaSort:function(e){if(this.ajaxing)return;this.ajaxing=!1;var t=this,n="http://photo.renren.com/photo/"+XN.user.id+"/album-"+this.albumId+"/sortPhoto";this.hideAll(),XN.dom.disable(),XN.Do.showMsg("正在调整图片顺序",null,60),new XN.net.xmlhttp({url:n,data:"sortType="+e+"&psource="+e,onSuccess:function(e){t.ajaxing=!1;var n={};try{n=XN.json.parse(e.responseText)}catch(r){}n.code==0?(XN.Do.showMessage("排序保存成功"),setTimeout(function(){window.location.href="http://photo.renren.com/photo/"+XN.user.id+"/album-"+t.albumId+"?timeFlag="+n.timeFlag},1e3)):n.sortLimit&&n.sortLimit==1?(XN.Do.showError("照片总数超过300张,暂不支持排序"),XN.dom.enable()):(XN.Do.showError(n.msg||"网络错误，请稍后再试"),XN.dom.enable())},onError:function(){t.ajaxing=!1,XN.Do.showError("网络错误，请稍后再试"),XN.dom.enable()}})},show:function(e,t){e&&(e.style.display=t?t:"block")},hide:function(e){e&&(e.style.display="none")},hideAll:function(){this.hide(this.menu),this.hide(this.itemMenu),this.setClose(this.lastType),this.setClose(this.icon)},setData:function(e,t,n){e&&$(e).setAttribute("data-"+t,n)},setClose:function(e){this.setData(e,"open","close")},setOpen:function(e){this.setData(e,"open","open")}}}(),function(){function Recommend(e){this.option={containerSelector:"#slide-recommend-top",canvasSelector:"#slide-recommend-top .recommend-canvas",preSelector:"#slide-recommend-top .pre",nextSelector:"#slide-recommend-top .next",itemSelector:"div.item",attachTop:!1,leftSelector:null,rightSelector:null,itemTemplate:['<div class="item">','<a class="image" href="{{url}}" target="_blank" data-info="{{type}}">','<img src="{{cover}}" origSize="{{width}}_{{height}}" width="{{imgWidth}}px" height="{{imgHeight}}px" style="margin-left:{{imgLeft}}px;margin-top:{{imgTop}}px" />',"</a>",'<div class="note">','<div class="description">','<a href="{{url}}" title="{{name}}" target="_blank">{{name}}</a>',"</div>","</div>","</div>"].join(""),size:240,ownerId:"",albumId:"",isTop:!1,navHeight:31},$extend(this.option,e),this.index=1,this.onAnimate=!1,this.height=280,this.canShow=!1,this.showed=!1,this.attach=!1,this.suotu=XN.photo.suotu,this.preBtn=$(Sizzle(this.option.preSelector)[0]),this.nextBtn=$(Sizzle(this.option.nextSelector)[0]),this.container=$(Sizzle(this.option.containerSelector)[0]),this.canvas=$(Sizzle(this.option.canvasSelector)[0])}Recommend.prototype={constructor:Recommend,init:function(e){var t=this;if(Recommend.ajaxContent){this.createContent(Recommend.ajaxContent);return}this.getContent(this.option.ownerId,this.option.albumId,function(n){t.createContent(n),e&&e()},function(){})},createContent:function(albums){var htmlTemp=[],data,first,last;this.albumsData=[];for(var i=0;i<albums.length;i++)data=this.dealData(albums[i]),this.albumsData.push(data),htmlTemp.push(Mustache.to_html(this.option.itemTemplate,data));var first=htmlTemp[0];htmlTemp.unshift(htmlTemp[htmlTemp.length-1]),htmlTemp.push(first),this.albumsData.unshift(this.albumsData[this.albumsData.length-1]),this.albumsData.push(this.albumsData[0]),this.canvas.innerHTML=htmlTemp.join(""),this.items=Sizzle(this.option.itemSelector,this.container),this.count=this.items.length,this.bindEvents();var html='<div class="albumList-side-recommend-bottom">                                <p>来自：<a target="_blank" href="http://www.renren.com/'+albums[0].owner+'" id="albumList-side-recommend-from">'+albums[0].userName+'</a></p>                                <a href="javascript:" class="albumList-side-recommend-cool" id="albumList-side-recommend-cool" data-id="'+albums[0].coverid+'">赞</a>                            </div>';jxn(this.container).append(html),jxn.get("http://like.renren.com/showlike?gid=photo_"+albums[0].coverid+"&uid="+XN.user.id,function(ret){ret=eval("("+ret+")");if(ret.code==0){var like=jxn(".albumList-side-recommend-cool");ret.ownerLike?(like.addClass("albumList-side-recommend-cooled"),like.attr("data-cooled",1)):(like.removeClass("albumList-side-recommend-cooled"),like.attr("data-cooled",0))}else XN.Do.showError(ret.msg)}),jxn(".albumList-side-recommend-cool").click(function(){var isCooled=this.getAttribute("data-cooled");if(!isCooled||isCooled==="0")var url="http://like.renren.com/addlike?gid=photo_"+this.getAttribute("data-id")+"&uid="+XN.user.id+"&owner="+XN.user.id;else var url="http://like.renren.com/removelike?gid=photo_"+this.getAttribute("data-id")+"&uid="+XN.user.id+"&owner="+XN.user.id;var self=this;jxn.get(url,function(ret){ret=eval("("+ret+")"),ret.code==0?!isCooled||isCooled==="0"?(jxn(self).addClass("albumList-side-recommend-cooled"),jxn(self).attr("data-cooled",1)):(jxn(self).removeClass("albumList-side-recommend-cooled"),jxn(self).attr("data-cooled",0)):XN.Do.showError(ret.msg)})}),this.option.isTop&&(this.container.style.display="block")},getContent:function(e,t,n,r){var i=this;r=r||XN.func.empty,new XN.net.xmlhttp({url:"http://photo.renren.com/photo/suggest/suggestAlbum?ownerId="+e+"&station=2&albumId="+t,method:"get",onSuccess:function(e){var t;try{t=XN.JSON.parse(e.responseText)}catch(i){t=null}if(t===null||t.code!=0){r();return}Recommend.ajaxContent=t.albumList,n(t.albumList)},onError:r})},dealData:function(e){e.name.length>21&&/^[a-zA-Z0-9]*$/.test(e.name)&&(e.name=e.name.substring(0,20)),e.description=e.type==1?"热门分享的相册":e.userName+"的相册";var t="http://photo.renren.com/photo/"+e.owner+"/photo-"+e.coverid;e.url=t,e.cover=this.suotu.getUrl(e.cover,"/p/m2w360hq85lt_"),e.width||(e.width=360),e.height||(e.height=360);var n=XN.photo.suotu.getSuotuSize(e.width,e.height,360,null,this.option.size,this.option.size);return $extend(e,n),e},sendLog:function(e){var t="http://photo.renren.com/photo/suggest/suggestAlbumData?source="+e;object.use("net",function(e){e.ping(t)})},bindEvents:function(){function t(){var t=this.option;if(t.attachTop&&t.leftSelector&&t.rightSelector){var r=$(Sizzle(t.leftSelector)[0]),i=$(Sizzle(t.rightSelector)[0]),s=Sizzle(".r-take-place")[0],o;XN.event.addEvent(window,"scroll",function(t){e.showBottom(r,i,s);if(!e.canShow||!e.showed)return;o=o?o:parseInt(e.container.getStyle("height")),n(e,i,o)?e.attach||(e.container.className+=" position-fixed",e.attach=!0):e.attach&&(e.container.className=e.container.className.replace(" position-fixed",""),e.attach=!1)})}}function n(e,t,n){var r=parseInt(t.getStyle("height")),i=e.getTopPostion(t);return e.attach?i+r<=e.option.navHeight:i+r<=n+2*e.option.navHeight-15}var e=this;this.preBtn.addEvent("click",function(){e.run("pre"),e.sendLog(13)}),this.nextBtn.addEvent("click",function(){e.run("next"),e.sendLog(13)}),$(e.canvas).delegate("a.image","click",function(){var t=$(this).getData("info"),n=t=="1"?8:5;e.sendLog(n)}),XN.browser.IE6?(this.canvas.delegate(this.option.itemSelector,"mouseover",function(e){if(!fixedMouse(e,this))return;Sizzle("div.note",this)[0].style.bottom="0"}),this.canvas.delegate(this.option.itemSelector,"mouseout",function(e){if(!fixedMouse(e,this))return;Sizzle("div.note",this)[0].style.bottom="-26px"})):t.call(e)},showBottom:function(e,t,n){if(!this.canShow){var r=parseInt(e.getStyle("height")),i=parseInt(t.getStyle("height"));r-i>=480&&(this.canShow=!0)}if(!this.canShow||this.getTopPostion(n)<this.option.navHeight)return;var s=this.getBottomPostion(n);s>=480?(this.container.style.display="block",this.showed=!0):(this.container.style.display="none",this.showed=!1)},getBottomPostion:function(e){return(document.compatMode=="BackCompat"?document.body:document.documentElement).clientHeight-this.getTopPostion(e)},getTopPostion:function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect();return t.top}var n=Math.max(document.documentElement.scrollTop,document.body.scrollTop),r=0;do r+=parseInt(e.offsetTop);while(e=e.offsetParent);return r-n},run:function(type){var self=this;if(this.onAnimate)return;this.onAnimate=!0;var step=type=="pre"?-1:1,next=(this.index+step+this.count)%this.count,start=-1*this.index*this.option.size,end=-1*next*this.option.size,current=this.albumsData[next];jxn("#albumList-side-recommend-from").attr("href","http://www.renren.com/"+current.owner).html(current.userName),jxn("#albumList-side-recommend-cool").attr("data-id",current.coverid),jxn.get("http://like.renren.com/showlike?gid=photo_"+current.coverid+"&uid="+XN.user.id,function(ret){ret=eval("("+ret+")");if(ret.code==0){var like=jxn(".albumList-side-recommend-cool");ret.ownerLike?(like.addClass("albumList-side-recommend-cooled"),like.attr("data-cooled",1)):(like.removeClass("albumList-side-recommend-cooled"),like.attr("data-cooled",0))}else XN.Do.showError(ret.msg)});var animate=this.animate(this.canvas,start,end,null,null,function(){next==0?(next=self.count-2,self.canvas.style.marginTop=-1*self.option.size*next+"px"):next==self.count-1&&(next=1,self.canvas.style.marginTop=-1*self.option.size*next+"px"),self.index=next});animate.start()},animate:function(e,t,n,r,i,s){var o=this,u=new XN.effect.Motion(r||"easeOutStrong",i||500);return u.onTweening=function(){e.style.marginTop=this.equation(t,n)+"px"},u.onComplete=function(){o.onAnimate=!1,s&&s()},u}},XN.page.photoList.slideRecommendPhoto=Recommend}(),function(){function s(e){var t=XN.DO.alert(e);XN.dom.disable(),t.addEvent("hide",function(){XN.dom.disable()})}function o(e){var t=XN.string.trim(e.name.value);return t.length==0?(s("请填写名字"),e.title.focus(),!1):t.length>30?(s("名字不能多于30个字符"),e.title.focus(),!1):e.location.value.length>60?(s("地点不能多于60个字符"),e.location.focus(),!1):e.caption.value.length>200?(s("描述不能多于200个字符"),e.caption.focus(),!1):!0}function u(t){var s="http://photo.renren.com/photo/{owner}/album-{album}/edit",u=XN.json.parse($(t).getData("info"));s=s.replace("{owner}",u.owner).replace("{album}",u.album),r=XN.DO.confirm({title:"编辑相册信息",message:n,width:500,callback:function(e){if(!e)return!1;this.preventHide(),o(i)&&new XN.net.xmlhttp({url:s,data:XN.form.serialize(i),onSuccess:function(e){var t=XN.json.parse(e.responseText);t.code?XN.DO.showMessage(t.msg):(XN.DO.showMessage("修改成功"),r.remove(),r=null,setTimeout(function(){location.reload()},2e3))},onError:errFunc})}}),r.footer.hide(),XN.dom.disable(),new XN.net.xmlhttp({url:s,method:"GET",onSuccess:function(n){var s=XN.json.parse(n.responseText);s.code?XN.DO.showError(s.msg):($extend(s.album,XN.json.parse($(t).getData("info"))),isUndefined(s.album.password)&&(s.album.password=""),r.setBody(mstpl(e,s.album)),r.footer.show(),i=Sizzle("form",r.body)[0])},onError:function(){errFunc(),r.remove(),r=null}})}var e='<form>                        <div class="edit-album-dialog">                            <dl>                                <dt><label>名字:</label></dt>                                <dd><input type="text" class="inputtext" value="<%=name%>" name="name"></dd>                            </dl>                            <dl>                                <dt><label>地点:</label></dt>                                  <dd><input type="text" class="inputtext" value="<%=location%>" name="location"></dd>                              </dl>                              <dl>                                  <dt><label>描述:</label></dt>                                  <dd><textarea name="caption"><%=description%></textarea></dd>                              </dl>                          </div>                          <input type="hidden" value="<%=album%>" name="id" />                          </form>',t='<dl>                                  <dt>谁能浏览:</dt>                                  <dd>                                      <select name="control">                                        <option <% if(albumcontrol == -1){ %> selected <% }%>  value="-1">只有我自己</option>                                          <option <% if(albumcontrol == 99 && passwordProtected) { %> selected <% }%>  value="99">使用密码访问</option>                                          <option <% if(albumcontrol == 1){ %> selected <% }%>  value="1">我的好友</option>                                          <option <% if(albumcontrol == 99 && !passwordProtected){ %> selected <% }%>  value="99">所有人</option>                                    </select>                                      <input type="hidden" value="<%=passwordProtected%>" name="passwordProtected">                                  </dd>                              </dl>                              <dl <% if( albumcontrol == 99 && !passwordProtected ) { %> style="display:none;"<% } %> id="passwordTip">                                <dt>提示:</dt>                                  <dd>                                    <p><span style="color:#888888;">设置为非所有人可见的内容将不能被分享</span></p>                                </dd>                            </dl>                            <dl<% if( albumcontrol != 99 || !passwordProtected ) { %>  style="display: none;"<% } %>  id="passwordElem">                                <dt>密码:</dt>                                  <dd>                                      <p><input type="text" value="<%=password%>" class="inputtext" style="width: 120px" maxlength="16" name="password"/></p>                                       <p><span class="description">支持字母，数字，符号，限16个字符</span></p>                                </dd>                              </dl>',n="<center>加载中...</center>",r=null,i=null;XN.page.photoList.initEditAlbum=function(e,t){$(t).addEvent("click",function(n){var r=XN.event.element(n||window.event);checkInSelector(r,e,t)&&(n?n.preventDefault():window.event.returnValue=!1,u(r))})}}(),XN.page.photoList.initDragdrop=function(e,t,n){function r(e){function p(){var e=r.length,t;for(var i=0;i<e;i++)t=XN.json.parse(r[i].getAttribute("data-info")),t.position!=n-i&&(t.position=n-i,r[i].setAttribute("data-info",XN.json.build(t)))}listReOrder(t+" ul","li",20);var r=Sizzle(t+" li"),i=[],s=0,o=0,u=null,a=null,f=null;for(var l=0;l<r.length;l++)if($(r[l]).getData("info"))try{r[l]==e&&(u=r[l-1]||null,a=r[l],f=r[l+1]||null)}catch(c){XN.log(c)}var h;u?(h=XN.json.parse($(u).getData("info")),i.push(h.photo+"@"+h.positionSaved)):i.push("null");var h=XN.json.parse($(a).getData("info"));!s&&(s=h.album),!o&&(o=h.owner),i.push(h.photo+"@"+h.positionSaved),f?(h=XN.json.parse($(f).getData("info")),i.push(h.photo+"@"+h.positionSaved)):i.push("null"),new XN.net.xmlhttp({url:"http://photo."+XN.env.domain+"/photo/"+o+"/album-"+s+"/reorder",data:"idlist="+i.join(","),onSuccess:function(e){try{var t=XN.json.parse(e.responseText);if(!t.code){if(t.positionCode==1){var n=XN.json.parse($(a).getAttribute("data-info"));n.positionSaved=t.data,$(a).setAttribute("data-info",XN.json.build(n))}else if(t.positionCode==2){var i=r.length,s=t.data.split(","),n;for(var o=0;o<i;o++)n=XN.json.parse(r[o].getAttribute("data-info")),n.positionSaved=s[o],r[o].setAttribute("data-info",XN.json.build(n))}p()}}catch(u){XN.log(u)}},onError:errFunc})}dd=XN.photo.libs.dragdrop({selector:e,container:Sizzle(t)[0],onEnd:r,photoCount:n})},XN.page.photoList.initLazyLoadCmt=function(e,t,n,r){XN.photo.libs.lazyload||XN.log("lazyload没有准备好"),XN.photo.libs.cmtmode(e,t,n,r)},XN.page.albumList.albumComment={init:function(e,t){this.userId=e.userId,this.albumId=e.albumId,this.ownerId=e.ownerId,this.isAdmin=e.isAdmin;var n=this,r="赞",i=CommentManage.getInstance({type:"album",parentEl:$("comment_box"),userId:n.userId,ownerId:n.ownerId,isCache:!0,ownerHead:e.headurl,isAdmin:n.isAdmin,likeText:r,sourceId:n.albumId,getDelUrl:function(e){return"http://photo."+XN.env.domain+"/photo/"+this.ownerId+"/album-"+this.sourceId+"/comment/"+e+"/delete"},getDelParam:function(e){return""},getReportUrl:function(e,t){return"http://admin."+XN.env.domain+"/admin/newuserreport.do?type=29&owner="+this.ownerId+"&contentId="+e+"&userId="+t+"&origURL="+encodeURIComponent(document.location.href)+"&pid="+this.sourceId},getLoadUrl:function(){return"http://photo."+XN.env.domain+"/photo/"+this.ownerId+"/album-"+this.sourceId+"/comment"},getLoadParam:function(){return"page="+this.currentPage+"&album="+this.sourceId+"&owner="+this.ownerId},getSaveUrl:function(){return this.getLoadUrl()},getSaveParam:function(){var e="id="+this.sourceId;return e+="&owner="+this.ownerId+"&body="+encodeURIComponent($(this.cmtBodyID).value),this.reToId!=0&&(e+="&to="+this.reToId),e+="&only_to_me="+$(this.whisperID).checked,e+="&feedComment="+($(this.feedCommentID)?$(this.feedCommentID).checked:""),e+="&replyCommentId="+$(this.replyCommentId).value,e},oneCmtTPL:['<a target="_blank" class="avatar" title="{{name}}" namecard="{{author}}" href="{{urlProfile}}"><img style="width:30px" alt="{{name}}"  {{srcAttr}}="{{headUrl}}" class="avatar"/></a>','<div class="info">','   <p class="content" style="display:inherit;"><span class="author me"><a target="_blank" title="{{liveUserTitle}}" namecard="{{author}}" href="http://www.renren.com/profile.do?id={{author}}" class="{{liveUserClass}}">{{name}}</a></span>',"   {{#isVip}}",'       &nbsp;<a href="{{urlVipActionUrl}}" target="_blank" title="VIP"><img src="{{urlVipIcon}}" alt ="VIP"/></a>',"   {{/isVip}}:","    {{{commentBody}}}</p>","</div>",'<div class="reply clearfix">','    <span class="time float-left">{{time}}</span>',"    {{#isShowReply}}",'        <a class="float-right photo-comment-reply" comorder="{type:\'reply\',id:\'{{author}}\',whisper:{{whisper}}, cmtid:\'{{id}}\', state:{{state}} }" onclick="return false;" href="#nogo">回复</a>',"    {{/isShowReply}}","    {{^isVoice}}",'    <div class="photo-comment-like-container {{#like}}photo-comment-ilike {{/like}}  float-right">','       <span class="photo-comment-like-count">{{likecount_str}}</span>','       <a class="photo-comment-like-btn" comorder="{type:\'like\',uid:\'{{author}}\',name:\'{{name}}\',ownerid:\'{{owner}}\',cmtid:\'{{id}}\'}" onclick="return false;" href="#nogo" data-liked="{{like}}" data-likecount="{{likecount}}">',"           {{#like}}取消{{/like}}{{^like}}{{like_text}}{{/like}}","       </a>","    </div>","    {{/isVoice}}","    {{#whisper}}",'       <span class="whisper float-right">悄悄话</span>',"    {{/whisper}}","    {{#reportURL}}",'        <span class="float-right"><a target="_blank" href="{{reportURL}}" class="reply-report">举报</a></span>',"    {{/reportURL}}","    {{^reportURL}}",'        <span class="float-right"> <a comorder="{type:\'del\',id:\'{{id}}\',owner:\'{{owner}}\'}" class="x-to-hide" onclick="return false;" href="#nogo" alt="删除">删除</a></span>',"    {{/reportURL}}","</div>"].join("")});i.firstLoad(),object.use("xn.mention",function(t,n){n.mention.Mention.init([{obj:$("cmtbody"),popTop:!0,ugcId:e.albumId,ugcType:"album",ownerId:e.ownerId}])})}},XN.page.albumList.initHomeFrameTab=function(){var e=$(Sizzle(".opera-bar .left-btn2")[0]),t=$(Sizzle(".opera-bar .right-btn2")[0]),n=$(Sizzle(".opera-bar .book-btn2")[0]),r=$(Sizzle(".album-home")[0]),i=$(Sizzle(".photo-home")[0]),s=$(Sizzle(".book-home")[0]),o=(new XN.ui.tabView({selectedClass:"select-btn2"})).addTab({label:e,content:r,onActive:function(){arguments.callee.called||(XN.page.albumList.albumListLz=XN.page.albumList.initLazyLoad(".album-list img"),arguments.callee.called=!0)}}).addTab({label:t,content:i,onActive:function(){arguments.callee.called||(XN.page.albumList.initLazyLoad(".photo-list img"),XN.page.albumList.initFixPager(".photo-list img","page-fixer2-",15,Sizzle(".photo-list")[0]),XN.page.photoList.initEditInfo(".photo-edit",Sizzle(".photo-list")[0]),XN.page.photoList.initDel(".photo-del",Sizzle(".photo-list")[0]),arguments.callee.called=!0)}});if(n&&s){o.addTab({label:n,content:s,onActive:function(){XN.page.albumList.initLazyLoad(".book-list img")}});var u=function(){var e=Sizzle(".book-list li");if(e.length==0)return;for(var t=0,n=e.length;t<n;t++)if(f.checked){var r=Sizzle(".due-infor",e[t])[0];r?(r.style.display="block",e[t].style.display="block"):e[t].style.display="none"}else{e[t].style.display="block";var r=Sizzle(".due-infor",e[t])[0];r&&(r.style.display="none")}f.checked?Sizzle(".due-msg")[0].style.display="block":Sizzle(".due-msg")[0].style.display="none"},a=Sizzle(".due-show")[0],f;a&&(f=a.getElementsByTagName("input")[0],XN.event.addEvent(f,"click",u),/from(\s*)=(\s*)vpmessage/.test(window.location.href)&&n&&(o.setCurrentTab(n),a&&f&&(f.checked=!0,u())))}/vp(\s*)=(\s*)true/.test(window.location.href)&&n||/from(\s*)=(\s*)vpmessage/.test(window.location.href)&&n?o.setCurrentTab(n):/latest(\s*)=(\s*)true/.test(window.location.href)&&t?o.setCurrentTab(t):o.setCurrentTab(e)},XN.page.albumList.initFriendListTab=function(){var e=$(Sizzle(".opera-bar .left-btn2")[0]),t=$(Sizzle(".opera-bar .right-btn2")[0]),n=$(Sizzle(".opera-bar .book-btn2")[0]),r=$(Sizzle(".opera-bar .tag-btn2")[0]),i=$(Sizzle(".album-home")[0]),s=$(Sizzle(".photo-home")[0]),o=$(Sizzle(".tag-home")[0]),u=$(Sizzle(".book-home")[0]),a=(new XN.ui.tabView({selectedClass:"select-btn2"})).addTab({label:e,content:i,onActive:function(){arguments.callee.called||(XN.page.albumList.initLazyLoad(".album-list img"),arguments.callee.called=!0)}}).addTab({label:t,content:s,onActive:function(){arguments.callee.called||(XN.page.albumList.initLazyLoad(".photo-list img"),XN.page.albumList.initFixPager(".photo-list img","page-fixer2-",20,Sizzle(".photo-list")[0]),arguments.callee.called=!0)}});n&&u&&a.addTab({label:n,content:u,onActive:function(){XN.page.albumList.initLazyLoad(".book-list img")}}),r&&o&&a.addTab({label:r,content:o,onActive:function(){XN.page.albumList.initLazyLoad(".tag-list img"),XN.page.albumList.initFixPager(".tag-list img","page-fixer2-",20,Sizzle(".tag-list")[0])}}),/vp(\s*)=(\s*)true/.test(window.location.href)&&n?a.setCurrentTab(n):/tag(\s*)=(\s*)true/.test(window.location.href)&&r?a.setCurrentTab(r):/latest(\s*)=(\s*)true/.test(window.location.href)&&t?a.setCurrentTab(t):a.setCurrentTab(e)},XN.page.albumList.initRecycle=function(){var e=Sizzle(".photo-list")[0];XN.page.albumList.initFriendsPhotoSelector($("friendSelectorCM")),XN.page.albumList.initFixPager(".photo-list img","page-fixer1-",20,e),XN.page.albumList.initLazyLoad(".photo-list img"),XN.page.albumList.initRecycleOper(e)}}(),function(){function s(e){var t=XN.DO.alert(e);XN.dom.disable(),t.addEvent("hide",function(){XN.dom.disable()})}function o(e){var t=XN.string.trim(e.name.value);return t.length==0?(s("请填写名字"),e.title.focus(),!1):t.length>30?(s("名字不能多于30个字符"),e.title.focus(),!1):e.location.value.length>60?(s("地点不能多于60个字符"),e.location.focus(),!1):e.description.value.length>200?(s("描述不能多于200个字符"),e.caption.focus(),!1):!0}function u(e){var t=XN.DO.confirm({title:"上传照片",message:"相册已创建成功，是否马上上传照片到这个相册？",yes:"现在上传照片",no:"稍后再说",callback:function(n){n?setTimeout(function(e){return function(){e.remove(),e=null}}(t),200):window.location.href="http://photo.renren.com/photo/"+XN.user.id+"/album-"+e}});$(t._buttons[0].frame).addClass("flashUploader fromAlbum"),$(t._buttons[0].frame).href="http://upload.renren.com/index.do?id="+e+"&ref=1002",XN.dom.disable()}function a(){var e="http://photo.renren.com/photo/"+XN.user.id+"/album-create-new";r=XN.DO.confirm({title:"新建相册",message:n,width:500,callback:function(t){if(!t)return!1;this.preventHide(),o(i)&&new XN.net.xmlhttp({url:e,data:XN.form.serialize(i),onSuccess:function(e){var t=XN.json.parse(e.responseText);t.albumid==-1?XN.DO.showMessage(t.message):(u(t.albumid),r.remove(),r=null)},onError:function(){XN.DO.showMessage("新建相册失败")}})}}),r.setBody(t),i=Sizzle("form",r.body)[0],XN.dom.disable()}var e=/^6/.test(XN.user.id),t='<form>                    <div class="edit-album-dialog">                        <dl>                            <dt><label>名字:</label></dt>                            <dd><input type="text" class="inputtext" value="" name="name"></dd>                        </dl>                        <dl>                            <dt><label>地点:</label></dt>                              <dd><input type="text" class="inputtext" value="" name="location"></dd>                          </dl>                          <dl>                              <dt><label>描述:</label></dt>                              <dd><textarea name="description" value=""></textarea></dd>                          </dl>  '+(e?"":'<dl>                             <dt>谁能浏览:</dt>                              <dd>                              <a href="#" class="privacy-trigger" data-toggle="privacy" data-option={"sourceControl":99,"ugcType":"photo","alignType":"2-3","password":"","extend":"PASSWORD","extendClass":"privacy-container-albumlist"} >                                  <i class="privacy-icon picon-public"></i>                                  <span>公开</span>                                  <i class="privacy-icon picon-arrow-down"></i>                                  <input name="privacyParams" type="hidden" value="{&quot;sourceControl&quot;:99}">                              </a>                            </dd>                        </dl> ')+"</div>                      </form>",n="<center>加载中...</center>",r=null,i=null;XN.dom.ready(function(){$(document).addEvent("click",function(e){var e=e||window.event,t=XN.event.element(e);t.hasClassName&&t.hasClassName("create-album-action")?a():t.parentNode&&$(t.parentNode).hasClassName("create-album-action")&&a()})})}(),function(){var e=function(e,t){var n={},r=function(e,t){var r=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):n[e]=n[e]||this.tmpl(document.getElementById(e).innerHTML);return t?r(t):r};return r(e,t)},t=function(){XN.DO.showMessage("服务器有点小问题，请稍候重试 :)")},n='<div class="batch-listbox clearfix" >              <div class="batch-head clearfix">                  <span class="del-or-move">                     <label class="selected js-del"><input checked="checked" name="choose" type="radio" />删除</label>                     <label class="js-move"><input name="choose" type="radio" />转移照片</label>                     <span style="display:none" class="js-move-title">转移至：</span>                 </span>                 <div class="album-name-box appoint">                 </div>             </div>             <div class="batch-content">                 <div class="batch-all">                     <label><input type="checkbox" />全选</label>                 </div>                 <% if( photoList.length <= 15 ) { %>                 <ul class="batch-list clearfix" style="overflow-y:hidden">                 <% } else { %>                 <ul class="batch-list clearfix">                 <% }%>                    <% for ( var i=0, j=photoList.length; i < j; i++) { %>                     <li data-id="<%=photoList[i].id%>">                         <a href="javascript:;"><img src="http://a.xnimg.cn/a.gif" style="background-image: url(<%=photoList[i].mainUrl%>);"/></a>                         <div class="choosed"></div>                     </li>                    <% } %>                 </ul>             </div>             <div id="" class="batch-foot clearfix">                 <div class="batch-btn">                     <input type="submit" class="submit-btn submit-gray-btn js-cancel" value="退出"/>                     <input type="submit" class="submit-btn js-submit del-btn" value="删除" />                     </div>                         <div class="choose-nums">                             已选择0张                         </div>                     </div>                 </div>             </div>       </div>',r="<center>加载中...</center>",i=' <div class="appoint-album">                         <div class="select-album" data-id="<%=albumList[0].id%>" >                               <a href="javascript:;" class="arrow-down"></a><%=albumList[0].name%><span class="pp-num">(<%=albumList[0].photoCount%>)</span>                         </div>                         <div class="sublist clearfix">                             <dl class="album-name-list">                                 <%  for( var i=0, j=albumList.length; i < j; i++ ) { %>                                 <dd data-id="<%=albumList[i].id%>" data-name="<%=albumList[i].name%>" data-photoCount="<%=albumList[i].photoCount%>" ><a title="<%=albumList[i].name%>"  href="javascript:;"><%=albumList[i].name%><span class="pp-num">(<%=albumList[i].photoCount%>)</span></a></dd>                                 <% } %>                             </dl>                             <div class="search-album">                                 <input type="text" class="search-txt" />                                 <span class="all-album">共<%=albumList.length%>个相册</span>                             </div>                           </div>                     </div>',s='<a href="javascript:;" class="arrow-down"></a><%=name%><span class="pp-num">(<%=photoCount%>)</span>',o=null,u=null,a=null,f={radio:null,act:null},l=null,c=[],h=0,p={delSuc:"删除成功",moveSuc:"转移成功"},d=function(){return{photoList:function(){return"http://photo.renren.com/photo/{owner}/album-{albumId}/list".replace("{owner}",u.owner).replace("{albumId}",u.albumId)},albumList:function(){return"http://photo.renren.com/photo/{owner}/album/common/ajax".replace("{owner}",u.owner)},verifyCode:function(){return"http://photo.renren.com/photo/{ownerId}/photo-{firstPhotoId}/delete".replace("{ownerId}",u.owner).replace("{firstPhotoId}",c[0])},del:function(){return"http://photo.renren.com/photo/{ownerId}/album-{albumId}/deleteBatch".replace("{ownerId}",u.owner).replace("{albumId}",u.albumId)},move:function(){return"http://photo.renren.com/photo/{ownerId}/{currentAlbumId}/transferBatch".replace("{ownerId}",u.owner).replace("{currentAlbumId}",u.albumId)}}}(),v=function(e,t,n){u[e]?t(u[e]):new XN.net.xmlhttp({url:d[e](),method:"GET",onSuccess:function(r){try{var i=XN.json.parse(r.responseText);u[e]=i.list,t(u[e])}catch(s){n()}},onError:n})},m=function(e){for(var t=0,n=c.length;t<n;t++)c[t]==e&&c.splice(t,1)},g=function(e,t,n){if(!t.length)return!1;for(var r=0,i=t.length;r<i;r++)if(e==t[r]){n(e);break}},y=function(e){return e.tagName.toLowerCase()},b=function(){XN.event.addEvent(Sizzle(".select-album")[0],"click",function(e){$(this.parentNode).toggleClass("selected")}),XN.event.addEvent(Sizzle(".sublist"),"click",function(t){var n=$(XN.event.element(t||window.event)),r=0;while(y(n)!="dd"&&!n.hasClassName(".sublist")&&r<3)n=$(n.parentNode),r++;if(y(n)!="dd")return!1;var i={id:n.getData("id"),name:n.getData("name"),photoCount:n.getData("photoCount")},n=Sizzle(".select-album")[0];n.setAttribute("data-id",i.id),n.innerHTML=e(s,i),$(n.parentNode).delClass("selected")}),XN.event.addEvent(Sizzle(".search-txt")[0],"keyup",function(e){var t=Sizzle(".search-txt")[0].value,n=Sizzle(".sublist dd"),r=!1,i=0;t==""&&(r=!0);for(var s=0,o=n.length;s<o;s++)$(n[s]).getData("name").indexOf(t)!=-1||r?($(n[s]).show(),i++):$(n[s]).hide();var u=Sizzle(".all-album")[0];u.innerHTML=u.innerHTML.replace(/\d+/,i)})},w=function(){return"http://photo.renren.com/photo/"+u.owner+"/album-"+u.albumId},E={del:function(e){try{var n=XN.json.parse(e.responseText);n.code>0?XN.DO.showError(n.msg):(XN.DO.showMessage(p.delSuc),o.remove(),o=null,location.href=w())}catch(r){t()}},move:function(e){try{var n=XN.json.parse(e.responseText);n.code>0?XN.DO.showError(n.msg):(XN.DO.showMessage(p.moveSuc),o.remove(),o=null,location.href=w())}catch(r){t()}}},S={getIds:function(e){var t=[],n=e||"ids";for(var r=0,i=c.length;r<i;r++)t.push(n+"="+c[r]);return t.join("&")},del:function(){var e=[this.getIds()];return e.join("&")},move:function(){var e=[this.getIds(),"toAlbumId="+$(Sizzle(".select-album",l)[0]).getData("id")];return e.join("&")}},x=function(e){return XN.DO.alert({msg:e,type:"error",title:"错误提示",noFooter:!0,modal:!0,autoHide:2})},T=!1,N=function(){function e(e,n,r){new XN.net.xmlhttp({url:d.del(),data:XN.form.serialize(Sizzle("form",e.body)[0])+"&"+S.del(),onSuccess:function(t){var n=XN.json.parse(t.responseText),i=Sizzle("img",e.body)[0];n.code?(x(n.msg).addEvent("hide",function(){T&&XN.dom.disable()}),i&&(i.src+=new Date)):(e.remove(),e=null,T=!1,r(t))},onError:t})}o.hide(),new XN.net.xmlhttp({url:d.verifyCode(),method:"GET",onSuccess:function(t){var n=t.responseText;n=n.replace("你确定想删除这张照片？","是否删除选中的"+c.length+"张图片"),XN.dom.disable();var r=(new XN.ui.dialog).setTitle("删除？").setBody(n).addButton({text:"确定",onclick:function(){r.preventHide(),e(r,d.del(),E.del)}}).addButton({text:"取消",onclick:function(){c.length=0,r.remove(),r=null,T=!1}}).show();T=!0,r.getButton("取消").addClass("gray"),XN.event.addEvent(Sizzle("form input",r.body)[0],"keydown",function(t){t.keyCode==13&&(XN.event.stop(t),e(r,d.del(),E.del))}),Sizzle("input",r.body)[0].focus()},onError:t})},C=function(){var e=f.act;if(c.length==0)return x("请选择照片").addEvent("hide",function(){if(!o)return!1;XN
.dom.disable()}),!1;if(e=="del"&&!h)return N(),!1;new XN.net.xmlhttp({url:d[e](),data:S[e](),onSuccess:E[e],onError:t})},k=function(){var e=Sizzle(".choose-nums")[0];e.innerHTML=e.innerHTML.replace(/\d+/,c.length)},L=function(n){var r=Sizzle(".batch-listbox")[0],s=Sizzle(".js-del").concat(Sizzle(".js-del input")),a=Sizzle(".js-move").concat(Sizzle(".js-move input")),l=Sizzle(".batch-all").concat(Sizzle(".batch-all label")).concat(Sizzle(".batch-all label input")),h=Sizzle(".batch-list li").concat(Sizzle(".batch-list li a")).concat(Sizzle(".batch-list li img")).concat(Sizzle(".batch-list li div")),p=Sizzle(".batch-btn .js-submit")[0],d=Sizzle(".batch-btn .js-cancel")[0];g(n,s,function(e){$(f.radio).delClass("selected"),y(e)!="label"&&(e=e.parentNode),$(e).addClass("selected"),f.radio=e,f.act="del",$(Sizzle(".album-name-box")[0]).hide(),$(Sizzle(".js-move-title")[0]).hide(),$(p).addClass("del-btn"),$(p).value="删除"}),g(n,a,function(n){$(f.radio).delClass("selected"),y(n)!="label"&&(n=n.parentNode),$(n).addClass("selected"),f.radio=n,f.act="move",$(Sizzle(".js-move-title")[0]).show(),$(Sizzle(".album-name-box")[0]).show(),$(p).delClass("del-btn"),$(p).value="转移",(!u.albumList||!Sizzle(".album-name-box li").length)&&v("albumList",function(){for(var t=0;t<u.albumList.length;t++)if(u.albumList[t].id==u.albumId){u.albumList.splice(t,1);break}Sizzle(".album-name-box")[0].innerHTML=e(i,u),b()},t)}),g(n,l,function(e){var t=Sizzle(".batch-list li"),n=e.checked?"addClass":"delClass";c.length=0;for(var r=0,i=t.length;r<i;r++)$(t[r])[n]("select"),n=="addClass"&&c.push($(t[r]).getData("id"));n=="delClass"&&(c.length=0),k()}),g(n,h,function(e){var t=0;while(y(e)!="li"&&t<3)e=e.parentNode,t++;id=$(e).getData("id"),e.hasClassName("select")?(e.delClass("select"),m(id)):(e.addClass("select"),c.push(id)),k()}),g(n,[p],function(e){C()}),g(n,[d],function(e){c.length=0,o.remove(),o=null})},A=function(){l=Sizzle(".batch-listbox")[0],XN.event.addEvent(l,"click",function(e){L(XN.event.element(e||window.event))})},O=function(){o=XN.DO.confirm({title:"批量操作",message:r,width:635,y:100,noPadding:!0,callback:function(e){if(!e)return!1;C(),this.preventHide()}}),o.setY(100),o.footer.hide(),XN.DOM.disable(),v("photoList",function(t){o.setBody(e(n,u)),A(),f.radio=Sizzle(".del-or-move .selected")[0],f.act="del"},function(){t(),o.remove(),o=null})};XN.page.photoList.initBatchoperate=function(e){u=e,$(Sizzle(u.selector)[0])&&$(Sizzle(u.selector)[0]).addEvent("click",function(e){O()})}}(),function(){var e={init:function(e,t){var n=t.getElementsByTagName("input")[0],r=this;this.cmtsPhotos=[],this.noCmtsPhotos=[],this.checkBox=n,XN.event.addEvent(n,"click",function(){var t=Sizzle(e);for(var s=0,o=t.length;s<o;s++)try{var u=XN.json.parse(t[s].getAttribute("data-info"));u.commentcount?r.cmtsPhotos.push(u.photo):r.noCmtsPhotos.push(u.photo)}catch(a){XN.log(a)}r.cmtsPhotos.length&&r.noCmtsPhotosAction(n.checked?"hide":"show"),n.checked&&!r.cmtsPhotos.length?($("no-cmt-tip")&&$("no-cmt-tip").show(),i.loadPhoto()):($("no-cmt-tip")&&$("no-cmt-tip").hide(),i.loadPhotoAll())});var s=Sizzle(e);for(var o=0,u=s.length;o<u;o++)try{var a=XN.json.parse(s[o].getAttribute("data-info"));a.commentcount?this.cmtsPhotos.push(a.photo):this.noCmtsPhotos.push(a.photo)}catch(f){XN.log(f)}n.checked=!0;var l=$("no-cmt-tip");this.cmtsPhotos.length?(this.noCmtsPhotosAction("hide"),l&&l.hide()):(this.noCmtsPhotosAction("show"),l&&l.show())},noCmtsPhotosAction:function(e){var t=this.noCmtsPhotos;for(var n=0;n<t.length;n++){var r=document.getElementById("cmtmode-"+t[n]);r&&(e=="show"?r.style.display="":e=="hide"&&(r.style.display="none"))}}},t=function(e,t,n){n!==!1&&(n=!0);for(var r in t)if(n||e[r]===undefined)e[r]=t[r];return t&&t.hasOwnProperty("call")&&(e.call=t.call),e},n="http://img.xiaonei.com/photos/0/0/main.png",r={type:"photo",parentEl:null,userId:0,ownerId:0,isCache:!0,isAdmin:!1,sourceId:0,cmtMode:!0,getDelUrl:function(e){return"http://photo."+XN.env.domain+"/photo/"+this.ownerId+"/photo-"+this.sourceId+"/comment/"+e+"/delete"},getDelParam:function(e){return""},getReportUrl:function(e,t){return"http://admin."+XN.env.domain+"/admin/newuserreport.do?type=29&owner="+this.ownerId+"&contentId="+e+"&userId="+t+"&origURL="+encodeURIComponent(document.location.href)+"&pid="+this.sourceId},getLoadUrl:function(){return"http://photo."+XN.env.domain+"/photo/"+this.ownerId+"/photo-"+this.sourceId+"/comment/"},getLoadCmtUrl:function(){return this.getLoadUrl()+"new"},getLoadParam:function(){return"page=0&photo="+this.sourceId+"&owner="+this.ownerId},getSaveUrl:function(){return this.getLoadUrl()},oneCmtTPL:'{{#reportURL}}                           <span class="float-right"><a target="_blank" href="{{reportURL}}" class="reply-report">举报</a></span>                       {{/reportURL}}                           <a class="avatar minfriendpic" namecard="{{author}}"  title="{{name}}" style="background-image:url({{headUrl}})" href="{{urlProfile}}"></a>                       <div class="info">                          {{^reportURL}}                              <span class="float-right" style="width:15px"> <a comorder="{type:\'del\',id:\'{{id}}\',owner:\'{{owner}}\'}" class="x-to-hide" onclick="return false;" href="#nogo" alt="删除"></a></span>                          {{/reportURL}}                          {{#whisper}}                              <span class="whisper float-right">悄悄话</span>                          {{/whisper}}                              <span class="author me"><a namecard="{{author}}" title="{{liveUserTitle}}" href="http://www.renren.com/profile.do?id={{author}}" class="{{liveUserClass}}">{{name}}</a></span>                          {{#isVip}}                              &nbsp;<a href="{{urlVipActionUrl}}" target="_blank" title="VIP"><img src="{{urlVipIcon}}" alt ="VIP"/></a>                          {{/isVip}}                           <span class="time">{{time}}</span>                       </div>                       <div class="reply">                           <p class="content">{{{commentBody}}}</p>                           {{#isShowReply}}                           &nbsp;<a comorder="{type:\'reply\',id:\'{{author}}\',whisper:{{whisper}}, cmtid:\'{{id}}\'}" onclick="return false;" href="#nogo">回复</a>                           {{/isShowReply}}                           {{^isVoice}}		    			   <div class="photo-comment-like-container {{#like}}photo-comment-ilike {{/like}} float-right">		    			       <span class="photo-comment-like-count">{{likecount_str}}</span>		    			       <a class="photo-comment-like-btn" comorder="{type:\'like\',uid:\'{{author}}\',name:\'{{name}}\',ownerid:\'{{owner}}\',cmtid:\'{{id}}\'}" onclick="return false;" href="#nogo" data-liked="{{like}}" data-likecount="{{likecount}}">		    			           {{#like}}取消{{/like}}{{^like}}赞{{/like}}		    			       </a>		    			   </div>                           {{/isVoice}}                       </div>',getSaveParam:function(){return XN.form.serialize(this.comEditorFormID)}},i={uuid:0,init:function(t,n,r){this.selector=t,this.cmtObj=n,this.lazyObj=r,e.cmtsPhotos.length?this.loadPhoto():this.loadPhotoAll()},getLi:function(e){var t=e;while(t.tagName.toLowerCase()!="li")t=t.parentNode;return t},getCmtParams:function(e){var t=$extend({},r);return $extend(t,this.cmtObj),$extend(t,{sourceId:e.photo,ownerId:e.owner}),t},buildcmtContainer:function(e){var t='<div class="statuscmtlist  mincmt-body" id="comment_box_con{photoId}">                   <div class="replies" id="comment_box{photoId}"> </div>                   <div class="errors_div" id="error{photoId}"> </div>                   <form id="commentEditorForm{photoId}">                   <div class="statuscmtitem reply-adding" id="reply_editor_{photoId}">                       <div>                           <span class="minfriendpic" style="background-image: url({headUrl});" id="reply_user_head_{photoId}">&nbsp;</span>                           <textarea rows="1" cols="30" style="overflow-y: auto;" value="" type="text" class="input-text archive-inp" name="body" id="reply_input_{photoId}"></textarea>                       </div>                       <div id="buttons{photoId}" class="reply-nav clearfix">                           <span class="replyAll clearfix">                           <input type="button" value="回复" id="submit{photoId}" class="input-button">			               <a class="mention-btn" id="mentionBtn{photoId}" onclick="return false;" href="#nogo">点名</a>                           <a class="newsfeed-emo" id="addEmoBtn{photoId}" onclick="return false;" href="#emotion">表情</a>                           </span>                           <input type="hidden" id="toidID{photoId}" name="to" value="">                           <input type="hidden" id="replyCommentId{photoId}" name="replyCommentId" value="">                       </div>                      </div>                   </form>                  </div>',n=e.photo;t=t.replace(/\{photoId\}/g,n).replace(/\{headUrl\}/g,this.cmtObj.headurl),$("comments_box_"+n).innerHTML=t;var r=$("reply_input_"+n);XN.ui.emoticons({input:r,button:$("addEmoBtn"+n),atBtn:$("mentionBtn"+n),url:"http://status."+XN.env.domain+"/getubblist.do?type=7",onShowEmoPop:function(){r.focus(this.pos.start)},onEmoTabSwitch:function(){r.focus(this.pos.start)},onEmoNotVip:function(){r.focus(this.pos.start)},onEmoTabClick:function(){r.focus(this.pos.start)}});var i=!1;XN.event.addEvent("reply_input_"+n,"focus",function(){$("reply_editor_"+n).addClass("actived")}),XN.event.addEvent("reply_input_"+n,"blur",function(){var e=this;setTimeout(function(){!i&&e.value==""&&$("reply_editor_"+n).delClass("actived")},200)});var s=function(e){i=!0,XN.form.help($("reply_input_"+n)).focus(),setTimeout(function(){i=!1},200)};XN.event.addEvent("mentionBtn"+n,"click",s),XN.event.addEvent("addEmoBtn"+n,"click",s)},_initOneCmtManager:function(e){var t=this.getCmtParams(e),n=e.photo,r={cmtBodyID:"reply_input_"+n,editorBtnID:"submit"+n,errorMsgID:"error"+n,showMoreID:"showMore"+n,showMoreCommentsID:"showMoreComments"+n,comEditorFormID:"commentEditorForm"+n,commContainerID:"comment_list_box"+n,parentEl:"comment_box"+n,toidID:"cmttoid"+n,replyCommentId:"replyCommentId"+n,sourceidID:"sourceid"+n,submitBtnVal:"回复",tempLoadingID:"tempLoading"+n,lastedCommentCount:"lastedCommentCount"+n};$extend(t,r);var i=CommentManage.getInstance(t);i.firstLoad(),object.use("xn.mention",function(e,r){r.mention.Mention.init([{obj:$("reply_input_"+n),popTop:!0,ugcId:t.sourceId,ugcType:"photo",ownerId:t.ownerId}])})},loadComment:function(e){var t=this.getLi(e),n=null;try{var n=XN.json.parse($(t).getData("info"));this.buildcmtContainer(n),this._initOneCmtManager(n)}catch(r){XN.log(r)}},loadPhotoAll:function(){var t=this,r=Sizzle(".photo-home")[0].id,i=XN.photo.libs.lazyload({range:200,elements:t.selector+" a.pic img",realSrcAttribute:"data-src",loadImage:function(s){var o=s.getAttribute("data-src"),u=new Image;u.onload=function(){s.src=o,u.width<400&&$(s.parentNode).addClass("small-pic"),u.height<200&&$(s.parentNode).addClass("mini-h-pic"),u.width<400&&u.height>200&&($(s.parentNode).addClass("small-pic"),$(s.parentNode).style.height="auto"),$(s).delClass("loading"),u=null},u.onerror=function(){s.src=n},u.src=o,t.loadComment(s);if(t.lazyObj&&(!e.checkBox.checked||!e.cmtsPhotos.length)){t.lazyObj.lazyPage<3&&(t.lazyObj.lazyPage=3);var a=jxn(document.getElementById(r)).find("li:last")[0]}if(t.lazyObj&&(!e.checkBox.checked||!e.cmtsPhotos.length)&&t.getLi(s)==a){var f=[];new XN.net.xmlhttp({url:"http://photo.renren.com/photo/"+t.lazyObj.ownerId+"/album-"+t.lazyObj.albumId+"/bypage/ajax?curPage="+t.lazyObj.lazyPage+"&pagenum=3",method:"GET",onSuccess:function(e){var e=XN.json.parse(e.responseText),n=e.photoList.length,r=document.createElement("ul");for(var s=0;s<n;s++)f[s]='<li id="cmtmode-'+e.photoList[s].photoId+'" class="clearfix" data-info="{album:'+t.lazyObj.albumId+", photo:"+e.photoList[s].photoId+", owner:"+t.lazyObj.ownerId+", commentcount:"+e.photoList[s].commentcount+'}">'+'<div class="comments-box">'+'<div class="comments-opre">'+"<span>"+t.fatTime(e.photoList[s].time)+"</span>"+(t.lazyObj.canShare&&t.lazyObj.aType!=1?'<a href="javascript:void(0)" class="share_new" data-share="{stype:\'create_share_feed\', id:'+e.photoList[s].photoId+", owner:"+t.lazyObj.ownerId+', type:\'photo\'}" >分享</a><span class="pipe"></span>':"")+"</div>"+'<div id="comments_box_'+e.photoList[s].photoId+'" class="min-cmtbox statustab"></div>'+"</div>"+'<a class="pic" href="'+t.lazyObj.asUrlPhoto+"/photo/"+t.lazyObj.ownerId+"/photo-"+e.photoList[s].photoId+'">'+'<img alt="'+e.photoList[s].title+'" class="loading" data-src="'+e.photoList[s].largeUrl+'" src="'+t.lazyObj.asurlSmallStatic+'/imgpro/indicator/loading.gif" />'+"</a>"+"</li>";t.lazyObj.lazyPage+=3,r.innerHTML=f.join(""),Sizzle(".review-mode")[0].appendChild(r),i.refresh()}})}}})},loadPhoto:function(){var t=this,r=Sizzle(".photo-home")[0].id,i=XN.photo.libs.lazyload({range:200,elements:t.selector+" a.pic img",realSrcAttribute:"data-src",loadImage:function(s){var o=s.getAttribute("data-src"),u=new Image;u.onload=function(){s.src=o,u.width<400&&$(s.parentNode).addClass("small-pic"),u.height<200&&$(s.parentNode).addClass("mini-h-pic"),u.width<400&&u.height>200&&($(s.parentNode).addClass("small-pic"),$(s.parentNode).style.height="auto"),$(s).delClass("loading"),u=null},u.onerror=function(){s.src=n},u.src=o,t.loadComment(s);if(t.lazyObj&&e.checkBox.checked&&e.cmtsPhotos.length){t.lazyObj.lazyPage<3&&(t.lazyObj.lazyPage=3);var a=document.getElementById(r).getElementsByTagName("li"),f=[];for(var l=0;l<a.length;l++)a[l].style.display!="none"&&f.push(a[l])}if(t.lazyObj&&e.checkBox.checked&&e.cmtsPhotos.length&&t.getLi(s)==f[f.length-1]&&a.length<t.lazyObj.aPhotoCount){var c=[];new XN.net.xmlhttp({url:"http://photo.renren.com/photo/"+t.lazyObj.ownerId+"/album-"+t.lazyObj.albumId+"/bypage/ajax?curPage="+t.lazyObj.lazyPage+"&pagenum=3",method:"GET",onSuccess:function(e){var e=XN.json.parse(e.responseText),n=e.photoList.length,r=document.createElement("ul");for(var s=0;s<n;s++)c[s]='<li id="cmtmode-'+e.photoList[s].photoId+'" class="clearfix" data-info="{album:'+t.lazyObj.albumId+", photo:"+e.photoList[s].photoId+", owner:"+t.lazyObj.ownerId+", commentcount:"+e.photoList[s].commentcount+'}" '+(e.photoList[s].commentcount?"":'style="display:none"')+">"+'<div class="comments-box">'+'<div class="comments-opre">'+"<span>"+t.fatTime(e.photoList[s].time)+"</span>"+(t.lazyObj.canShare&&t.lazyObj.aType!=1?'<a href="javascript:void(0)" class="share_new" data-share="{stype:\'create_share_feed\', id:'+e.photoList[s].photoId+", owner:"+t.lazyObj.ownerId+', type:\'photo\'}" >分享</a><span class="pipe"></span>':"")+"</div>"+'<div id="comments_box_'+e.photoList[s].photoId+'" class="min-cmtbox statustab"></div>'+"</div>"+'<a class="pic" href="'+t.lazyObj.asUrlPhoto+"/photo/"+t.lazyObj.ownerId+"/photo-"+e.photoList[s].photoId+'">'+'<img alt="'+e.photoList[s].title+'" class="loading" data-src="'+e.photoList[s].largeUrl+'" src="'+t.lazyObj.asurlSmallStatic+'/imgpro/indicator/loading.gif" />'+"</a>"+"</li>";t.lazyObj.lazyPage+=3,r.innerHTML=c.join(""),Sizzle(".review-mode")[0].appendChild(r),i.refresh()}})}}})},fatTime:function(e){var t=e.split(" "),n=t[0].split("-");return n[0]+"年"+n[1]+"月"+n[2]+"日"}};XN.photo.libs.cmtmode=function(t,n,r,s){n&&e.init(t,n),i.init(t,r,s)}}(),function(){var e={_control:!0,_fixID:"",_mes:{"-2":"部分照片为非公开","-1":"仅自己可见",1:"仅好友可见",2:"用密码访问",3:"仅同网络可见"},init:function(e,t,n){this._fixID=t,this._controlType=e,this._control=e<=3,this._type=n,this._key=n=="album"?"ap":"sp",this.confim=new XN.UI.fixPositionElement,this.confim.container.addClass("copylink-float"),this.confim.hide()},showTips:function(){GetCookie("copyLinkTip20100311")==null&&$("copyLinkTip")&&GetCookie("copyLinkDayShow")==null&&($("copyLinkTip").show(),XN.cookie.set("copyLinkDayShow","0",1,"/","photo."+XN.env.domain,!1),setTimeout(function(){$("copyLinkTip").hide()},15e3))},hideTips:function(){XN.cookie.set("copyLinkTip20100311","0",1,"/","photo."+XN.env.domain,!1),$("copyLinkTip")&&$("copyLinkTip").hide()},show:function(){this.hideTips(),this._control?this.showConfim():this.getLink()},hide:function(){this.confim&&this.confim.hide()},setPos:function(){if(!this.confim)return;this.confim.show(),this.confim.moveTo(this._fixID),this.confim.setAlignType("3-2")},showConfim:function(){var e="<span>该相册设置了隐私保护 : "+this._mes[this._controlType]+"</span>"+'<p>你确定要复制该相册的站外链接吗？<strong>通过该链接<br>查看这个相册时将不受到隐私控制。</strong><a target="_blank" href="http://page.'+XN.env.domain+'/699000003/note/450010779">查看帮助</a></p>'+'<input onclick="ExternalShareLink.getLink();" type="button" value="确认,查看链接" class="input-submit"> <input onclick="ExternalShareLink.hide()" type="button" value="取消" class="input-submit gray">';this._type=="photo"&&(e=e.replace(/相册/g,"照片")),this.confim.setContent(e),this.setPos()},getLink:function(){var e=this;new XN.NET.xmlhttp({url:this.getLinkUrl(),method:"GET",onSuccess:function(t){e._link=" http://photo."+XN.env.domain+"/photo/"+e._key+"/"+t.responseText,e.showLink()}})},i:0,showLink:function(){var t=this._control?"<span>该相册设置了隐私保护 : "+this._mes[this._controlType]+"</span>":"";t+='<p><strong>将下面的链接发给好友</strong>(如QQ或MSN)<br>他们不需要注册就能查看该相册。<a target="_blank" href="http://page.'+XN.env.domain+'/699000003/note/450010779">查看帮助</a></p><input type="text" id="openLinkUrlID"  style="width: 165px;" value="'+this._link+'" class="input-text"> <input id="copyToClipBtn'+this.i+'" type="button" value="点击复制" class="input-submit">',this._type=="photo"&&(t=t.replace(/相册/g,"照片")),this.confim.setContent(t),this.i++,this.setPos();var n=this;setTimeout(function(){n.createClient(),XN.event.addEvent(n.confim.container,"click",function(e){var t=e||window.event;t&&t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0}),XN.event.addEvent(document,"click",function(){e.hide(),n.clip.reposition("copyToClipBtn"+(this.i-1)),XN.event.delEvent(document,"click",arguments.callee)}),$("openLinkUrlID").select()},0)},createClient:function(){var e=this._link,t=this;XN.BROWSER.IE&&XN.event.addEvent("copyToClipBtn"+(this.i-1),"click",function(){if(t.clip){t.clip.reposition("copyToClipBtn"+(t.i-1));return}});if(typeof ZeroClipboard!="undefined"){this.createClip();return}XN.loadFile(XN.env.staticRoot+"jspro/album/ZeroClipboard.js",function(){ZeroClipboard.setMoviePath(XN.env.CDNstaticRoot+"swf/album/ZeroClipboard.swf"),t.createClip()})},createClip:function(){if(this.clip){this.clip.reposition("copyToClipBtn"+(this.i-1));return}var e=this._link,t=this,n=new ZeroClipboard.Client;n.setHandCursor(!0),n.addEventListener("complete",function(e,n){t.hide(),e.hide(),XN.DO.showMessage("已经复制到剪贴板")}),n.setText(e),n.glue("copyToClipBtn"+(this.i-1)),this.clip=n}};window.ExternalShareLink=e}(),copyExtralLink={},copyExtralLink.init=function(e,t){this.btnId=e,this.copyVal=t,this.createClient()},copyExtralLink.createClient=function(){var e=this._link,t=this;XN.BROWSER.IE&&XN.event.addEvent(t.btnId,"click",function(){if(t.clip){t.clip.reposition(t.btnId);return}});if(typeof ZeroClipboard!="undefined"){this.createClip();return}XN.loadFile(XN.env.staticRoot+"jspro/album/ZeroClipboard.js",function(){ZeroClipboard.setMoviePath(XN.env.CDNstaticRoot+"swf/album/ZeroClipboard.swf"),t.createClip()})},copyExtralLink.createClip=function(){if(this.clip){this.clip.reposition(this.btnId);return}var e=this,t=new ZeroClipboard.Client;t.setHandCursor(!0),t.addEventListener("complete",function(e,t){XN.DO.showMessage("已经复制到剪贴板")}),t.setText(this.copyVal),t.glue(this.btnId),this.clip=t},object.use("dom, xn",function(e,t){HTML5History.bind(window.history,{fireEvent:function(t,n){e.wrap(window).fireEvent(n)},blankHTML:"/ajaxproxy.htm"})}),function(){if(XN.vocalPlayer)return;XN.namespace("XN.vocalPlayer");var e={flashSource:"",flashUrl:"http://s.xnimg.cn/n/apps/status/module/vocal/swf/player_v1.0.swf?t="+(new Date).getTime(),swfobjectUrl:"http://s.xnimg.cn/xnapp/common/js/swfobjectv2.js",flashReady:!1,flashId:"vocalPlayerEl",flashvars:{},flashParams:{wmode:"transparent",allowscriptaccess:"always"},start:function(t){var n=this;t&&(this.flashSource=t),this.flashReady?(this.flashPlayerObj.setFileUrl(this.flashSource),this.play()):XN.loadFiles([this.swfobjectUrl],function(){e.flashReady=!0,n.initFlash()})},initFlash:function(){if(!swfobject.ua.pv[0])return XN.Do.alert({msg:'您未安装flash播放器，请<a href="http://www.adobe.com/go/getflash/" target="_blank">点击下载</a>安装最新的flash后刷新页面'}),this.fireEvent("flashFailed"),this.flashReady=!1,this.flashFailed=!0,!1;var e=document.createElement("div");e.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px",e.setAttribute("id",this.flashId),document.body.appendChild(e),swfobject.embedSWF(this.flashUrl,this.flashId,"1","1","10.0.0","",this.flashvars,this.flashParams),XN.browser.IE6&&($(this.flashId).style.position="absolute",$(this.flashId).style.top=document.documentElement.scrollTop+"px")},play:function(){if(this.flashFailed)return;this.flashPlayerObj.fl_play()},pause:function(){if(this.flashFailed)return;this.flashPlayerObj.fl_pause()}};XN.vocalPlayer=e,XN.vocalPlayer.flashAdded=function(){e.flashPlayerObj=$(XN.vocalPlayer.flashId),e.start(),e.fireEvent("flashReady")},XN.vocalPlayer.mp3Added=function(){e.fireEvent("videoReady")},XN.vocalPlayer.playEnd=function(){e.fireEvent("videoEnd")},XN.event.enableCustomEvent(XN.vocalPlayer),XN.vocalPlayer.on=XN.vocalPlayer.addEvent}(),object.add("xn.vocalPlayer","dom, events",function(e,t,n){var r=new Class({initialize:function(e,n){object.extend(e,n);if(!e.total||!e.trigger||!e.url)return;t.wrap(e.trigger),e.bindClick(),r.instances.push(e),Sizzle(".vocal-count",e.trigger.parentNode).length>0&&(e.counter=Sizzle(".vocal-count",e.trigger.parentNode)[0]),Sizzle(".num",e.trigger).length>0&&(e.numer=Sizzle(".num",e.trigger)[0]),e.trigger.hideFocus!=null&&(e.trigger.hideFocus=!0)},bindClick:function(e){e.running=!1,e.lastPauseAt=0,XN.vocalPlayer.addEvent("videoReady",function(){e.endLoading();if(!e.isCurrent)return;e.run(),e.running=!0,XN.element.addClass(e.trigger,"vocal-running")}),XN.vocalPlayer.addEvent("flashFailed",function(){e.end(),e.endLoading()}),e.trigger.addEvent("click",function(t){XN.event.stop(t),r.setCurrent(e);if(e.running)XN.vocalPlayer.pause(),e.pause(),e.running=!1,$(e.trigger).delClass("vocal-running");else{e.lastPauseAt===0?(e.startLoading(),XN.vocalPlayer.start(e.url)):XN.vocalPlayer.play();if(XN.vocalPlayer.flashFailed)return;e.addCount()}},n.HOLD)},addCount:function(e){if(!e.ownerId||!e.voiceId)return;e.psource||(e.psource="10001");var t,n="";e.trigger.hasClassName("vocal-player-tiny")?(t="http://voice.renren.com/comment/incPlayCount",n="replyer="+e.ownerId+"&commentId="+e.voiceId+"&owner="+e.sourceOwner+"&source="+e.sourceId+"&ugcType="+e.ugcType):e.photoId?t="http://photo.renren.com/photo/"+e.ownerId+"/photo-"+e.photoId+"/addPlayCount?voiceId="+e.voiceId+"&psource="+e.psource:t="http://voice.renren.com/"+e.ownerId+"/"+e.voiceId+"/addVC",new XN.net.xmlhttp({url:t,method:"POST",data:n});if(e.counter){var r=e.counter.innerHTML.match(/\d+/)[0];e.counter.innerHTML=e.counter.innerHTML.replace(r,parseInt(r)+1)}},startLoading:function(e){Sizzle(".time",e.trigger).length>0&&(Sizzle(".time",e.trigger)[0].style.display="none");if(Sizzle(".loading",e.trigger).length>0)Sizzle(".loading",e.trigger)[0].style.display="block";else{var n=t.getDom('<div class="loading">···</div>');e.trigger.appendChild(n)}e.loadChange()},loadChange:function(e){var t=0,n=["","·","··","···"],r=Sizzle(".loading",e.trigger)[0];if(!r)return;e.loadTimer=setInterval(function(){r.innerHTML=n[t++%4]},400)},endLoading:function(e){Sizzle(".time",e.trigger).length>0&&(Sizzle(".time",e.trigger)[0].style.display="block"),Sizzle(".loading",e.trigger).length>0&&(Sizzle(".loading",e.trigger)[0].style.display="none",clearInterval(e.loadTimer))},run:function(e){var t=(new Date).getTime(),n,r,i;typeof e.lastPauseAt=="undefined"&&(e.lastPauseAt=0),e.runner=setInterval(function(){n=(new Date).getTime(),e.percent=e.lastPauseAt+(n-t)/e.total/1e3,r=12-Math.floor(e.percent*12),e.numer&&(i=Math.round(e.total*(1-e.percent)),e.numer.innerHTML=i);if(e.percent>=1)return e.end(),!1},1e3)},pause:function(e){e.lastPauseAt=e.percent,clearInterval(e.runner)},end:function(e){e.pause(),clearInterval(e.runner),e.running=!1,e.lastPauseAt=e.percent=0,$(e.trigger).delClass("vocal-running"),e.endLoading(),e.isCurrent=!1,e.numer&&(e.numer.innerHTML=e.total)},reset:function(e,t){e.end(),object.extend(e,t),$(XN.vocalPlayer.flashId)&&($(XN.vocalPlayer.flashId).remove(),XN.vocalPlayer.flashReady=!1)}});r.instances=[],r.setCurrent=function(e){var t=r.instances.indexOf(e),n=r.instances.length,i=0;for(;i<n;i++)i!=t?r.instances[i].end():r.instances[i].isCurrent=!0},e.Player=r}),object.use("xn/vocalPlayer, dom, events",function(e,t,n){t.ready(function(){t.wrap(document.body).delegate(".vocal-player","mouseover",function(t){if(!!this.playerInited)return;this.playerInited=!0;var n=XN.JSON.parse(this.getAttribute("data-vocal")),r=this;this.player=new e.Player({total:n.time,trigger:this,url:n.url,ownerId:n.ownerId,voiceId:n.voiceId,photoId:n.photoId||"",psource:n.psource||"",sourceOwner:n.sourceOwner||"",sourceId:n.sourceId||"",ugcType:n.ugcType||0}),window.asyncHTMLManager&&!e.Player.asyncInited&&(e.Player.asyncInited=!0,asyncHTMLManager.addEvent("beforeload",function(){e.Player.instances.forEach(function(e){e.reset()}),r.playerInited=!1})),window.newsfeed&&!e.Player.feedInited&&(e.Player.feedInited=!0,newsfeed.addEvent("beforereload",function(){e.Player.instances.forEach(function(e){e.reset()})}))},n.HOLD)})}),XN.dom.ready(function(){var e=$("albumCommentBox"),t=$("cmtbody");t&&e&&t.setAttribute("data-privacy",e.getAttribute("data-privacy"));var n=function(e,t,n){return XN.isArray(e)&&(n=t,t=e,e=XN.user.id),t=t||[],n=n||[],t.some(function(t){return(new RegExp(t+"$")).test(e)})||n.some(function(t){return t==e})};if(!n([75,76,77,78,51,59]))return;var r=function(e){var t=$(e);t.delClass("flashUploader"),t.href="http://upload.renren.com/upload/uploadAll",n([75,76,59])?t.target="_blank":n([77,78,51])&&(t.target="_self")};Sizzle("a.upload").forEach(r)}),function(){var e={album_list_selector:"#recommend-album-box .an-album",show_album_selector:"#recommend-album-box .an-album.visible",show_album_first_selector:"#recommend-album-box .an-album.visible:first",album_list:{},siv:{},last_index:0,rule_h:90,rule_w:110,rule_ratio:90/110,playfun:function(){var e=this.album_list.length;if(e>3){var t=jxn(this.show_album_selector),n=jxn(this.show_album_first_selector),r=n.attr("id").replace(RegExp("recommend_album_"),"")-0+3;t.removeClass("visible");for(var i=0,s=t.length;i<s;i++){var o="recommend_album_"+(this.last_index+i+1),u=t.eq(i).attr("id","recommend_album_"+(this.last_index+i+1));jxn("#recommend-album-box").append(u)}this.last_index+=3;for(var i=0;i<3;i++){var a=jxn("#recommend_album_"+(r+i)).addClass("visible");this.initImg(a)}}},initImg:function(e){var t=e.find(".img img"),n=new Object;n.ratio=t.height()/t.width(),n.ratio>this.rule_ratio?(t.css({width:"100%"}),n.h=t.height(),n.w=t.width(),n.t=Math.round((n.h-this.rule_h)/2/this.rule_h*1e4)/100,t.css({top:"-"+n.t+"%"})):n.ratio==this.rule_ratio?t.css({width:"100%"}):n.ratio<this.rule_ratio&&n.ratio>0?(t.css("height","100%"),n.h=t.height(),n.w=t.width(),n.l=Math.round((n.w-this.rule_w)/2/this.rule_w*1e4)/100,t.css({left:"-"+n.l+"%"})):t.css({height:"100%",width:"100%"})},play:function(){this.siv=setInterval(function(){e.playfun()},15e3)},stop:function(){clearInterval(this.siv)},init:function(){this.album_list=jxn(this.album_list_selector),this.last_index=this.album_list.length-1;var e=jxn(this.show_album_selector);for(var t=0,n=e.length;t<n;t++)(function(n,r){e.eq(t).find(".img img").bind("load",function(){n.initImg(r)})})(this,e.eq(t));this.play()}};jxn.get("http://photo.renren.com/photo/suggest/suggestAlbumNewRight",function(t){t=JSON.parse(t);if(t&&t.code==0){jxn("#recommend-album-box .an-album").remove();for(var n=0;n<t.albumList.length;n++){var r=['<div id="recommend_album_',n,'" class="an-album',n<3?" visible":"",'"><a class="photo-view pic-link" href="javascript:;" url="',t.albumList[n].url,'"><span class="img"><img src="',t.albumList[n].cover,'" /></span></a><div class="album-info"><p class="p-1"><a class="name-link" href="javascript:;" url="',t.albumList[n].url,'" title="',t.albumList[n].name.length>12?t.albumList[n].name:"",'">',t.albumList[n].name.length>12?t.albumList[n].name.substring(0,12)+"...":t.albumList[n].name,"</a>(",t.albumList[n].photoCount,'张)</p><p class="p-1">来自：<a class="from-link" href="javascript:;" url="http://www.renren.com/',t.albumList[n].owner,'">',t.albumList[n].userName.length>5?t.albumList[n].userName.substring(0,5):t.albumList[n].userName,'</a></p><p class="p-2"><span title="',t.albumList[n].albumDesc.length>15?t.albumList[n].albumDesc:"",'">',t.albumList[n].albumDesc.length>15?t.albumList[n].albumDesc.substring(0,15)+"...":t.albumList[n].albumDesc,"</span></p></div></div>"],i=r.join("");jxn("#recommend-album-box").append(i)}e.init(),jxn("#recommend-album-box .pic-link").bind("click",function(){var e=new Image;e.src="http://photo.renren.com/photo/suggest/suggestAlbumDataLog?type=3",window.open(jxn(this).attr("url"),"_blank")}),jxn("#recommend-album-box .name-link").bind("click",function(){var e=new Image;e.src="http://photo.renren.com/photo/suggest/suggestAlbumDataLog?type=3",window.open(jxn(this).attr("url"),"_blank")}),jxn("#recommend-album-box .from-link").bind("click",function(){var e=new Image;e.src="http://photo.renren.com/photo/suggest/suggestAlbumDataLog?type=3",window.open(jxn(this).attr("url"),"_blank")})}})}(),function(e){function s(e,t,n){e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)}function o(e,t,n){e.detachEvent?(e.detachEvent("on"+t,e[t+n]),e[t+n]=null):e.removeEventListener(t,n,!1)}if(window.myAlbumCount<=40)return;var t=!1,n=40,r=null,i=e(window).height(),u=function(r){t=!0,n>=window.myAlbumCount&&o(window,"scroll",a);var i="http://photo.renren.com/photo/"+window.albumOwner+"/album/relatives/ajax?offset="+r+"&limit=20";e.get(i,function(n){e("#albumListContainer").append(n),t=!1})},a=function(){r&&clearTimeout(r),r=setTimeout(function(){var r=e("body").height(),s=e(document).scrollTop(),o=r-s-i;o<350&&!t&&(u(n),n+=20)},100)};e(function(){s(window,"scroll",a)})}(jxn);